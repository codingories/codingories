<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"codingories.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="这个博客用来记录自己的生活">
<meta property="og:type" content="website">
<meta property="og:title" content="OriesノBlog">
<meta property="og:url" content="codingories.github.io/page/9/index.html">
<meta property="og:site_name" content="OriesノBlog">
<meta property="og:description" content="这个博客用来记录自己的生活">
<meta property="article:author" content="Ories">
<meta property="article:tag" content="编程 吉他 rap">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="codingories.github.io/page/9/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-Hans'
  };
</script>

  <title>OriesノBlog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">OriesノBlog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">朱骏杰的私人博客</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="codingories.github.io/2020/04/24/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91-%E7%BF%BB%E8%AF%91%E8%BD%AF%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://i.loli.net/2020/07/12/RPjkZxei6agC49U.jpg">
      <meta itemprop="name" content="Ories">
      <meta itemprop="description" content="这个博客用来记录自己的生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OriesノBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/24/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91-%E7%BF%BB%E8%AF%91%E8%BD%AF%E4%BB%B6/" class="post-title-link" itemprop="url">小程序开发-翻译软件</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-04-24 14:51:57 / Modified: 16:35:15" itemprop="dateCreated datePublished" datetime="2020-04-24T14:51:57+08:00">2020-04-24</time>
            </span>

          
            <span id="/2020/04/24/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91-%E7%BF%BB%E8%AF%91%E8%BD%AF%E4%BB%B6/" class="post-meta-item leancloud_visitors" data-flag-title="小程序开发-翻译软件" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2020/04/24/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91-%E7%BF%BB%E8%AF%91%E8%BD%AF%E4%BB%B6/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/04/24/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91-%E7%BF%BB%E8%AF%91%E8%BD%AF%E4%BB%B6/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ol>
<li>app.json 的作用就是入口文件，用于配置各类文件</li>
<li>每个页面的配置,page.json</li>
<li>比较常用的标签，view,image,button</li>
<li>每个文件夹下的文件会自动引</li>
<li>抛弃传统的浮动定位，都用 flex</li>
<li>全局样式可以放到 app.wxss 这里,也可以进行分层</li>
<li>数据绑定</li>
<li>iphone6 设计稿 750px,像素宽度 375，某个字 font-size 是 40px，手机上实际上 20px，那么可以直接写 40rpx，如果换一个手机就可以等比缩放。</li>
<li>globalData:的使用就是公共数据</li>
<li>模块化<ol>
<li>每一个文件获得模块化</li>
<li>如果想要全局，可以通过 app 获取，类似 common js,require+相对路径</li>
</ol>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="codingories.github.io/2020/04/22/Vue%E8%A1%A8%E5%8D%95%E5%92%8Cv-model/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://i.loli.net/2020/07/12/RPjkZxei6agC49U.jpg">
      <meta itemprop="name" content="Ories">
      <meta itemprop="description" content="这个博客用来记录自己的生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OriesノBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/22/Vue%E8%A1%A8%E5%8D%95%E5%92%8Cv-model/" class="post-title-link" itemprop="url">Vue表单和v-model</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-04-22 19:11:09 / Modified: 19:55:11" itemprop="dateCreated datePublished" datetime="2020-04-22T19:11:09+08:00">2020-04-22</time>
            </span>

          
            <span id="/2020/04/22/Vue%E8%A1%A8%E5%8D%95%E5%92%8Cv-model/" class="post-meta-item leancloud_visitors" data-flag-title="Vue表单和v-model" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2020/04/22/Vue%E8%A1%A8%E5%8D%95%E5%92%8Cv-model/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/04/22/Vue%E8%A1%A8%E5%8D%95%E5%92%8Cv-model/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ol>
<li>form 的使用<ul>
<li>需要按回车提交，form 里面加一个 button</li>
<li>如果需要保存就监听 form 的 submit 事件</li>
</ul>
</li>
<li>Ant Design of Vue</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="codingories.github.io/2020/04/22/React%E5%85%A8%E8%A7%A3%E4%B9%8B04Hooks%E5%90%84%E4%B8%AA%E5%87%BB%E7%A0%B4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://i.loli.net/2020/07/12/RPjkZxei6agC49U.jpg">
      <meta itemprop="name" content="Ories">
      <meta itemprop="description" content="这个博客用来记录自己的生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OriesノBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/22/React%E5%85%A8%E8%A7%A3%E4%B9%8B04Hooks%E5%90%84%E4%B8%AA%E5%87%BB%E7%A0%B4/" class="post-title-link" itemprop="url">React全解之04Hooks各个击破</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-04-22 10:10:15" itemprop="dateCreated datePublished" datetime="2020-04-22T10:10:15+08:00">2020-04-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-03 19:10:46" itemprop="dateModified" datetime="2020-10-03T19:10:46+08:00">2020-10-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">前端框架</span></a>
                </span>
            </span>

          
            <span id="/2020/04/22/React%E5%85%A8%E8%A7%A3%E4%B9%8B04Hooks%E5%90%84%E4%B8%AA%E5%87%BB%E7%A0%B4/" class="post-meta-item leancloud_visitors" data-flag-title="React全解之04Hooks各个击破" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2020/04/22/React%E5%85%A8%E8%A7%A3%E4%B9%8B04Hooks%E5%90%84%E4%B8%AA%E5%87%BB%E7%A0%B4/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/04/22/React%E5%85%A8%E8%A7%A3%E4%B9%8B04Hooks%E5%90%84%E4%B8%AA%E5%87%BB%E7%A0%B4/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="1-useState"><a href="#1-useState" class="headerlink" title="1. useState"></a>1. useState</h3><ul>
<li>使用状态<ul>
<li>const [n,setN] = React.useState(0)</li>
<li>const [user,setUser] = React.useState({name:’F’})</li>
</ul>
</li>
<li>注意事项 1: 不可局部更新<ul>
<li>如果 state 是一个对象不能部分 setState,见 <a href="https://codesandbox.io/s/snowy-pine-7gdw2" target="_blank" rel="noopener">https://codesandbox.io/s/snowy-pine-7gdw2</a></li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [user, setUser] = useState(&#123; <span class="attr">name</span>: <span class="string">"Frank"</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;);</span><br><span class="line">  <span class="keyword">const</span> onClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setUser(&#123;</span><br><span class="line">      ...user,</span><br><span class="line">      <span class="comment">// 加上这一行就可以解决这个问题</span></span><br><span class="line">      name: <span class="string">"Jack"</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;h1&gt;&#123;user.name&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &lt;h2&gt;&#123;user.age&#125;&lt;/</span>h2&gt;</span><br><span class="line">      &lt;button onClick=&#123;onClick&#125;&gt;Click&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootElement = <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>);</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, rootElement);</span><br></pre></td></tr></table></figure>

<ul>
<li>注意事项 2: 地址要变<ul>
<li>setState(obj)如果地址不变，那么 React 就认为数据没有变化。</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [user, setUser] = useState(&#123; <span class="attr">name</span>: <span class="string">"Frank"</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;);</span><br><span class="line">  <span class="keyword">const</span> onClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    user.name = <span class="string">"Jack"</span>;</span><br><span class="line">    setUser(user);</span><br><span class="line">    <span class="comment">// 这样写不行,set不能是同一个对象</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;h1&gt;&#123;user.name&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &lt;h2&gt;&#123;user.age&#125;&lt;/</span>h2&gt;</span><br><span class="line">      &lt;button onClick=&#123;onClick&#125;&gt;Click&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootElement = <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>);</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, rootElement);</span><br></pre></td></tr></table></figure>

<ul>
<li>注意事项 3: useState 可以用函数,好处是写成函数节省时间。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [user, setUser] = useState(<span class="function"><span class="params">()</span> =&gt;</span> (&#123; <span class="attr">name</span>: <span class="string">"Frank"</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;));</span><br><span class="line">  <span class="comment">// 写成函数js引擎不会立即解析，减少多余的计算过程, 用处不大，多算一次影响不大</span></span><br><span class="line">  <span class="keyword">const</span> onClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setUser(&#123;</span><br><span class="line">      ...user,</span><br><span class="line">      name: <span class="string">"Jack"</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;h1&gt;&#123;user.name&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &lt;h2&gt;&#123;user.age&#125;&lt;/</span>h2&gt;</span><br><span class="line">      &lt;button onClick=&#123;onClick&#125;&gt;Click&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootElement = <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>);</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, rootElement);</span><br></pre></td></tr></table></figure>

<ul>
<li>setN 写成函数的案例</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [n, setN] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="comment">// 写成函数js引擎不会立即解析，减少多余的计算过程, 用处不大，多算一次影响不大</span></span><br><span class="line">  <span class="keyword">const</span> onClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// setN(n+1);</span></span><br><span class="line">    <span class="comment">// setN(n+2);</span></span><br><span class="line">    <span class="comment">// n 不能+3,而是+2</span></span><br><span class="line">    setN(<span class="function">(<span class="params">i</span>) =&gt;</span> i + <span class="number">1</span>);</span><br><span class="line">    setN(<span class="function">(<span class="params">i</span>) =&gt;</span> i + <span class="number">2</span>);</span><br><span class="line">    <span class="comment">// 这样写就能+3,传一个操作,set里面优先使用函数,除非下面不能用再用上面的写法</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;h1&gt;n: &#123;n&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button onClick=&#123;onClick&#125;&gt;+2&lt;/</span>button&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const rootElement = document.getElementById("root");</span></span><br><span class="line"><span class="regexp">ReactDOM.render(&lt;App /</span>&gt;, rootElement);</span><br></pre></td></tr></table></figure>

<h3 id="2-useReducer"><a href="#2-useReducer" class="headerlink" title="2. useReducer"></a>2. useReducer</h3><ol>
<li> 创建初始值 initialState</li>
<li> 创建所有操作 reducer(state, action)</li>
<li> 传给 useReducer, 得到读和写 API</li>
<li> 调用写({type:’操作类型’})</li>
<li> 总得来说 useReducer 是 useState 得复杂版</li>
<li> 如果发现有几个变量应该放到一起, 就应该放到 useReducer 里面。例子，<a href="https://codesandbox.io/s/admiring-framework-4by2t%EF%BC%8C" target="_blank" rel="noopener">https://codesandbox.io/s/admiring-framework-4by2t，</a></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useReducer, useState &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initial = &#123;</span><br><span class="line">  n: <span class="number">0</span>,</span><br><span class="line">&#125;; <span class="comment">// 创建所有值</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reducer = <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (action.type === <span class="string">"add"</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">n</span>: state.n + action.number &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (action.type === <span class="string">"mult"</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">n</span>: state.n * <span class="number">2</span> &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"unknown type"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;; <span class="comment">// 这里写所有的操作, 这样的好处就是下面的代码就简单了</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [state, dispatch] = useReducer(reducer, initial);</span><br><span class="line">  <span class="keyword">const</span> &#123; n &#125; = state;</span><br><span class="line">  <span class="keyword">const</span> onClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    dispatch(&#123; <span class="attr">type</span>: <span class="string">"add"</span>, <span class="attr">number</span>: <span class="number">1</span> &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> onClick2 = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    dispatch(&#123; <span class="attr">type</span>: <span class="string">"add"</span>, <span class="attr">number</span>: <span class="number">2</span> &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;h1&gt;n: &#123;n&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button onClick=&#123;onClick&#125;&gt;+1&lt;/</span>button&gt;</span><br><span class="line">      &lt;button onClick=&#123;onClick2&#125;&gt;+<span class="number">2</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootElement = <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>);</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, rootElement);</span><br></pre></td></tr></table></figure>

<h3 id="3-useReducer-案例-2"><a href="#3-useReducer-案例-2" class="headerlink" title="3. useReducer 案例 2"></a>3. useReducer 案例 2</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useReducer &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initFormData = &#123;</span><br><span class="line">  name: <span class="string">""</span>,</span><br><span class="line">  age: <span class="number">18</span>,</span><br><span class="line">  nationality: <span class="string">"汉族"</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"patch"</span>: <span class="comment">// 更新</span></span><br><span class="line">      <span class="keyword">return</span> &#123; ...state, ...action.formData &#125;; <span class="comment">// 把两个对象合并到第三个对象里</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">"reset"</span>: <span class="comment">// 重置</span></span><br><span class="line">      <span class="keyword">return</span> initFormData; <span class="comment">// 返回最开始的对象就是重置</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [formData, dispatch] = useReducer(reducer, initFormData);</span><br><span class="line">  <span class="keyword">const</span> onSubmit = <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;;</span><br><span class="line">  <span class="keyword">const</span> onReset = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    dispatch(&#123; <span class="attr">type</span>: <span class="string">"reset"</span> &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;form onSubmit=&#123;onSubmit&#125; onReset=&#123;onReset&#125;&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;label&gt;</span><br><span class="line">          姓名</span><br><span class="line">          &lt;input</span><br><span class="line">            value=&#123;formData.name&#125;</span><br><span class="line">            onChange=&#123;(e) =&gt;</span><br><span class="line">              dispatch(&#123; <span class="attr">type</span>: <span class="string">"patch"</span>, <span class="attr">formData</span>: &#123; <span class="attr">name</span>: e.target.value &#125; &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;label&gt;</span><br><span class="line">          年龄</span><br><span class="line">          &lt;input</span><br><span class="line">            value=&#123;formData.age&#125;</span><br><span class="line">            onChange=&#123;(e) =&gt;</span><br><span class="line">              dispatch(&#123; <span class="attr">type</span>: <span class="string">"patch"</span>, <span class="attr">formData</span>: &#123; <span class="attr">age</span>: e.target.value &#125; &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;label&gt;</span><br><span class="line">          民族</span><br><span class="line">          &lt;input</span><br><span class="line">            value=&#123;formData.nationality&#125;</span><br><span class="line">            onChange=&#123;(e) =&gt;</span><br><span class="line">              dispatch(&#123;</span><br><span class="line">                type: <span class="string">"patch"</span>,</span><br><span class="line">                formData: &#123; <span class="attr">nationality</span>: e.target.value &#125;,</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;button type=<span class="string">"submit"</span>&gt;提交&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button type="reset"&gt;重置&lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;hr /</span>&gt;</span><br><span class="line">      &#123;<span class="built_in">JSON</span>.stringify(formData)&#125;</span><br><span class="line">    &lt;<span class="regexp">/form&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const rootElement = document.getElementById("root");</span></span><br><span class="line"><span class="regexp">ReactDOM.render(&lt;App /</span>&gt;, rootElement);</span><br></pre></td></tr></table></figure>

<h3 id="4-useReducer-案例-3-使用-useReducer-代替-redux-https-codesandbox-io-s-confident-raman-fcdsn-file-src-index-js"><a href="#4-useReducer-案例-3-使用-useReducer-代替-redux-https-codesandbox-io-s-confident-raman-fcdsn-file-src-index-js" class="headerlink" title="4. useReducer 案例 3, 使用 useReducer 代替 redux,https://codesandbox.io/s/confident-raman-fcdsn?file=/src/index.js"></a>4. useReducer 案例 3, 使用 useReducer 代替 redux,<a href="https://codesandbox.io/s/confident-raman-fcdsn?file=/src/index.js" target="_blank" rel="noopener">https://codesandbox.io/s/confident-raman-fcdsn?file=/src/index.js</a></h3><ul>
<li><ol>
<li>将数据集中在一个 store 对象</li>
</ol>
</li>
<li><ol start="2">
<li>将所有操作集中在 reducer</li>
</ol>
</li>
<li><ol start="3">
<li>创建一个 Context</li>
</ol>
</li>
<li><ol start="4">
<li>创建对数据的读写 api</li>
</ol>
</li>
<li><ol start="5">
<li>将第四步的内容放到第三步的 Context</li>
</ol>
</li>
<li><ol start="6">
<li>用 Context.Provider 将 Context 提供给所有组件</li>
</ol>
</li>
<li><ol start="7">
<li>各个组件用 useContext 获取读写 API</li>
</ol>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useReducer, useContext, useEffect &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = &#123;</span><br><span class="line">  user: <span class="literal">null</span>,</span><br><span class="line">  books: <span class="literal">null</span>,</span><br><span class="line">  movies: <span class="literal">null</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 1. 将数据集中在一个 store 对象</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"setUser"</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; ...state, <span class="attr">user</span>: action.user &#125;;</span><br><span class="line">    <span class="comment">// 先把之前的状态复制过来，再加上新的user</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">"setBooks"</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; ...state, <span class="attr">books</span>: action.books &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"setMovies"</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; ...state, <span class="attr">movies</span>: action.movies &#125;;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="comment">// 2. 将所有操作集中在 reducer</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Context = React.createContext(<span class="literal">null</span>);</span><br><span class="line"><span class="comment">// 3. 创建一个 Context</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [state, dispatch] = useReducer(reducer, store);</span><br><span class="line">  <span class="comment">// 4. 创建对数据的读写 api</span></span><br><span class="line">  <span class="keyword">const</span> api = &#123; state, dispatch &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Context.Provider value=&#123;api&#125;&gt;</span><br><span class="line">      &#123;<span class="comment">/*5. 将第四步的内容放到第三步的 Context*/</span>&#125;</span><br><span class="line">      &#123;<span class="comment">/*6. 用 Context.Provider 将 Context 提供给所有组件*/</span>&#125;</span><br><span class="line">      &lt;User /&gt;</span><br><span class="line">      &lt;hr /&gt;</span><br><span class="line">      &lt;Books /&gt;</span><br><span class="line">      &lt;Movies /&gt;</span><br><span class="line">    &lt;<span class="regexp">/Context.Provider&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function User() &#123;</span></span><br><span class="line"><span class="regexp">  const &#123; state, dispatch &#125; = useContext(Context);</span></span><br><span class="line"><span class="regexp">  &#123;</span></span><br><span class="line"><span class="regexp">    /</span>*<span class="number">7.</span> 各个组件用 useContext 获取读写 API*<span class="regexp">/</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ 注意这里不是方括号，useContext返回一个对象</span></span><br><span class="line"><span class="regexp">  useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ useEffect替换useState,useState会在页面每次渲染都执行ajax,useEffect只有在第一次渲染才会调用ajax</span></span><br><span class="line"><span class="regexp">    ajax("/u</span>ser<span class="string">").then((user) =&gt; &#123;</span></span><br><span class="line"><span class="string">      console.log("</span>user<span class="string">");</span></span><br><span class="line"><span class="string">      console.log(user);</span></span><br><span class="line"><span class="string">      dispatch(&#123; type: "</span>setUser<span class="string">", user: user &#125;);</span></span><br><span class="line"><span class="string">      console.log(state);</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">  &#125;, []);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  return (</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">      &lt;h1&gt;个人信息&lt;/h1&gt;</span></span><br><span class="line"><span class="string">      &#123;/* &lt;div&gt;name: &#123;state.user&#125;&lt;/div&gt; */&#125;</span></span><br><span class="line"><span class="string">      &lt;div&gt;name: &#123;state.user ? state.user.name : "</span><span class="string">"&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  );</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function Books() &#123;</span></span><br><span class="line"><span class="string">  const &#123; state, dispatch &#125; = useContext(Context);</span></span><br><span class="line"><span class="string">  useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="string">    ajax("</span>/books<span class="string">").then((books) =&gt; &#123;</span></span><br><span class="line"><span class="string">      dispatch(&#123; type: "</span>setBooks<span class="string">", books: books &#125;);</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">  &#125;, []);</span></span><br><span class="line"><span class="string">  return (</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">      &lt;h1&gt;我的书籍&lt;/h1&gt;</span></span><br><span class="line"><span class="string">      &lt;ol&gt;</span></span><br><span class="line"><span class="string">        &#123;state.books</span></span><br><span class="line"><span class="string">          ? state.books.map((book) =&gt; &lt;li key=&#123;book.id&#125;&gt;&#123;book.name&#125;&lt;/li&gt;)</span></span><br><span class="line"><span class="string">          : "</span>加载中<span class="string">"&#125;</span></span><br><span class="line"><span class="string">      &lt;/ol&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  );</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function Movies() &#123;</span></span><br><span class="line"><span class="string">  const &#123; state, dispatch &#125; = useContext(Context);</span></span><br><span class="line"><span class="string">  useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="string">    ajax("</span>/movies<span class="string">").then((movies) =&gt; &#123;</span></span><br><span class="line"><span class="string">      dispatch(&#123; type: "</span>setMovies<span class="string">", movies: movies &#125;);</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">  &#125;, []);</span></span><br><span class="line"><span class="string">  return (</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">      &lt;h1&gt;我的电影&lt;/h1&gt;</span></span><br><span class="line"><span class="string">      &lt;ol&gt;</span></span><br><span class="line"><span class="string">        &#123;state.movies</span></span><br><span class="line"><span class="string">          ? state.movies.map((movie) =&gt; &lt;li key=&#123;movie.id&#125;&gt;&#123;movie.name&#125;&lt;/li&gt;)</span></span><br><span class="line"><span class="string">          : "</span>加载中<span class="string">"&#125;</span></span><br><span class="line"><span class="string">      &lt;/ol&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  );</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const rootElement = document.getElementById("</span>root<span class="string">");</span></span><br><span class="line"><span class="string">ReactDOM.render(&lt;App /&gt;, rootElement);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 帮助函数</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 假 ajax</span></span><br><span class="line"><span class="string">// 两秒钟后，根据 path 返回一个对象，必定成功不会失败</span></span><br><span class="line"><span class="string">function ajax(path) &#123;</span></span><br><span class="line"><span class="string">  return new Promise((resolve, reject) =&gt; &#123;</span></span><br><span class="line"><span class="string">    setTimeout(() =&gt; &#123;</span></span><br><span class="line"><span class="string">      if (path === "</span>/user<span class="string">") &#123;</span></span><br><span class="line"><span class="string">        resolve(&#123;</span></span><br><span class="line"><span class="string">          id: 1,</span></span><br><span class="line"><span class="string">          name: "</span>Frank<span class="string">",</span></span><br><span class="line"><span class="string">        &#125;);</span></span><br><span class="line"><span class="string">      &#125; else if (path === "</span>/books<span class="string">") &#123;</span></span><br><span class="line"><span class="string">        resolve([</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            id: 1,</span></span><br><span class="line"><span class="string">            name: "</span>JavaScript 高级程序设计<span class="string">",</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            id: 2,</span></span><br><span class="line"><span class="string">            name: "</span>JavaScript 精粹<span class="string">",</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">        ]);</span></span><br><span class="line"><span class="string">      &#125; else if (path === "</span>/movies<span class="string">") &#123;</span></span><br><span class="line"><span class="string">        resolve([</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            id: 1,</span></span><br><span class="line"><span class="string">            name: "</span>爱在黎明破晓前<span class="string">",</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            id: 2,</span></span><br><span class="line"><span class="string">            name: "</span>恋恋笔记本<span class="string">",</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">        ]);</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;, 2000);</span></span><br><span class="line"><span class="string">  &#125;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>案例 3 代码模块化，将以上代码模块化案例,<a href="https://codesandbox.io/s/stoic-lederberg-ogck7" target="_blank" rel="noopener">https://codesandbox.io/s/stoic-lederberg-ogck7</a></p>
<ul>
<li>目录接口,components 和 reducers 共有三个文件，这里只展示其中一个</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useReducer, useContext, useEffect &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="keyword">import</span> User <span class="keyword">from</span> <span class="string">"./components/user"</span>;</span><br><span class="line"><span class="keyword">import</span> Context <span class="keyword">from</span> <span class="string">"./Context"</span>;</span><br><span class="line"><span class="keyword">import</span> Books <span class="keyword">from</span> <span class="string">"./components/books"</span>;</span><br><span class="line"><span class="keyword">import</span> Movies <span class="keyword">from</span> <span class="string">"./components/movies"</span>;</span><br><span class="line"><span class="keyword">import</span> userReducer <span class="keyword">from</span> <span class="string">"./reducers/user_reducer"</span>;</span><br><span class="line"><span class="keyword">import</span> booksReducer <span class="keyword">from</span> <span class="string">"./reducers/books_reducer"</span>;</span><br><span class="line"><span class="keyword">import</span> moviesReducer <span class="keyword">from</span> <span class="string">"./reducers/movies_reducer"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = &#123;</span><br><span class="line">  user: <span class="literal">null</span>,</span><br><span class="line">  books: <span class="literal">null</span>,</span><br><span class="line">  movies: <span class="literal">null</span>,</span><br><span class="line">&#125;; <span class="comment">// 所有的数据</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  ...userReducer,</span><br><span class="line">  ...booksReducer,</span><br><span class="line">  ...moviesReducer,</span><br><span class="line">&#125;; <span class="comment">// 所有的对子模块的操作</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> fn = obj[action.type];</span><br><span class="line">  <span class="keyword">if</span> (fn) &#123;</span><br><span class="line">    <span class="keyword">return</span> fn(state, action);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">"wrong type"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="comment">// 对操作查找的过程</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [state, dispatch] = useReducer(reducer, store);</span><br><span class="line">  <span class="comment">// 获取读写接口</span></span><br><span class="line">  <span class="keyword">const</span> api = &#123; state, dispatch &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Context.Provider value=&#123;api&#125;&gt;</span><br><span class="line">      &#123;<span class="comment">/* 读写接口放到上下文里面,上下文把所有组件包起来，所有组件就可以使用useContext获取读写的接口 */</span>&#125;</span><br><span class="line">      &lt;User /&gt;</span><br><span class="line">      &lt;hr /&gt;</span><br><span class="line">      &lt;Books /&gt;</span><br><span class="line">      &lt;Movies /&gt;</span><br><span class="line">    &lt;<span class="regexp">/Context.Provider&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const rootElement = document.getElementById("root");</span></span><br><span class="line"><span class="regexp">ReactDOM.render(&lt;App /</span>&gt;, rootElement);</span><br></pre></td></tr></table></figure>

<ul>
<li>components 中的 books.js</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// books.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useContext, useEffect &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> Context <span class="keyword">from</span> <span class="string">"../Context"</span>;</span><br><span class="line"><span class="keyword">import</span> ajax <span class="keyword">from</span> <span class="string">"../ajax"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Books</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; state, dispatch &#125; = useContext(Context);</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    ajax(<span class="string">"/books"</span>).then(<span class="function">(<span class="params">books</span>) =&gt;</span> &#123;</span><br><span class="line">      dispatch(&#123; <span class="attr">type</span>: <span class="string">"setBooks"</span>, <span class="attr">books</span>: books &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, []);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1&gt;我的书籍&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &lt;ol&gt;</span></span><br><span class="line"><span class="regexp">        &#123;state.books</span></span><br><span class="line"><span class="regexp">          ? state.books.map((book) =&gt; &lt;li key=&#123;book.id&#125;&gt;&#123;book.name&#125;&lt;/</span>li&gt;)</span><br><span class="line">          : <span class="string">"加载中"</span>&#125;</span><br><span class="line">      &lt;<span class="regexp">/ol&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Books;</span><br></pre></td></tr></table></figure>

<ul>
<li>reducers 中的 books_reducer.js</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// books_reducers</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  setBooks: <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; ...state, <span class="attr">books</span>: action.books &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  deleteBook: <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>Context.js</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Context.js</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Context = React.createContext(<span class="literal">null</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Context;</span><br></pre></td></tr></table></figure>

<ul>
<li>Ajax.js</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Ajax.js</span></span><br><span class="line"><span class="comment">// 假 ajax</span></span><br><span class="line"><span class="comment">// 两秒钟后，根据 path 返回一个对象，必定成功不会失败</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params">path</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (path === <span class="string">"/user"</span>) &#123;</span><br><span class="line">        resolve(&#123;</span><br><span class="line">          id: <span class="number">1</span>,</span><br><span class="line">          name: <span class="string">"Frank"</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (path === <span class="string">"/books"</span>) &#123;</span><br><span class="line">        resolve([</span><br><span class="line">          &#123;</span><br><span class="line">            id: <span class="number">1</span>,</span><br><span class="line">            name: <span class="string">"JavaScript 高级程序设计"</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            id: <span class="number">2</span>,</span><br><span class="line">            name: <span class="string">"JavaScript 精粹"</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        ]);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (path === <span class="string">"/movies"</span>) &#123;</span><br><span class="line">        resolve([</span><br><span class="line">          &#123;</span><br><span class="line">            id: <span class="number">1</span>,</span><br><span class="line">            name: <span class="string">"爱在黎明破晓前"</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            id: <span class="number">2</span>,</span><br><span class="line">            name: <span class="string">"恋恋笔记本"</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        ]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="number">2000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ajax;</span><br></pre></td></tr></table></figure>

<h3 id="5-useContext"><a href="#5-useContext" class="headerlink" title="5. useContext"></a>5. useContext</h3><ul>
<li>Context 是上下文，全局变量是全局的上下文，上下文就是运行一个程序所需要知道的其他变量，上下文是局部的全局变量</li>
<li>一.使用 C = createContext(initial)创建上下文</li>
<li>二.&lt;C.provider&gt;圈定作用域</li>
<li>三.在作用域内使用 use</li>
<li>例子,<a href="https://codesandbox.io/s/quirky-clarke-0rfg5" target="_blank" rel="noopener">https://codesandbox.io/s/quirky-clarke-0rfg5</a></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; createContext, useState, useContext &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"./styles.css"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> C = createContext(<span class="literal">null</span>);</span><br><span class="line"><span class="comment">// 一.使用 C = createContext(initial)创建上下文</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"App 执行了"</span>);</span><br><span class="line">  <span class="keyword">const</span> [n, setN] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;C.Provider value=&#123;&#123; n, setN &#125;&#125;&gt;</span><br><span class="line">      &#123;<span class="comment">/*二.&lt;C.provider&gt;圈定作用域, 传递一个Value , Value一般会给一个读接口和一个写接口*/</span>&#125;</span><br><span class="line">      &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">        &lt;Baba /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>C.Provider&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Baba</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; n, setN &#125; = useContext(C);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      我是爸爸 n: &#123;n&#125; &lt;Child /&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function Child() &#123;</span></span><br><span class="line"><span class="regexp">  const &#123; n, setN &#125; = useContext(C);</span></span><br><span class="line"><span class="regexp">  const onClick = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    setN((i) =&gt; i + 1);</span></span><br><span class="line"><span class="regexp">  &#125;;</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;div&gt;</span></span><br><span class="line"><span class="regexp">      我是儿子 我得到的 n: &#123;n&#125;</span></span><br><span class="line"><span class="regexp">      &lt;button onClick=&#123;onClick&#125;&gt;+1&lt;/</span>button&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const rootElement = document.getElementById("root");</span></span><br><span class="line"><span class="regexp">ReactDOM.render(&lt;App /</span>&gt;, rootElement);</span><br></pre></td></tr></table></figure>

<h3 id="6-useEffect"><a href="#6-useEffect" class="headerlink" title="6. useEffect"></a>6. useEffect</h3><ul>
<li>副作用(API 名字不好)<ul>
<li>对环境的改变即为副作用，如修改 document.title</li>
<li>实际上叫做 afterRender 更好，每次 render 后运行</li>
</ul>
</li>
<li>用途<ul>
<li>作 为 componentDidMount 使用， []作第二个参数</li>
<li>作为 componentDidUpdate 使用，可指定依赖</li>
<li>作为 componentWillUnmount 使用， 通过 return</li>
</ul>
</li>
<li>特点<ul>
<li>如果同时存在多个 useEffect,会按照出现次序执行</li>
<li>案例:<a href="https://codesandbox.io/s/sweet-carson-pzjfc?file=/src/index.js" target="_blank" rel="noopener">https://codesandbox.io/s/sweet-carson-pzjfc?file=/src/index.js</a></li>
</ul>
</li>
<li>什么是副作用，对环境的改变就是副作用，但是副作用没有明确的定义不如理解成 afterRender 比较好记</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useReducer, useContext, useEffect, useState &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [n, setN] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> onClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setN(<span class="function">(<span class="params">i</span>) =&gt;</span> i + <span class="number">1</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"第一次渲染之后执行这一句话"</span>);</span><br><span class="line">  &#125;, []); <span class="comment">// [] 里面的变量变化时再次执行 =&gt; 不会再次执行</span></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"任何一个state变化都执行"</span>);</span><br><span class="line">  &#125;); <span class="comment">// 任何一个state变化都执行</span></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (n !== <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"n变化渲染之后执行这一句话"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [n]); <span class="comment">// n 变化时执行</span></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 实现componentWillUnmount的效果,大部分新手不会去写，但是实际上要养成习惯，对环境做的任何变动都要及时清理</span></span><br><span class="line">    <span class="keyword">const</span> id = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"hi"</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">window</span>.clearInterval(id);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      n: &#123;n&#125;</span><br><span class="line">      &lt;button onClick=&#123;onClick&#125;&gt; +<span class="number">1</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootElement = <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>);</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, rootElement);</span><br></pre></td></tr></table></figure>

<h3 id="7-useLayOutEffect"><a href="#7-useLayOutEffect" class="headerlink" title="7. useLayOutEffect"></a>7. useLayOutEffect</h3><ul>
<li>例子:<a href="https://codesandbox.io/s/useeffect-flash-on-render-l6xfr" target="_blank" rel="noopener">https://codesandbox.io/s/useeffect-flash-on-render-l6xfr</a></li>
<li>和 useEffect 的本质区别 useEffect 是改变屏幕像素之后，useLayOutEffect 是在 dom 元素生成之后，优先用 useEffect</li>
<li>更习惯于用 useEffect，放到浏览器改变外观之后执行，除非 useEffect 不能满足需求，再去考虑 useLayOutEffect,useLayOutEffect 会影响用户看到画面的时间</li>
<li>useLayOutEffect 总是比 useEffect 先执行</li>
<li>useLayOutEffect 里最好是放改变里屏幕外观的操作</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"./styles.css"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> BlinkyRender = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = useState(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">document</span>.querySelector(<span class="string">"#x"</span>).innerText = <span class="string">`value: 1000`</span>;</span><br><span class="line">  &#125;, [value]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div id=<span class="string">"x"</span> onClick=&#123;() =&gt; setValue(<span class="number">0</span>)&#125;&gt;</span><br><span class="line">      value: &#123;value&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">ReactDOM.render(&lt;BlinkyRender /</span>&gt;, <span class="built_in">document</span>.querySelector(<span class="string">"#root"</span>));</span><br></pre></td></tr></table></figure>

<ul>
<li>见下图</li>
</ul>
<h3 id="8-useMemo"><a href="#8-useMemo" class="headerlink" title="8. useMemo"></a>8. useMemo</h3><ul>
<li>特点<ul>
<li>第一个参数是()=&gt;value</li>
<li>第二个参数是依赖[m,n]</li>
<li>只有当依赖变化时，才会计算出新的 value</li>
<li>如果依赖不变，那么就重用之前的 value</li>
<li>可以理解为 Vue2 的 computed</li>
</ul>
</li>
<li>注意<ul>
<li>如果 value 是个函数，就需要写成 useMemo(()=&gt;(x)=&gt;console.log(x))</li>
<li>这是一个返回函数的函数</li>
<li>但是这样很难用，于是就有了 useCallback</li>
</ul>
</li>
<li>memo 例子，<a href="https://codesandbox.io/s/dawn-sun-00023" target="_blank" rel="noopener">https://codesandbox.io/s/dawn-sun-00023</a></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"./styles.css"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [n, setN] = React.useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [m, setM] = React.useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> onClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setN(n + <span class="number">1</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;button onClick=&#123;onClick&#125;&gt;update n &#123;n&#125;&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">      &lt;Child2 data=&#123;m&#125; /&gt;</span><br><span class="line">      &#123;<span class="comment">/* &lt;Child2 data=&#123;m&#125;/&gt; */</span>&#125;</span><br><span class="line">      &#123;<span class="comment">/*用memo封装一下，写成这样子就不会再词刷新,memo使得一个组件只有在其props变化的时候才会执行*/</span>&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function Child(props) &#123;</span></span><br><span class="line"><span class="regexp">  console.log("child 执行了");</span></span><br><span class="line"><span class="regexp">  console.log("假设这里有大量代码");</span></span><br><span class="line"><span class="regexp">  return &lt;div&gt;child: &#123;props.data&#125;&lt;/</span>div&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Child2 = React.memo(Child);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootElement = <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>);</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, rootElement);</span><br></pre></td></tr></table></figure>

<ul>
<li>memo 的 bug</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"./styles.css"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [n, setN] = React.useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [m, setM] = React.useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> onClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setN(n + <span class="number">1</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> onClickChild = <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;; <span class="comment">// 这一句话重新执行了, 函数是一个对象，第一次和第二次的值是不一样的</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;button onClick=&#123;onClick&#125;&gt;update n &#123;n&#125;&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">      &lt;Child2 data=&#123;m&#125; onClick=&#123;onClickChild&#125; /&gt;</span><br><span class="line">      &#123;<span class="comment">/*这样写n变化了child2执行了，这是个bug，原因是因为app重新执行了*/</span>&#125;</span><br><span class="line">      &#123;<span class="comment">/* &lt;Child2 data=&#123;m&#125;/&gt; */</span>&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function Child(props) &#123;</span></span><br><span class="line"><span class="regexp">  console.log("child 执行了");</span></span><br><span class="line"><span class="regexp">  console.log("假设这里有大量代码");</span></span><br><span class="line"><span class="regexp">  return &lt;div onClick=&#123;props.onClick&#125;&gt;child: &#123;props.data&#125;&lt;/</span>div&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Child2 = React.memo(Child);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootElement = <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>);</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, rootElement);</span><br></pre></td></tr></table></figure>

<ul>
<li>reactMemo 使得一个组件只有在 props 变化的时候再执行一遍</li>
<li>会有 bug,加了 onClick 会有问题，需要使用 usememo,见例子,<a href="https://codesandbox.io/s/bold-sunset-g9136" target="_blank" rel="noopener">https://codesandbox.io/s/bold-sunset-g9136</a></li>
<li>通过 usememo 解决 memo 的 bug,usememo 用于组件更新时，缓存上一次组件</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useMemo &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"./styles.css"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [n, setN] = React.useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [m, setM] = React.useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> onClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setN(n + <span class="number">1</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> onClickChild = useMemo(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;;</span><br><span class="line">  &#125;, [m]);</span><br><span class="line">  <span class="comment">// 通过usememo解决函数变了重新刷新的bug, 只有m变化了才会变</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;button onClick=&#123;onClick&#125;&gt;update n &#123;n&#125;&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">      &lt;Child2 data=&#123;m&#125; onClick=&#123;onClickChild&#125; /&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function Child(props) &#123;</span></span><br><span class="line"><span class="regexp">  console.log("child 执行了");</span></span><br><span class="line"><span class="regexp">  console.log("假设这里有大量代码");</span></span><br><span class="line"><span class="regexp">  return &lt;div onClick=&#123;props.onClick&#125;&gt;child: &#123;props.data&#125;&lt;/</span>div&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Child2 = React.memo(Child);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootElement = <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>);</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, rootElement);</span><br></pre></td></tr></table></figure>

<ul>
<li>useCallback 语法糖可以直接写一个函数</li>
<li>用法<ul>
<li>useCallback(x=&gt;log(x),[m])等价于</li>
<li>useMemo(()=&gt;x=&gt;log(x),[m])</li>
</ul>
</li>
</ul>
<h3 id="9-useRef"><a href="#9-useRef" class="headerlink" title="9 . useRef"></a>9 . useRef</h3><ul>
<li>目的<ul>
<li>如果你需要一个值，在组件不断 render 时保持不变
useState/useReducer n 每次变，ussMemo/useCallback [m]变的时候,fn 变，useRef 永远不变</li>
<li>初始化: const count = useRef(0)</li>
<li>读取: count.current</li>
<li>为什么需要current?</li>
<li>为了保证两次useRef是同一个值(只有引用能做到)</li>
</ul>
</li>
<li>延伸<ul>
<li>看看Vue3的ref</li>
<li>初始化: const count = ref(0)</li>
<li>读取: count.value</li>
<li>不同点: 当count.value变化时， Vue3会自动render，react要手动render</li>
</ul>
</li>
<li>useRef案例<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;useEffect, useMemo, useRef&#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"./styles.css"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> count = useRef(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [n, setN] = React.useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> onClick = <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    setN(n + <span class="number">9</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    count.current+=<span class="number">1</span></span><br><span class="line">    <span class="built_in">console</span>.log(count.current)</span><br><span class="line">    <span class="comment">// 通过useRef记录渲染的次数</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;button onClick=&#123;onClick&#125;&gt;update n &#123;n&#125;&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const rootElement = document.getElementById("root");</span></span><br><span class="line"><span class="regexp">ReactDOM.render(&lt;App /</span>&gt;, rootElement);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="10-forwardRef"><a href="#10-forwardRef" class="headerlink" title="10. forwardRef"></a>10. forwardRef</h3><ul>
<li><p>基本用法: 让函数组件Button2支持ref</p>
</li>
<li><p>代码1: props无法传递ref属性</p>
</li>
<li><p>代码2: 实现ref的传递</p>
</li>
<li><p>代码3: 两次ref传递得到button的引用</p>
</li>
<li><p>useRef</p>
<ul>
<li>可以用来引用DOM对象</li>
<li>也可以用来引用普通对象</li>
</ul>
</li>
<li><p>forwardRef</p>
<ul>
<li>由于props不包含ref,所以需要forwardRef</li>
<li>ref基础案例<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useRef &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"./styles.css"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> buttonRef = useRef(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;Button3 ref=&#123;buttonRef&#125;&gt;按钮&lt;<span class="regexp">/Button3&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Button2 = <span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(props);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'ref'</span>, ref)</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">"red"</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 总结: 如果一个函数组件想要接收别人传来的参数，自己必须用forwardRef包起来</span></span><br><span class="line"><span class="keyword">const</span> Button3 = React.forwardRef(Button2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootElement = <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>);</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, rootElement);</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>为什么props不包含ref呢？因为大部分时候不需要</p>
<ul>
<li>props 无法传递 ref 属性,<a href="https://codesandbox.io/s/snowy-dust-g9i0w" target="_blank" rel="noopener">https://codesandbox.io/s/snowy-dust-g9i0w</a></li>
<li>实现 ref 的传递,<a href="https://codesandbox.io/s/crazy-matsumoto-6l6mh" target="_blank" rel="noopener">https://codesandbox.io/s/crazy-matsumoto-6l6mh</a></li>
<li>两次 ref 传递得到 button 的引用,<a href="https://codesandbox.io/s/amazing-snow-9f5g3" target="_blank" rel="noopener">https://codesandbox.io/s/amazing-snow-9f5g3</a></li>
</ul>
</li>
</ul>
<h3 id="11-useImperativeHandle"><a href="#11-useImperativeHandle" class="headerlink" title="11. useImperativeHandle"></a>11. useImperativeHandle</h3><ul>
<li>应该叫做 setRef,目的就是对Ref做一层包装达到一些目的,很少用</li>
<li>不用 useImperativeHandle <a href="https://codesandbox.io/s/awesome-goldwasser-v7vsp" target="_blank" rel="noopener">https://codesandbox.io/s/awesome-goldwasser-v7vsp</a><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;useEffect, useRef&#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"./styles.css"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> buttonRef = useRef(<span class="literal">null</span>);</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(buttonRef.current)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;Button3 ref=&#123;buttonRef&#125;&gt;按钮&lt;<span class="regexp">/Button3&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Button2 = <span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(props);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'ref'</span>, ref) <span class="comment">// 使用ref来获取dom</span></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">"red"</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 总结: 如果一个函数组件想要接收别人传来的参数，自己必须用forwardRef包起来</span></span><br><span class="line"><span class="keyword">const</span> Button3 = React.forwardRef(Button2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootElement = <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>);</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, rootElement);</span><br></pre></td></tr></table></figure></li>
<li>用了 useImperativeHandle <a href="https://codesandbox.io/s/elegant-poitras-mxoym" target="_blank" rel="noopener">https://codesandbox.io/s/elegant-poitras-mxoym</a></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;</span><br><span class="line">  useRef,</span><br><span class="line">  useState,</span><br><span class="line">  useEffect,</span><br><span class="line">  useImperativeHandle,</span><br><span class="line">  createRef</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"./styles.css"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> buttonRef = useRef(<span class="literal">null</span>);</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(buttonRef.current);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;Button2 ref=&#123;buttonRef&#125;&gt;按钮&lt;<span class="regexp">/Button2&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button</span></span><br><span class="line"><span class="regexp">        className="close"</span></span><br><span class="line"><span class="regexp">        onClick=&#123;() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">          console.log(buttonRef);</span></span><br><span class="line"><span class="regexp">          buttonRef.current.x();</span></span><br><span class="line"><span class="regexp">        &#125;&#125;</span></span><br><span class="line"><span class="regexp">      &gt;</span></span><br><span class="line"><span class="regexp">        x</span></span><br><span class="line"><span class="regexp">      &lt;/</span>button&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const Button2 = React.forwardRef((props, ref) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  const realButton = createRef(null);</span></span><br><span class="line"><span class="regexp">  const setRef = useImperativeHandle;</span></span><br><span class="line"><span class="regexp">  setRef(ref, () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    return &#123;</span></span><br><span class="line"><span class="regexp">      x: () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">        realButton.current.remove();</span></span><br><span class="line"><span class="regexp">      &#125;,</span></span><br><span class="line"><span class="regexp">      realButton: realButton</span></span><br><span class="line"><span class="regexp">    &#125;;</span></span><br><span class="line"><span class="regexp">  &#125;);</span></span><br><span class="line"><span class="regexp">  return &lt;button ref=&#123;realButton&#125; &#123;...props&#125; /</span>&gt;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootElement = <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>);</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, rootElement);</span><br></pre></td></tr></table></figure>


<h3 id="12-自定义-hook-可能是ReactHook最牛的功能"><a href="#12-自定义-hook-可能是ReactHook最牛的功能" class="headerlink" title="12. 自定义 hook,可能是ReactHook最牛的功能"></a>12. 自定义 hook,可能是ReactHook最牛的功能</h3><ul>
<li>简单例子，<a href="https://codesandbox.io/s/wizardly-tesla-sy077" target="_blank" rel="noopener">https://codesandbox.io/s/wizardly-tesla-sy077</a><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useRef, useState, useEffect &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="keyword">import</span> useList <span class="keyword">from</span> <span class="string">"./hooks/useList"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; list, setList &#125; = useList();</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;h1&gt;List&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &#123;list ? (</span></span><br><span class="line"><span class="regexp">        &lt;ol&gt;</span></span><br><span class="line"><span class="regexp">          &#123;list.map(item =&gt; (</span></span><br><span class="line"><span class="regexp">            &lt;li key=&#123;item.id&#125;&gt;&#123;item.name&#125;&lt;/</span>li&gt;</span><br><span class="line">          ))&#125;</span><br><span class="line">        &lt;<span class="regexp">/ol&gt;</span></span><br><span class="line"><span class="regexp">      ) : (</span></span><br><span class="line"><span class="regexp">        "加载中..."</span></span><br><span class="line"><span class="regexp">      )&#125;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootElement = <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>);</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, rootElement);</span><br></pre></td></tr></table></figure></li>
<li>hooks/useList.js<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useList = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [list, setList] = useState(<span class="literal">null</span>);</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    ajax(<span class="string">"/list"</span>).then(<span class="function"><span class="params">list</span> =&gt;</span> &#123;</span><br><span class="line">      setList(list);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, []); <span class="comment">// [] 确保只在第一次运行</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    list: list,</span><br><span class="line">    setList: setList</span><br><span class="line">  &#125;; <span class="comment">// 读接口和写接口return出去，</span></span><br><span class="line">  <span class="comment">// 引用函数的人调用函数就可以得到读接口和写接口</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useList;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      resolve([</span><br><span class="line">        &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">"Frank"</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">"Jack"</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">"Alice"</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">id</span>: <span class="number">4</span>, <span class="attr">name</span>: <span class="string">"Bob"</span> &#125;</span><br><span class="line">      ]);</span><br><span class="line">    &#125;, <span class="number">2000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>贴心例子，<a href="https://codesandbox.io/s/recursing-darkness-zuo4b" target="_blank" rel="noopener">https://codesandbox.io/s/recursing-darkness-zuo4b</a><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js, 增删改查四个接口</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useRef, useState, useEffect &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="keyword">import</span> useList <span class="keyword">from</span> <span class="string">"./hooks/useList"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; list, deleteIndex &#125; = useList();</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;h1&gt;List&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &#123;list ? (</span></span><br><span class="line"><span class="regexp">        &lt;ol&gt;</span></span><br><span class="line"><span class="regexp">          &#123;list.map((item, index) =&gt; (</span></span><br><span class="line"><span class="regexp">            &lt;li key=&#123;item.id&#125;&gt;</span></span><br><span class="line"><span class="regexp">              &#123;item.name&#125;</span></span><br><span class="line"><span class="regexp">              &lt;button</span></span><br><span class="line"><span class="regexp">                onClick=&#123;() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">                  deleteIndex(index);</span></span><br><span class="line"><span class="regexp">                &#125;&#125;</span></span><br><span class="line"><span class="regexp">              &gt;</span></span><br><span class="line"><span class="regexp">                x</span></span><br><span class="line"><span class="regexp">              &lt;/</span>button&gt;</span><br><span class="line">            &lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">          ))&#125;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>ol&gt;</span><br><span class="line">      ) : (</span><br><span class="line">        <span class="string">"加载中..."</span></span><br><span class="line">      )&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const rootElement = document.getElementById("root");</span></span><br><span class="line"><span class="regexp">ReactDOM.render(&lt;App /</span>&gt;, rootElement);</span><br></pre></td></tr></table></figure></li>
<li>useList<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useList = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [list, setList] = useState(<span class="literal">null</span>);</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    ajax(<span class="string">"/list"</span>).then(<span class="function"><span class="params">list</span> =&gt;</span> &#123;</span><br><span class="line">      setList(list);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;, []); <span class="comment">// [] 确保只在第一次运行</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    list: list,</span><br><span class="line">    addItem: <span class="function"><span class="params">name</span> =&gt;</span> &#123;</span><br><span class="line">      setList([...list, &#123; <span class="attr">id</span>: <span class="built_in">Math</span>.random(), <span class="attr">name</span>: name &#125;]);</span><br><span class="line">    &#125;,</span><br><span class="line">    deleteIndex: <span class="function"><span class="params">index</span> =&gt;</span> &#123;</span><br><span class="line">      setList(list.slice(<span class="number">0</span>, index).concat(list.slice(index + <span class="number">1</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useList;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      resolve([</span><br><span class="line">        &#123; <span class="attr">id</span>: <span class="string">"1"</span>, <span class="attr">name</span>: <span class="string">"Frank"</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">id</span>: <span class="string">"2"</span>, <span class="attr">name</span>: <span class="string">"Jack"</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">id</span>: <span class="string">"3"</span>, <span class="attr">name</span>: <span class="string">"Alice"</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">id</span>: <span class="string">"4"</span>, <span class="attr">name</span>: <span class="string">"Bob"</span> &#125;</span><br><span class="line">      ]);</span><br><span class="line">    &#125;, <span class="number">2000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>分析<ul>
<li>还可以在自定义Hook里使用Context</li>
<li>useState只说了不能在if里运行，没说不能在函数里运行，只要这个函数在函数组件里运行即可</li>
</ul>
</li>
</ul>
<h3 id="13-stale-closure"><a href="#13-stale-closure" class="headerlink" title="13. stale closure"></a>13. stale closure</h3><ul>
<li>陈旧的闭包<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createIncrement</span>(<span class="params">i</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> value = <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">increment</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    value += i;</span><br><span class="line">    <span class="built_in">console</span>.log(value)</span><br><span class="line">    <span class="keyword">const</span> message = <span class="string">`Current value is <span class="subst">$&#123;value&#125;</span>`</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">logValue</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(message)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> increment</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> inc = createIncrement(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">const</span> log = inc(); <span class="comment">// logs1 // 这就是一个过时的log</span></span><br><span class="line">inc(); <span class="comment">// logs 2</span></span><br><span class="line">inc(); <span class="comment">// logs 3</span></span><br><span class="line"><span class="comment">// Does not work</span></span><br><span class="line">log(); <span class="comment">// logs "Current value is 1"</span></span><br></pre></td></tr></table></figure></li>
<li>解决过时的闭包的问题，每次log前，重新取log的值<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createIncrement</span>(<span class="params">i</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> value = <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">increment</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    value += i;</span><br><span class="line">    <span class="built_in">console</span>.log(value)</span><br><span class="line">    <span class="keyword">const</span> message = <span class="string">`Current value is <span class="subst">$&#123;value&#125;</span>`</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">logValue</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(message)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> increment</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> inc = createIncrement(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">const</span> log = inc(); <span class="comment">// logs1 // 这就是一个过时的log</span></span><br><span class="line">inc(); <span class="comment">// logs 2</span></span><br><span class="line">inc(); <span class="comment">// logs 3</span></span><br><span class="line"><span class="comment">// Does not work</span></span><br><span class="line">log(); <span class="comment">// logs "Current value is 1"</span></span><br></pre></td></tr></table></figure></li>
<li>第二种方式把message放到log执行了之后<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createIncrement</span>(<span class="params">i</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> value = <span class="number">0</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">increment</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    value += i;</span><br><span class="line">    <span class="built_in">console</span>.log(value)</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">logValue</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">const</span> message = <span class="string">`Current value is <span class="subst">$&#123;value&#125;</span>`</span>;</span><br><span class="line">      <span class="comment">// 调用log的时候取最新的value</span></span><br><span class="line">      <span class="built_in">console</span>.log(message)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> increment</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> inc = createIncrement(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">const</span> log = inc(); <span class="comment">// logs1 // 这就是一个过时的log</span></span><br><span class="line">inc(); <span class="comment">// logs 2</span></span><br><span class="line">inc(); <span class="comment">// logs 3</span></span><br><span class="line"><span class="comment">// Does not work</span></span><br><span class="line">log(); <span class="comment">// logs "Current value is 1"</span></span><br></pre></td></tr></table></figure></li>
<li>react中的体现<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">WatchCount</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    setInterval(<span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`Count is: <span class="subst">$&#123;count&#125;</span>`</span>); </span><br><span class="line">      <span class="comment">// 永远不变,log和count组成了一个过时的闭包</span></span><br><span class="line">    &#125;, <span class="number">2000</span>);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;count&#125;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setCount(count + <span class="number">1</span>) &#125;&gt;</span><br><span class="line">        Increase</span><br><span class="line">      &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>解决办法<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">WatchCount</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> id = setInterval(<span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`Count is: <span class="subst">$&#123;count&#125;</span>`</span>);</span><br><span class="line">    &#125;, <span class="number">2000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      clearInterval(id);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [count]); </span><br><span class="line">  <span class="comment">// 把count放到依赖，只要count一变化就就重新渲染</span></span><br><span class="line">  <span class="comment">// Vue3不会有这个问题，Vue3用的是Ref永远用的是同一个 </span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;count&#125;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setCount(count + <span class="number">1</span>) &#125;&gt;</span><br><span class="line">        Increase</span><br><span class="line">      &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;<span class="string">`</span></span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="codingories.github.io/2020/04/21/Django-REST-framework-Vue-%E6%89%93%E9%80%A0%E7%94%9F%E9%B2%9C%E8%B6%85%E5%B8%82%EF%BC%88%E4%B8%80%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://i.loli.net/2020/07/12/RPjkZxei6agC49U.jpg">
      <meta itemprop="name" content="Ories">
      <meta itemprop="description" content="这个博客用来记录自己的生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OriesノBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/21/Django-REST-framework-Vue-%E6%89%93%E9%80%A0%E7%94%9F%E9%B2%9C%E8%B6%85%E5%B8%82%EF%BC%88%E4%B8%80%EF%BC%89/" class="post-title-link" itemprop="url">Django REST framework+Vue 打造生鲜超市（一）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-04-21 09:13:10 / Modified: 09:46:16" itemprop="dateCreated datePublished" datetime="2020-04-21T09:13:10+08:00">2020-04-21</time>
            </span>

          
            <span id="/2020/04/21/Django-REST-framework-Vue-%E6%89%93%E9%80%A0%E7%94%9F%E9%B2%9C%E8%B6%85%E5%B8%82%EF%BC%88%E4%B8%80%EF%BC%89/" class="post-meta-item leancloud_visitors" data-flag-title="Django REST framework+Vue 打造生鲜超市（一）" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2020/04/21/Django-REST-framework-Vue-%E6%89%93%E9%80%A0%E7%94%9F%E9%B2%9C%E8%B6%85%E5%B8%82%EF%BC%88%E4%B8%80%EF%BC%89/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/04/21/Django-REST-framework-Vue-%E6%89%93%E9%80%A0%E7%94%9F%E9%B2%9C%E8%B6%85%E5%B8%82%EF%BC%88%E4%B8%80%EF%BC%89/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="1-掌握的技术"><a href="#1-掌握的技术" class="headerlink" title="1. 掌握的技术"></a>1. 掌握的技术</h4><ol>
<li>Vue + Django Rest Framework 前后端分离技术</li>
<li>彻底玩转 restful api 开发流程</li>
<li>Django Rest Framework 的功能实现和核心源码分析</li>
<li>Sentry 完成线上系统的错误日志的监控和告警</li>
<li>第三方登录和支付宝支付的集成</li>
<li>本地调试远程服务器代码的技巧</li>
</ol>
<h4 id="2-系统构成"><a href="#2-系统构成" class="headerlink" title="2. 系统构成"></a>2. 系统构成</h4><ol>
<li><p> vue 前端项目</p>
</li>
<li><p> django rest framework 系统实现前台功能</p>
</li>
<li><p> xadmin 后台管理系统</p>
</li>
<li><p>vue 部分:</p>
<ul>
<li>API 接口</li>
<li>Vue 组件 与 api 的交互</li>
<li>vue 的项目组织结构分析</li>
</ul>
</li>
<li><p>Django Rest Framework 技能</p>
<ul>
<li>通用 view 实现 rest api 接口<ul>
<li>Apiview 方式实现 api</li>
<li>genericView 方式实现 api 接口</li>
<li>Viewset 和 router 方式实现 api 接口和 url 配置</li>
<li>Django_filter searchFilter - OrderFilter 分页</li>
<li>通用 mixin</li>
</ul>
</li>
<li>权限和认证；<ul>
<li>Authentication 用户认证设置</li>
<li>动态设置 permission、authentication</li>
<li>Validators 实现字段验证</li>
</ul>
</li>
<li>序列化和表单验证<ul>
<li>Serializer</li>
<li>ModelSerializer</li>
<li>动态设置 Serializer</li>
</ul>
</li>
<li>支付登录注册<ul>
<li>json web token 实现登录</li>
<li>手机注册</li>
<li>支付宝支付</li>
<li>第三方登录</li>
</ul>
</li>
<li>进阶开发<ul>
<li>Django rest framework 部分核心源码解读</li>
<li>文档自动化管理</li>
<li>django rest framework 的缓存</li>
<li>throttling 对用户和 ip 进行限速</li>
</ul>
</li>
</ul>
</li>
</ol>
<h4 id="3-开发中常见的问题"><a href="#3-开发中常见的问题" class="headerlink" title="3. 开发中常见的问题"></a>3. 开发中常见的问题</h4><ol>
<li>本地系统不能重现的 bug</li>
<li>api 接口出错不能及时的发现或难以找到错误栈</li>
<li>api 文档管理问题，html markdown</li>
<li>大量的 url 配置造成 url 配置越来越多难以维护</li>
<li>接口不及时去更新文档，对方不知道如何去测试接口，但写文档会花费大量的时间去维护.</li>
<li>为了防止爬虫，我们需要针对 api 的访问频率进行限制，比如一分钟，一小时，或者一天用户的访问频率限制问题。</li>
<li>某些页面将数据放入缓存，加速某些 api 的访问速度</li>
</ol>
<h4 id="4-开发中常见问题解决方案"><a href="#4-开发中常见问题解决方案" class="headerlink" title="4. 开发中常见问题解决方案"></a>4. 开发中常见问题解决方案</h4><ol>
<li>通过介绍 pycharm 的远程服务器代码调试技巧让大家不仅可以调试支付，第三方登录，还可以远程服务器代码来重现服务器上的 bug</li>
<li>通过 docker 搭建 sentry 来体验错误日志监控系统，让我们不仅可以得到线上的错误栈还能及时在发生系统错误时收到邮件通知。</li>
<li>通过 drf 的文档自动化管理以及 url 的注册管理功能会让我们省去写文档的时间</li>
<li>django rest framework 的文档管理功能不仅可以让我们省去写文档的时间，还能直接在文档里面测试接口，自动生成 js 接口代码，shell 测试代码和 python 测试代码</li>
<li>django rest framework 提供的 throttle 对于 api 进行访问频率的限制</li>
<li>引入第三方框架来设置某些 api 的缓存</li>
</ol>
<h4 id="5-django-进阶知识点"><a href="#5-django-进阶知识点" class="headerlink" title="5. django 进阶知识点"></a>5. django 进阶知识点</h4><ol>
<li> django mirgrations 原理</li>
<li> django 信号量</li>
<li> django 从请求到响应的完整过程</li>
<li> 独立使用 django 的 model</li>
</ol>
<h4 id="6-vue-知识点"><a href="#6-vue-知识点" class="headerlink" title="6.vue 知识点"></a>6.vue 知识点</h4><ol>
<li>vue 技术选型分析</li>
<li>API 后端数据填充到 Vue 组件模板</li>
<li>Vue 代码结构分析</li>
</ol>
<h4 id="7-章节安排"><a href="#7-章节安排" class="headerlink" title="7.章节安排"></a>7.章节安排</h4><ol>
<li>项目介绍以及开发环境的搭建</li>
<li>设计数据库以及导入原始数据</li>
<li>restful api 基础以及 vue 项目结构介绍</li>
<li>商品列表页功能</li>
<li>商品类别功能</li>
<li>手机注册和用户登录</li>
<li>商品详情页和收藏功能</li>
<li>个人中心功能</li>
<li>购物车、订单和支付宝支付功能</li>
<li>首页，商品相关数量，缓存，访问限速功能</li>
<li>第三方登录(微博 qq 微信)</li>
<li>sentry 系统错误日志监控</li>
</ol>
<h4 id="8-技术储备要求"><a href="#8-技术储备要求" class="headerlink" title="8.技术储备要求"></a>8.技术储备要求</h4><ol>
<li>django 基础知识</li>
<li>熟练掌握 python 语法</li>
<li>了解 vue &amp; mysql 基础</li>
</ol>
<h4 id="9-系统功能"><a href="#9-系统功能" class="headerlink" title="9.系统功能"></a>9.系统功能</h4><ol>
<li>分类 - 子分类 搜索 热搜词 购物车简要展示</li>
<li>新品 分类展示， 大类的推荐商品。</li>
<li>账户密码登录(json web token)。微博登录，输入账户跳转回首页。</li>
<li>注册，手机号码注册，错误提示。倒计时功能，服务器端手机号码发送频次限制。</li>
<li>商品大类，导航栏。筛选，排序。富文本。</li>
<li>商品 收藏 加入购物车 结算，移出购物车</li>
<li>留言 支付宝支付，扫码支付。跳回商户页面。</li>
<li>订单详情，收货地址</li>
<li>个人信息，收藏商品，我的收藏。</li>
<li>留言，上传文件。提交，删除留言</li>
<li>快速浏览。页面的缓存</li>
<li>访问速度限制 &amp; 接口文档 测试交互</li>
<li>出错处理: sentry 基于 drf。打印错误栈，当前请求用户。邮件通知</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="codingories.github.io/2020/04/02/django3%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://i.loli.net/2020/07/12/RPjkZxei6agC49U.jpg">
      <meta itemprop="name" content="Ories">
      <meta itemprop="description" content="这个博客用来记录自己的生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OriesノBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/02/django3%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">django3学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-04-02 15:58:21" itemprop="dateCreated datePublished" datetime="2020-04-02T15:58:21+08:00">2020-04-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-04-03 14:28:17" itemprop="dateModified" datetime="2020-04-03T14:28:17+08:00">2020-04-03</time>
              </span>

          
            <span id="/2020/04/02/django3%E5%AD%A6%E4%B9%A0/" class="post-meta-item leancloud_visitors" data-flag-title="django3学习" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2020/04/02/django3%E5%AD%A6%E4%B9%A0/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/04/02/django3%E5%AD%A6%E4%B9%A0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ol>
<li><p>确认一下你的 Django 项目是否真的创建成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py runserver</span><br></pre></td></tr></table></figure>

<p>更改端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python manage.py runserver 8080</span><br><span class="line">$ python manage.py runserver 0:8000 &#x2F;&#x2F; 需要设置下hosts</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建投票应用 app ,一个 django 项目中可以有很多 app</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python manage.py startapp polls</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建 polls/views.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from django.http import HttpResponse</span><br><span class="line">def index(request):</span><br><span class="line">    return HttpResponse(&quot;Hello, world. You&#39;re at the polls index.&quot;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建 polls/urls.py，将其映射到 polls/views</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from django.urls import path</span><br><span class="line">from . import views</span><br><span class="line"></span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    path(&#39;&#39;, views.index, name&#x3D;&#39;index&#39;),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改 mysite/urls.py 文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from django.contrib import admin</span><br><span class="line">from django.urls import include, path</span><br><span class="line"></span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line"># 函数 include() 允许引用其它 URLconfs。每当 Django 遇到 include() 时，它会截断与此项匹配的 URL 的部分，并将剩余的字符串发送到 URLconf 以供进一步处理。</span><br><span class="line">path(&#39;polls&#x2F;&#39;, include(&#39;polls.urls&#39;)),</span><br><span class="line">path(&#39;admin&#x2F;&#39;, admin.site.urls),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><p>验证目前为止是否正常工作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python manage.py runserver</span><br><span class="line">&lt;!-- http:&#x2F;&#x2F;localhost:8000&#x2F;polls&#x2F; --&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>写在 urlpatterns 中的 patterns 函数</p>
</li>
</ol>
<ul>
<li>函数 path() 具有四个参数，两个必须参数：route 和 view，两个可选参数：kwargs 和 name。<ol>
<li>path() 参数： route
route 是一个匹配 URL 的准则（类似正则表达式）。当 Django 响应一个请求时，它会从 urlpatterns 的第一项开始，按顺序依次匹配列表中的项，直到找到匹配的项。</li>
<li>path() 参数： view
当 Django 找到了一个匹配的准则，就会调用这个特定的视图函数，并传入一个 HttpRequest 对象作为第一个参数，被“捕获”的参数以关键字参数的形式传入。稍后，我们会给出一个例子。</li>
<li>path() 参数： kwargs
任意个关键字参数可以作为一个字典传递给目标视图函数。本教程中不会使用这一特性。</li>
<li>path() 参数： name
为你的 URL 取名能使你在 Django 的任意地方唯一地引用它，尤其是在模板中。这个有用的特性允许你只改一个文件就能全局地修改某个 URL 模式。</li>
</ol>
</li>
</ul>
<ol start="8">
<li><p>配置数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ENGINE -- 可选值有 &#39;django.db.backends.sqlite3&#39;，&#39;django.db.backends.postgresql&#39;，&#39;django.db.backends.mysql&#39;，或 &#39;django.db.backends.oracle&#39;</span><br><span class="line">编辑 mysite&#x2F;settings.py 文件前，先设置 TIME_ZONE 为你自己时区。</span><br><span class="line">INSTALLED_APPS 默认包括了以下 Django 的自带应用：</span><br><span class="line">django.contrib.admin -- 管理员站点， 你很快就会使用它。</span><br><span class="line">django.contrib.auth -- 认证授权系统。</span><br><span class="line">django.contrib.contenttypes -- 内容类型框架。</span><br><span class="line">django.contrib.sessions -- 会话框架。</span><br><span class="line">django.contrib.messages -- 消息框架。</span><br><span class="line">django.contrib.staticfiles -- 管理静态文件的框架。</span><br><span class="line">默认开启的某些应用需要至少一个数据表，所以，在使用他们之前需要在数据库中创建一些表。请执行以下命令：</span><br><span class="line">$ python manage.py migrate</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写模型 polls/models.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line"></span><br><span class="line">class Question(models.Model):</span><br><span class="line">  question_text &#x3D; models.CharField(max_length&#x3D;200)</span><br><span class="line">  pub_date &#x3D; models.DateTimeField(&#39;date published&#39;) # 定义字段别名</span><br><span class="line"></span><br><span class="line">class Choice(models.Model):</span><br><span class="line">  question &#x3D; models.ForeignKey(Question, on_delete&#x3D;models.CASCADE)</span><br><span class="line">  choice_text &#x3D; models.CharField(max_length&#x3D;200)</span><br><span class="line">  votes &#x3D; models.IntegerField(default&#x3D;0)</span><br></pre></td></tr></table></figure>
</li>
<li><p>增加 polls app</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS &#x3D; [</span><br><span class="line">    &#39;polls.apps.PollsConfig&#39;,</span><br><span class="line">    &#39;django.contrib.admin&#39;,</span><br><span class="line">    &#39;django.contrib.auth&#39;,</span><br><span class="line">    &#39;django.contrib.contenttypes&#39;,</span><br><span class="line">    &#39;django.contrib.sessions&#39;,</span><br><span class="line">    &#39;django.contrib.messages&#39;,</span><br><span class="line">    &#39;django.contrib.staticfiles&#39;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><p>激活模型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations polls</span><br><span class="line"># 通过运行 makemigrations 命令，Django 会检测你对模型文件的修改（在这种情况下，你已经取得了新的），并且把修改的部分储存为一次 迁移。</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Django 有一个自动执行数据库迁移并同步管理你的数据库结构的命令 - 这个命令是 migrate，之后会使用到。</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># sqlmigrate 命令接收一个迁移的名称，然后返回对应的 SQL：</span><br><span class="line">python manage.py sqlmigrate polls 0001</span><br><span class="line">再次运行 migrate 命令，在数据库里创建新定义的模型的数据表：</span><br><span class="line">python manage.py migrate</span><br><span class="line">总结:</span><br><span class="line">编辑 models.py 文件，改变模型。</span><br><span class="line">运行 python manage.py makemigrations 为模型的改变生成迁移文件。</span><br><span class="line">运行 python manage.py migrate 来应用数据库迁移。</span><br><span class="line"></span><br><span class="line"># 检测项目问题</span><br><span class="line">python manage.py check</span><br><span class="line"></span><br><span class="line"># 再次迁移数据</span><br><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure>
</li>
<li><p>总结:改变模型需要这 3 步</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">编辑 models.py 文件，改变模型。</span><br><span class="line">运行 python manage.py makemigrations 为模型的改变生成迁移文件。</span><br><span class="line">运行 python manage.py migrate 来应用数据库迁移。</span><br></pre></td></tr></table></figure>
</li>
<li><p>初试 API</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">python manage.py shell</span><br><span class="line">from polls.models import Choice, Question # 引入写的模型类</span><br><span class="line">Question.objects.all()</span><br><span class="line">from django.utils import timezone</span><br><span class="line">q &#x3D; Question(question_text&#x3D;&quot;What&#39;s new?&quot;, pub_date&#x3D;timezone.now())</span><br><span class="line">q.save()</span><br><span class="line">q.id</span><br><span class="line">q.question_text</span><br><span class="line">q.pub_date</span><br><span class="line">q.question_text &#x3D; &quot;What&#39;s up?&quot;</span><br><span class="line">q.save()</span><br><span class="line">Question.objects.all()</span><br><span class="line"># &lt;QuerySet [&lt;Question: Question object (1)&gt;]&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>编辑 Question 模型的代码,给 Question 和 Choice 增加 <strong>str</strong> () 方法和自定义方法，方便显示。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line">class Question(models.Model):</span><br><span class="line">    question_text &#x3D; models.CharField(max_length&#x3D;200)</span><br><span class="line">    pub_date &#x3D; models.DateTimeField(&#39;date published&#39;)</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.question_text</span><br><span class="line"></span><br><span class="line">    def was_published_recently(self):</span><br><span class="line">        return self.pub_date &gt;&#x3D; timezone.now() - datetime.timedelta(days&#x3D;1)</span><br><span class="line">class Choice(models.Model):</span><br><span class="line">    question &#x3D; models.ForeignKey(Question, on_delete&#x3D;models.CASCADE)</span><br><span class="line">    choice_text &#x3D; models.CharField(max_length&#x3D;200)</span><br><span class="line">    votes &#x3D; models.IntegerField(default&#x3D;0)</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        return self.choice_text</span><br></pre></td></tr></table></figure>
</li>
<li><p>再次通过 python manage.py shell 命令行来查看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from polls.models import Choice, Question</span><br><span class="line">Question.objects.all()</span><br><span class="line">Question.objects.filter(id&#x3D;1)</span><br><span class="line">from django.utils import timezone</span><br><span class="line">current_year &#x3D; timezone.now().year</span><br><span class="line">Question.objects.get(pub_date__year&#x3D;current_year)</span><br><span class="line">Question.objects.get(id&#x3D;2) # 会报错</span><br><span class="line">Question.objects.get(pk&#x3D;1)</span><br><span class="line">q &#x3D; Question.objects.get(pk&#x3D;1)</span><br><span class="line">q.was_published_recently()</span><br><span class="line">q &#x3D; Question.objects.get(pk&#x3D;1)</span><br><span class="line">q.choice_set.all()</span><br><span class="line"></span><br><span class="line">q.choice_set.create(choice_text&#x3D;&#39;Not much&#39;, votes&#x3D;0)</span><br><span class="line">q.choice_set.create(choice_text&#x3D;&#39;The sky&#39;, votes&#x3D;0)</span><br><span class="line">c &#x3D; q.choice_set.create(choice_text&#x3D;&#39;Just hacking again&#39;, votes&#x3D;0)</span><br><span class="line">c.question</span><br><span class="line">q.choice_set.all()</span><br><span class="line">q.choice_set.count()</span><br><span class="line">Choice.objects.filter(question__pub_date__year&#x3D;current_year)</span><br><span class="line">c &#x3D; q.choice_set.filter(choice_text__startswith&#x3D;&#39;Just hacking&#39;)</span><br><span class="line">c.delete()</span><br></pre></td></tr></table></figure>
</li>
<li><p>开始 Django 管理页面，创建管理员账号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">python3 manage.py createsuperuser</span><br><span class="line">Username: admin</span><br><span class="line">Email address: admin@example.com</span><br><span class="line">Password: \***\*\*\*\*\***</span><br><span class="line">Password (again): \***\*\*\*\***</span><br><span class="line">Superuser created successfully.</span><br><span class="line">python3 manage.py runserver</span><br><span class="line">http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;admin&#x2F;</span><br></pre></td></tr></table></figure>
</li>
<li><p>向管理页面中加入投票应用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># polls&#x2F;admin.py</span><br><span class="line">from django.contrib import admin</span><br><span class="line"></span><br><span class="line">from .models import Question</span><br><span class="line"></span><br><span class="line">admin.site.register(Question)</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建视图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">问题索引页——展示最近的几个投票问题。</span><br><span class="line">问题详情页——展示某个投票的问题和不带结果的选项列表。</span><br><span class="line">问题结果页——展示某个投票的结果。</span><br><span class="line">投票处理器——用于响应用户为某个问题的特定选项投票的操作。</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># polls&#x2F;urls.py</span><br><span class="line">from django.urls import path</span><br><span class="line"></span><br><span class="line">from . import views</span><br><span class="line"></span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    # ex: &#x2F;polls&#x2F;</span><br><span class="line">    path(&#39;&#39;, views.index, name&#x3D;&#39;index&#39;),</span><br><span class="line">    # ex: &#x2F;polls&#x2F;5&#x2F;</span><br><span class="line">    path(&#39;&lt;int:question_id&gt;&#x2F;&#39;, views.detail, name&#x3D;&#39;detail&#39;),</span><br><span class="line">    # ex: &#x2F;polls&#x2F;5&#x2F;results&#x2F;</span><br><span class="line">    path(&#39;&lt;int:question_id&gt;&#x2F;results&#x2F;&#39;, views.results, name&#x3D;&#39;results&#39;),</span><br><span class="line">    # ex: &#x2F;polls&#x2F;5&#x2F;vote&#x2F;</span><br><span class="line">    path(&#39;&lt;int:question_id&gt;&#x2F;vote&#x2F;&#39;, views.vote, name&#x3D;&#39;vote&#39;),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="codingories.github.io/2020/03/27/vue%E5%8A%A8%E7%94%BB%E5%8E%9F%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://i.loli.net/2020/07/12/RPjkZxei6agC49U.jpg">
      <meta itemprop="name" content="Ories">
      <meta itemprop="description" content="这个博客用来记录自己的生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OriesノBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/27/vue%E5%8A%A8%E7%94%BB%E5%8E%9F%E7%90%86/" class="post-title-link" itemprop="url">vue动画原理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-03-27 08:33:53 / Modified: 13:35:02" itemprop="dateCreated datePublished" datetime="2020-03-27T08:33:53+08:00">2020-03-27</time>
            </span>

          
            <span id="/2020/03/27/vue%E5%8A%A8%E7%94%BB%E5%8E%9F%E7%90%86/" class="post-meta-item leancloud_visitors" data-flag-title="vue动画原理" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2020/03/27/vue%E5%8A%A8%E7%94%BB%E5%8E%9F%E7%90%86/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/03/27/vue%E5%8A%A8%E7%94%BB%E5%8E%9F%E7%90%86/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ol>
<li><p>Vue 如何添加动画</p>
<ul>
<li>写一个 transition 标签</li>
<li>在上面写一系列以 fade 开头的类</li>
<li>给一些初始值</li>
</ul>
</li>
<li><p>定义动画的类</p>
<ul>
<li>v-enter 定义动画开始的第一帧</li>
<li>fade-enter-active 进入的过程，补间动画</li>
<li>v-enter-to 为动画第二帧,结束状态一般不需要加</li>
</ul>
</li>
<li><p>淡出和淡如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.slide-fade-enter-active &#123;</span><br><span class="line">    transition: all .3s ease;</span><br><span class="line"> &#125;</span><br><span class="line"> .slide-fade-leave-active &#123;</span><br><span class="line">   transition: all .8s cubic-bezier(1.0, 0.5, 0.8, 1.0);</span><br><span class="line"> &#125;</span><br><span class="line"> .slide-fade-enter, .slide-fade-leave-to</span><br><span class="line">   transform: translateX(10px);</span><br><span class="line">   opacity: 0;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>以上是用 transition 做动画，也可以用 animation 做动画,animation 更简单。</p>
<ul>
<li>enter-active 正在淡入</li>
<li>animation 最终状态就是最初的状态，如果不是会很奇怪</li>
</ul>
</li>
<li><p>结合第三方库比如 animate.css</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;meta name&#x3D;&quot;robots&quot; content&#x3D;&quot;noindex&quot;&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;link href&#x3D;&quot;https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;npm&#x2F;animate.css@3.5.1&quot; rel&#x3D;&quot;stylesheet&quot; type&#x3D;&quot;text&#x2F;css&quot;&gt;</span><br><span class="line">  &lt;script src&#x3D;&quot;http:&#x2F;&#x2F;vuejs.org&#x2F;js&#x2F;vue.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">  &lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class="line">  &lt;title&gt;JS Bin&lt;&#x2F;title&gt;</span><br><span class="line">&lt;style id&#x3D;&quot;jsbin-css&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id&#x3D;&quot;example-3&quot;&gt;</span><br><span class="line">  &lt;button @click&#x3D;&quot;show &#x3D; !show&quot;&gt;</span><br><span class="line">    Toggle render</span><br><span class="line">  &lt;&#x2F;button&gt;</span><br><span class="line">  &lt;transition</span><br><span class="line">      name&#x3D;&quot;custom-classes-transition&quot;</span><br><span class="line">      enter-active-class&#x3D;&quot;animated shake&quot;</span><br><span class="line">      leave-active-class&#x3D;&quot;animated bounceOutRight&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;p v-if&#x3D;&quot;show&quot;&gt;hello&lt;&#x2F;p&gt;</span><br><span class="line">  &lt;&#x2F;transition&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&lt;script id&#x3D;&quot;jsbin-javascript&quot;&gt;</span><br><span class="line">  new Vue(&#123;</span><br><span class="line">    el: &#39;#example-3&#39;,</span><br><span class="line">    data: &#123;</span><br><span class="line">      show: true</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>结合 velocity 库完全自己去实现 js 动画</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id&#x3D;&quot;example-4&quot;&gt;</span><br><span class="line">  &lt;button @click&#x3D;&quot;show &#x3D; !show&quot;&gt;</span><br><span class="line">    Toggle</span><br><span class="line">  &lt;&#x2F;button&gt;</span><br><span class="line">  &lt;transition</span><br><span class="line">      v-on:before-enter&#x3D;&quot;beforeEnter&quot;</span><br><span class="line">      v-on:enter&#x3D;&quot;enter&quot;</span><br><span class="line">      v-on:leave&#x3D;&quot;leave&quot;</span><br><span class="line">      v-bind:css&#x3D;&quot;false&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;p v-if&#x3D;&quot;show&quot;&gt;</span><br><span class="line">      Demo</span><br><span class="line">    &lt;&#x2F;p&gt;</span><br><span class="line">  &lt;&#x2F;transition&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&lt;script id&#x3D;&quot;jsbin-javascript&quot;&gt;</span><br><span class="line">  new Vue(&#123;</span><br><span class="line">    el: &#39;#example-4&#39;,</span><br><span class="line">    data: &#123;</span><br><span class="line">      show: false</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      beforeEnter: function (el) &#123;</span><br><span class="line">        el.style.opacity &#x3D; 0</span><br><span class="line">        el.style.transformOrigin &#x3D; &#39;left&#39;</span><br><span class="line">      &#125;,</span><br><span class="line">      enter: function (el, done) &#123;</span><br><span class="line"></span><br><span class="line">        Velocity(el, &#123; opacity: 1, fontSize: &#39;1.4em&#39; &#125;, &#123; duration: 300 &#125;)</span><br><span class="line">        Velocity(el, &#123; backgroundColor: &#39;red&#39; &#125;, &#123; complete: 3000 &#125;)</span><br><span class="line">        Velocity(el, &#123; fontSize: &#39;1em&#39; &#125;, &#123; complete: done &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      leave: function (el, done) &#123;</span><br><span class="line">        Velocity(el, &#123; translateX: &#39;15px&#39;, rotateZ: &#39;50deg&#39; &#125;, &#123; duration: 600 &#125;)</span><br><span class="line">        Velocity(el, &#123; rotateZ: &#39;100deg&#39; &#125;, &#123; loop: 2 &#125;)</span><br><span class="line">        Velocity(el, &#123;</span><br><span class="line">          rotateZ: &#39;45deg&#39;,</span><br><span class="line">          translateY: &#39;30px&#39;,</span><br><span class="line">          translateX: &#39;30px&#39;,</span><br><span class="line">          opacity: 0</span><br><span class="line">        &#125;, &#123; complete: done &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>多元素动画实现</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;style id&#x3D;&quot;jsbin-css&quot;&gt;</span><br><span class="line">  .fade-enter-active, .fade-leave-active&#123;</span><br><span class="line">    transition: all 1s;</span><br><span class="line">  &#125;</span><br><span class="line">  .fade-enter&#123;</span><br><span class="line">    opacity: 0;</span><br><span class="line">  &#125;</span><br><span class="line">  .fade-leave-to&#123;</span><br><span class="line">    opacity:0;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id&#x3D;&quot;example-4&quot;&gt;</span><br><span class="line">  &lt;transition name&#x3D;&quot;fade&quot;&gt;</span><br><span class="line">    &lt;button key&#x3D;&quot;on&quot; v-if&#x3D;&quot;status &#x3D;&#x3D;&#x3D; &#39;off&#39;&quot; @click&#x3D;&quot;status &#x3D; &#39;on&#39;&quot;&gt;on&lt;&#x2F;button&gt;</span><br><span class="line">    &lt;button key&#x3D;&quot;off&quot; v-else @click&#x3D;&quot;status &#x3D; &#39;off&#39;&quot;&gt;off&lt;&#x2F;button&gt;</span><br><span class="line">  &lt;&#x2F;transition&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&lt;script id&#x3D;&quot;jsbin-javascript&quot;&gt;</span><br><span class="line">  new Vue(&#123;</span><br><span class="line">    el: &#39;#example-4&#39;,</span><br><span class="line">    data: &#123;</span><br><span class="line">      status: &#39;on&#39;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>为什么要+key<ul>
<li>不+key，vue可能认为是同一个button</li>
</ul>
</li>
<li>动画先后执行需要加入参数,mode=”out-in”</li>
</ul>
</li>
<li><p>多个组件之间的过度</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">  &lt;style id&#x3D;&quot;jsbin-css&quot;&gt;</span><br><span class="line">  .component-fade-enter-active, .component-fade-leave-active &#123;</span><br><span class="line">    transition: opacity 1.3s ease;</span><br><span class="line">  &#125;</span><br><span class="line">  .component-fade-enter, .component-fade-leave-to</span><br><span class="line">    &#x2F;* .component-fade-leave-active for below version 2.1.8 *&#x2F; &#123;</span><br><span class="line">    opacity: 0;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id&#x3D;&quot;transition-components-demo&quot;&gt;</span><br><span class="line">  &lt;button @click&#x3D;&quot;view&#x3D;&#39;v-a&#39;&quot;&gt;A&lt;&#x2F;button&gt;</span><br><span class="line">  &lt;button @click&#x3D;&quot;view&#x3D;&#39;v-b&#39;&quot;&gt;B&lt;&#x2F;button&gt;</span><br><span class="line">  &lt;transition name&#x3D;&quot;component-fade&quot; mode&#x3D;&quot;out-in&quot;&gt;</span><br><span class="line">    &lt;component v-bind:is&#x3D;&quot;view&quot;&gt;&lt;&#x2F;component&gt;</span><br><span class="line">  &lt;&#x2F;transition&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&lt;script id&#x3D;&quot;jsbin-javascript&quot;&gt;</span><br><span class="line">  new Vue(&#123;</span><br><span class="line">    el: &#39;#transition-components-demo&#39;,</span><br><span class="line">    data: &#123;</span><br><span class="line">      view: &#39;v-a&#39;</span><br><span class="line">    &#125;,</span><br><span class="line">    components: &#123;</span><br><span class="line">      &#39;v-a&#39;: &#123;</span><br><span class="line">        template: &#39;&lt;div&gt;Component A&lt;&#x2F;div&gt;&#39;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#39;v-b&#39;: &#123;</span><br><span class="line">        template: &#39;&lt;div&gt;Component B&lt;&#x2F;div&gt;&#39;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>以上几种动画方式总结</p>
<ul>
<li><img src="https://i.loli.net/2020/03/27/lCYyaD4sSGpW6mO.png" alt="总结动画.png"></li>
</ul>
</li>
<li><p>列表过渡</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;style id&#x3D;&quot;jsbin-css&quot;&gt;</span><br><span class="line">  .list-item &#123;</span><br><span class="line">    display: inline-block;</span><br><span class="line">    margin-right: 10px;</span><br><span class="line">  &#125;</span><br><span class="line">  .list-enter-active, .list-leave-active &#123;</span><br><span class="line">    transition: all 1s;</span><br><span class="line">  &#125;</span><br><span class="line">  .list-enter, .list-leave-to</span><br><span class="line">    &#x2F;* .list-leave-active for below version 2.1.8 *&#x2F; &#123;</span><br><span class="line">    opacity: 0;</span><br><span class="line">    transform: translateY(30px);</span><br><span class="line">  &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id&#x3D;&quot;list-demo&quot; class&#x3D;&quot;demo&quot;&gt;</span><br><span class="line">  &lt;button v-on:click&#x3D;&quot;add&quot;&gt;Add&lt;&#x2F;button&gt;</span><br><span class="line">  &lt;button v-on:click&#x3D;&quot;remove&quot;&gt;Remove&lt;&#x2F;button&gt;</span><br><span class="line">  &lt;transition-group name&#x3D;&quot;list&quot; tag&#x3D;&quot;p&quot;&gt;</span><br><span class="line">    &lt;span v-for&#x3D;&quot;item in items&quot; v-bind:key&#x3D;&quot;item&quot; class&#x3D;&quot;list-item&quot;&gt;</span><br><span class="line">      &#123;&#123; item &#125;&#125;</span><br><span class="line">    &lt;&#x2F;span&gt;</span><br><span class="line">  &lt;&#x2F;transition-group&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&lt;script id&#x3D;&quot;jsbin-javascript&quot;&gt;</span><br><span class="line">  new Vue(&#123;</span><br><span class="line">    el: &#39;#list-demo&#39;,</span><br><span class="line">    data: &#123;</span><br><span class="line">      items: [1,2,3,4,5,6,7,8,9],</span><br><span class="line">      nextNum: 10</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      randomIndex: function () &#123;</span><br><span class="line">        return Math.floor(Math.random() * this.items.length)</span><br><span class="line">      &#125;,</span><br><span class="line">      add: function () &#123;</span><br><span class="line">        this.items.splice(this.randomIndex(), 0, this.nextNum++)</span><br><span class="line">      &#125;,</span><br><span class="line">      remove: function () &#123;</span><br><span class="line">        this.items.splice(this.randomIndex(), 1)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>要用transition-group+一个标签</li>
<li>里面马上要+一个for循环</li>
</ul>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="codingories.github.io/2020/03/25/Vue-Router%E5%89%8D%E7%AB%AF%E8%B7%AF%E7%94%B1%E5%AE%9E%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://i.loli.net/2020/07/12/RPjkZxei6agC49U.jpg">
      <meta itemprop="name" content="Ories">
      <meta itemprop="description" content="这个博客用来记录自己的生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OriesノBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/25/Vue-Router%E5%89%8D%E7%AB%AF%E8%B7%AF%E7%94%B1%E5%AE%9E%E7%8E%B0/" class="post-title-link" itemprop="url">Vue Router前端路由实现</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-25 10:14:05" itemprop="dateCreated datePublished" datetime="2020-03-25T10:14:05+08:00">2020-03-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-03-27 08:27:14" itemprop="dateModified" datetime="2020-03-27T08:27:14+08:00">2020-03-27</time>
              </span>

          
            <span id="/2020/03/25/Vue-Router%E5%89%8D%E7%AB%AF%E8%B7%AF%E7%94%B1%E5%AE%9E%E7%8E%B0/" class="post-meta-item leancloud_visitors" data-flag-title="Vue Router前端路由实现" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2020/03/25/Vue-Router%E5%89%8D%E7%AB%AF%E8%B7%AF%E7%94%B1%E5%AE%9E%E7%8E%B0/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/03/25/Vue-Router%E5%89%8D%E7%AB%AF%E8%B7%AF%E7%94%B1%E5%AE%9E%E7%8E%B0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ol>
<li><p>路由是什么</p>
<ul>
<li>路由就是分发请求，路由器就是分发请求的东西。</li>
<li>保底路由，404，基础路由案例。<a href="https://codesandbox.io/s/exciting-hoover-moys4%E3%80%82" target="_blank" rel="noopener">https://codesandbox.io/s/exciting-hoover-moys4。</a></li>
<li>优化后代码以及什么是路由表。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">const div1 &#x3D; document.createElement(&#39;div&#39;)</span><br><span class="line">div1.innerHTML &#x3D; &#39;1&#39;</span><br><span class="line">const div2 &#x3D; document.createElement(&#39;div&#39;)</span><br><span class="line">div2.innerHTML &#x3D; &#39;2&#39;</span><br><span class="line">const div3 &#x3D; document.createElement(&#39;div&#39;)</span><br><span class="line">div3.innerHTML &#x3D; &#39;3&#39;</span><br><span class="line">const div4 &#x3D; document.createElement(&#39;div&#39;)</span><br><span class="line">div4.innerHTML &#x3D; &#39;4&#39;</span><br><span class="line"></span><br><span class="line">const routeTable &#x3D; &#123;</span><br><span class="line">  &#39;1&#39; : div1,</span><br><span class="line">  &#39;2&#39; : div2,</span><br><span class="line">  &#39;3&#39; : div3,</span><br><span class="line">  &#39;4&#39; : div4,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function route() &#123;</span><br><span class="line">  let number &#x3D; window.location.hash.substr(1);</span><br><span class="line">  console.log(number)</span><br><span class="line">  let app &#x3D; document.querySelector(&quot;#app&quot;);</span><br><span class="line">  number &#x3D; number || 1;</span><br><span class="line">  &#x2F;&#x2F; 获取界面</span><br><span class="line">  let div &#x3D; routeTable[number.toString()]</span><br><span class="line">  console.log(&#39;div&#39;)</span><br><span class="line">  console.log(div)</span><br><span class="line">  if (!div) &#123;</span><br><span class="line">    div &#x3D; document.querySelector(&quot;#div404&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  div.style.display &#x3D; &quot;block&quot;;</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; 展示界面</span><br><span class="line">  app.innerHTML &#x3D; &quot;&quot;;</span><br><span class="line">  &#x2F;&#x2F; if(app.children.length &gt; 0)&#123;</span><br><span class="line">  &#x2F;&#x2F;   app.children[0].style.display &#x3D; &quot;none&quot;;</span><br><span class="line">  &#x2F;&#x2F;   document.body.appendChild(app.children[0]);</span><br><span class="line">  &#x2F;&#x2F; &#125;</span><br><span class="line">  app.appendChild(div);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 展示界面</span><br><span class="line">route()</span><br><span class="line">window.addEventListener(&quot;hashchange&quot;, () &#x3D;&gt; &#123;</span><br><span class="line">  route()</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>嵌套路由的大致实现思路</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">const app &#x3D; document.querySelector(&#39;#app&#39;)</span><br><span class="line">const div1 &#x3D; document.createElement(&#39;div&#39;)</span><br><span class="line">div1.innerHTML &#x3D; &#39;1&#39;</span><br><span class="line">const view1 &#x3D; document.createElement(&#39;div&#39;);</span><br><span class="line">div1.appendChild(view1);</span><br><span class="line">view1.style.height &#x3D; &quot;50px&quot;;</span><br><span class="line">view1.style.background &#x3D; &quot;red&quot;;</span><br><span class="line">const div2 &#x3D; document.createElement(&#39;div&#39;)</span><br><span class="line">div2.innerHTML &#x3D; &#39;2&#39;</span><br><span class="line">const div3 &#x3D; document.createElement(&#39;div&#39;)</span><br><span class="line">div3.innerHTML &#x3D; &#39;3&#39;</span><br><span class="line">const div4 &#x3D; document.createElement(&#39;div&#39;)</span><br><span class="line">div4.innerHTML &#x3D; &#39;4&#39;</span><br><span class="line"></span><br><span class="line">const routeTable &#x3D; &#123;</span><br><span class="line">  &#39;1&#39; : div1,</span><br><span class="line">  &#39;2&#39; : div2,</span><br><span class="line">  &#39;3&#39; : div3,</span><br><span class="line">  &#39;4&#39; : div4,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const div11 &#x3D; document.createElement(&#39;div&#39;)</span><br><span class="line">div11.innerHTML &#x3D; &#39;1.1&#39;</span><br><span class="line"></span><br><span class="line">const div12 &#x3D; document.createElement(&#39;div&#39;)</span><br><span class="line">div12.innerHTML &#x3D; &#39;1.2&#39;</span><br><span class="line"></span><br><span class="line">const div13 &#x3D; document.createElement(&#39;div&#39;)</span><br><span class="line">div13.innerHTML &#x3D; &#39;1.3&#39;</span><br><span class="line"></span><br><span class="line">const route1Table &#x3D; &#123;</span><br><span class="line">  &quot;1&#x2F;1&quot;: div11,</span><br><span class="line">  &quot;1&#x2F;2&quot;: div12,</span><br><span class="line">  &quot;1&#x2F;3&quot;: div13,</span><br><span class="line">&#125;</span><br><span class="line">function route(container) &#123;</span><br><span class="line">  let number &#x3D; window.location.hash.substr(1);</span><br><span class="line">  number &#x3D; number || 1;</span><br><span class="line">  console.log(&#39;number:&#39;+ number)</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; 获取界面</span><br><span class="line">  let div &#x3D; routeTable[number.toString()]</span><br><span class="line">  console.log(&#39;div&#39;)</span><br><span class="line">  console.log(div)</span><br><span class="line">  if (!div) &#123;</span><br><span class="line">    div &#x3D; document.querySelector(&quot;#div404&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  div.style.display &#x3D; &quot;block&quot;;</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; 展示界面</span><br><span class="line">  container.innerHTML &#x3D; &quot;&quot;;</span><br><span class="line">  container.appendChild(div);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">route(app)</span><br><span class="line">window.addEventListener(&quot;hashchange&quot;, () &#x3D;&gt; &#123;</span><br><span class="line">  route(app)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>路由的 hash 模式,history 模式和 memory 模式。</p>
<ul>
<li><p>任何情况都可以用 hash 做前端路由，缺点 seo 不友好, 服务器收不到 hash,原因是浏览器不会把#之后的内容发给服务器，现在 google 有 hashSeo 但是要求服务器做配置 hashbang,但是还是不能跟一起的 seo 做媲美</p>
</li>
<li><p>history 是后端将所有前端路由都渲染到同一页面,就可以使用 histoy 模式,同一页面不能到 404，如果后端能实现不管你输入什么都到你的首页，那么你就可以用 history 模式。唯一缺点，ie8 以下不支持。</p>
</li>
<li><p>为了解决 history 体验很差，浏览器出了一个 historyAPI,案例如下</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">const app &#x3D; document.querySelector(&#39;#app&#39;)</span><br><span class="line"> const div1 &#x3D; document.createElement(&#39;div&#39;)</span><br><span class="line"> div1.innerHTML &#x3D; &#39;1&#39;</span><br><span class="line"> const view1 &#x3D; document.createElement(&#39;div&#39;);</span><br><span class="line"> div1.appendChild(view1);</span><br><span class="line"> view1.style.height &#x3D; &quot;50px&quot;;</span><br><span class="line"> view1.style.background &#x3D; &quot;red&quot;;</span><br><span class="line"> const div2 &#x3D; document.createElement(&#39;div&#39;)</span><br><span class="line"> div2.innerHTML &#x3D; &#39;2&#39;</span><br><span class="line"> const div3 &#x3D; document.createElement(&#39;div&#39;)</span><br><span class="line"> div3.innerHTML &#x3D; &#39;3&#39;</span><br><span class="line"> const div4 &#x3D; document.createElement(&#39;div&#39;)</span><br><span class="line"> div4.innerHTML &#x3D; &#39;4&#39;</span><br><span class="line"></span><br><span class="line"> const routeTable &#x3D; &#123;</span><br><span class="line">   &#39;&#x2F;1&#39; : div1,</span><br><span class="line">   &#39;&#x2F;2&#39; : div2,</span><br><span class="line">   &#39;&#x2F;3&#39; : div3,</span><br><span class="line">   &#39;&#x2F;4&#39; : div4,</span><br><span class="line"> &#125;</span><br><span class="line"> function route(container) &#123;</span><br><span class="line"> let number &#x3D; window.location.pathname</span><br><span class="line"> console.log(&#39;number:&#39;+ number)</span><br><span class="line"></span><br><span class="line"> if(number &#x3D;&#x3D;&#x3D; &#39;&#x2F;&#39;)&#123;</span><br><span class="line">   numer &#x3D; &#39;&#x2F;1&#39;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> &#x2F;&#x2F; 获取界面</span><br><span class="line"> let div &#x3D; routeTable[number.toString()]</span><br><span class="line"> console.log(&#39;div&#39;)</span><br><span class="line"> console.log(div)</span><br><span class="line"> if (!div) &#123;</span><br><span class="line">   div &#x3D; document.querySelector(&quot;#div404&quot;);</span><br><span class="line"> &#125;</span><br><span class="line"> div.style.display &#x3D; &quot;block&quot;;</span><br><span class="line"></span><br><span class="line"> &#x2F;&#x2F; 展示界面</span><br><span class="line"> container.innerHTML &#x3D; &quot;&quot;;</span><br><span class="line"> container.appendChild(div);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> const allA &#x3D; document.querySelectorAll(&#39;a.link&#39;)</span><br><span class="line"></span><br><span class="line"> for (let a of allA)&#123;</span><br><span class="line">   a.addEventListener(&quot;click&quot;, e &#x3D;&gt; &#123;</span><br><span class="line">     e.preventDefault();</span><br><span class="line">     const href &#x3D; a.getAttribute(&#39;href&#39;)</span><br><span class="line">     window.history.pushState(null,  &#96;page $&#123;href&#125;&#96; , href)</span><br><span class="line">     &#x2F;&#x2F; 通知</span><br><span class="line">     onStateChange(href)</span><br><span class="line">   &#125;)</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> route(app)</span><br><span class="line"></span><br><span class="line"> function onStateChange()&#123;</span><br><span class="line">   route(app)</span><br><span class="line"> &#125;</span><br><span class="line"> &#x2F;&#x2F;</span><br><span class="line"> &#x2F;&#x2F; window.addEventListener(&quot;hashchange&quot;, () &#x3D;&gt; &#123;</span><br><span class="line"> &#x2F;&#x2F;   route(app)</span><br><span class="line"> &#x2F;&#x2F; &#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>history 模式和 hash 模式的区别</p>
<ul>
<li>使用条件不一样，hash 模式在任何条件下都可以做前端路由，但是对 seo 不友好，不友好的原因是服务器收不到 hash,history 必须要将所有前端路由都渲染到同一页面，IE 8 不支持。</li>
</ul>
</li>
<li><p>memory 模式,就是把路径存到用户看不见的地方比如 localStorage,这种模式适合非浏览器，react native, weex,比如 app,案例代码如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">const app &#x3D; document.querySelector(&#39;#app&#39;)</span><br><span class="line">const div1 &#x3D; document.createElement(&#39;div&#39;)</span><br><span class="line">div1.innerHTML &#x3D; &#39;1&#39;</span><br><span class="line">const view1 &#x3D; document.createElement(&#39;div&#39;);</span><br><span class="line">div1.appendChild(view1);</span><br><span class="line">view1.style.height &#x3D; &quot;50px&quot;;</span><br><span class="line">view1.style.background &#x3D; &quot;red&quot;;</span><br><span class="line">const div2 &#x3D; document.createElement(&#39;div&#39;)</span><br><span class="line">div2.innerHTML &#x3D; &#39;2&#39;</span><br><span class="line">const div3 &#x3D; document.createElement(&#39;div&#39;)</span><br><span class="line">div3.innerHTML &#x3D; &#39;3&#39;</span><br><span class="line">const div4 &#x3D; document.createElement(&#39;div&#39;)</span><br><span class="line">div4.innerHTML &#x3D; &#39;4&#39;</span><br><span class="line"></span><br><span class="line">const routeTable &#x3D; &#123;</span><br><span class="line">  &#39;&#x2F;1&#39; : div1,</span><br><span class="line">  &#39;&#x2F;2&#39; : div2,</span><br><span class="line">  &#39;&#x2F;3&#39; : div3,</span><br><span class="line">  &#39;&#x2F;4&#39; : div4,</span><br><span class="line">&#125;</span><br><span class="line"> function route(container) &#123;</span><br><span class="line">   let number &#x3D; window.localStorage.getItem(&#39;xxx&#39;)</span><br><span class="line">   console.log(&#39;number:&#39;+ number)</span><br><span class="line"></span><br><span class="line">   if(!number)&#123;</span><br><span class="line">     number &#x3D; &#39;&#x2F;1&#39;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   &#x2F;&#x2F; 获取界面</span><br><span class="line">   let div &#x3D; routeTable[number.toString()]</span><br><span class="line">   console.log(&#39;div&#39;)</span><br><span class="line">   console.log(div)</span><br><span class="line">   if (!div) &#123;</span><br><span class="line">     div &#x3D; document.querySelector(&quot;#div404&quot;);</span><br><span class="line">   &#125;</span><br><span class="line">   div.style.display &#x3D; &quot;block&quot;;</span><br><span class="line"></span><br><span class="line">   &#x2F;&#x2F; 展示界面</span><br><span class="line">   container.innerHTML &#x3D; &quot;&quot;;</span><br><span class="line">   container.appendChild(div);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> const allA &#x3D; document.querySelectorAll(&#39;a.link&#39;)</span><br><span class="line"></span><br><span class="line"> for (let a of allA)&#123;</span><br><span class="line">   a.addEventListener(&quot;click&quot;, e &#x3D;&gt; &#123;</span><br><span class="line">     e.preventDefault();</span><br><span class="line">     const href &#x3D; a.getAttribute(&#39;href&#39;)</span><br><span class="line">     window.localStorage.setItem(&#39;xxx&#39;, href)</span><br><span class="line">     &#x2F;&#x2F; 通知</span><br><span class="line">     onStateChange(href)</span><br><span class="line">   &#125;)</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> route(app)</span><br><span class="line"></span><br><span class="line"> function onStateChange()&#123;</span><br><span class="line">   route(app)</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>三种模式区别总结:</p>
<ul>
<li>前两种都是把路径存在 url,memory 不是 url,放 localStorage 或者本地数据库里，memory 缺点是没有 url 所以复制链接给别人会出问题，memory 是单机版的路由,前两种是可分享的路由</li>
</ul>
</li>
<li><p>如何阅读 VueRouter 源码</p>
</li>
</ol>
<ul>
<li>h 在 vue 中的使用,h 就是一个在 vue 中，你想怎么创建标签就怎么创建标签的 api,createElement 可以用 js 的形式创建任意标签，第一个参数是标签名，第二参数子元素。一般都会把 createElement 重新命名为 h。h 就是 createElement,用于创建组件。记住:router 点了之后会调用 router.push</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="codingories.github.io/2020/03/23/EmotionsEnglish%E6%96%87%E6%9C%AC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://i.loli.net/2020/07/12/RPjkZxei6agC49U.jpg">
      <meta itemprop="name" content="Ories">
      <meta itemprop="description" content="这个博客用来记录自己的生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OriesノBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/23/EmotionsEnglish%E6%96%87%E6%9C%AC/" class="post-title-link" itemprop="url">EmotionsEnglish文本</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-23 08:38:42" itemprop="dateCreated datePublished" datetime="2020-03-23T08:38:42+08:00">2020-03-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-04-14 16:34:13" itemprop="dateModified" datetime="2020-04-14T16:34:13+08:00">2020-04-14</time>
              </span>

          
            <span id="/2020/03/23/EmotionsEnglish%E6%96%87%E6%9C%AC/" class="post-meta-item leancloud_visitors" data-flag-title="EmotionsEnglish文本" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2020/03/23/EmotionsEnglish%E6%96%87%E6%9C%AC/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/03/23/EmotionsEnglish%E6%96%87%E6%9C%AC/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="part-1-虚拟情感的力量！"><a href="#part-1-虚拟情感的力量！" class="headerlink" title="part-1 虚拟情感的力量！"></a>part-1 虚拟情感的力量！</h2><h4 id="season-1-假设-“过去可以重来，现在可以逆转，将来可以预见”"><a href="#season-1-假设-“过去可以重来，现在可以逆转，将来可以预见”" class="headerlink" title="season-1 假设 “过去可以重来，现在可以逆转，将来可以预见”"></a>season-1 假设 “过去可以重来，现在可以逆转，将来可以预见”</h4><blockquote>
<p>人类的最高级思维能力之一就是虚拟想象，对发生过的，现在的状态，未来的状态进行想象。</p>
</blockquote>
<h5 id="S1-1-过去假设-Gossip-Girl《绯闻女孩》"><a href="#S1-1-过去假设-Gossip-Girl《绯闻女孩》" class="headerlink" title="S1-1 过去假设 - Gossip Girl《绯闻女孩》"></a>S1-1 过去假设 - Gossip Girl《绯闻女孩》</h5><ul>
<li>I would have(never) done…, if I had done…
如果我当时……, 我是(绝不)会……的。
【情】 事后对某事的解释和澄清，对过去的虚拟
【例】 I would never have broken up with her, if you had told me this story earlier。
如果你早一点告诉我这个故事，我是绝对不会和她分手的。</li>
<li>A: So, so you got the spot?(那被录取的是你?)
B: I would have never applied If I had known they were only taking one transfer from N.Y.U。（如果我知道他们只从纽约大学招一名转学生，我当时是绝不会申请的。）
A: You got in. Wow, wow! Well, I mean, congratulations. No, seriously, seriously.If it wasn’t gonna be me, I’m glad it was you.
(你被录取了，哇，哇，我的意思是，那恭喜了，真的，我很认真，如果我不会被录取，我很高兴录取的是你)
B: You are?(是吗?)
A: Yeah,sure,you know, and they also ‘wish me success in my future endeavors. So it’s not a total loss.(是的，当然，他们还”祝愿我未来事业成功”呢。所以我也不是一败涂地。)
【注】endeavor=n.奋力 v.尽力</li>
</ul>
<h5 id="S1-2-过去假设-Desperate-Housewives《绝望的主妇》"><a href="#S1-2-过去假设-Desperate-Housewives《绝望的主妇》" class="headerlink" title="S1-2 过去假设 - Desperate Housewives《绝望的主妇》"></a>S1-2 过去假设 - Desperate Housewives《绝望的主妇》</h5><ul>
<li>If sb. had done …, sb./sth. would be…
如果某人做了……, 某人/某事物现在会……
【情】对过去做的事情做不同的假设， 可能会对现在(或者过去)造成的不同影响。
【例】If I had tried harder in high school, I would be in Harvard University now.
如果我在高中再努力一点，我现在就在哈佛大学了。
【引】If Sb. had done…, sb.(sth.) would have done…
如果某人做了……,某人或某事当时估计会……
【例】 If you had walked a little further, you would have found the treasure.
如果你再往前走一点，你当时就会发现宝藏。
have the upper hand 占优势
【近】have advantage over… 比…有优势</li>
<li>A: What were you thinking? (你当时在想什么?)
B: First tell me if it worked, then I’ll tell you what I was thinking.(先告诉我我的方法有没有起作用，然后我再告诉你我在想什么。)
A: Don’t be glib. Did you hire someone to attack Orson? (别油嘴滑舌。你是不是雇了人袭击奥森?)
B: Yes. (是的。)
A: Are you insane? Your thug tried to strangle him. (你疯了吗? 那个恶棍差点勒死他。)
B: If he had tried to strangle him, he’d be dead.Look, Orson <strong>had the upper hand</strong> in this divorce. We needed to regain it. (他如果真耍掐死他，他早死了。现在奥森在这起离婚诉讼中占上风，我们要夺回主动权。)
A: Not by resorting to physical violence.I Would never have given my permission for that.(不要借助武力，要是这样我当时根本本不可能同意的。)
【注】 glib=a.油嘴滑舌的,圆滑的; thug=n.暴徒，恶棍; strangle=v.勒死;resort=v.诉诸,求助;physical violence=肢体暴力</li>
</ul>
<h5 id="S1-3-现在假设-《反恐-24-小时》"><a href="#S1-3-现在假设-《反恐-24-小时》" class="headerlink" title="S1-3 现在假设 - 《反恐 24 小时》"></a>S1-3 现在假设 - 《反恐 24 小时》</h5><ul>
<li>If there were…, sb./sth. would…, but there isn’t.
如果有……，某人/某物会……，但是没有。
【情】虚拟没有的事物，然后可以用 but 引导对现状的某种无奈
【近】If there were a hero who could save me from here, I would do anything for him, but there isn’t.
如果有一个英雄可以把我从这里救出去，我会为他做一切事情，但事实上没有。</li>
</ul>
<ul>
<li><p>A: This peace treaty is in the interests of the United States and of the world.
That makes it a good in itself, and certainly more important than your desire for revenge.(这项和平协议关乎美国和世界的利益,这本身便是一项举，当然远比你复仇的欲望更重要)</p>
<p>B: Madam President,I don’t want revenge, I want justice.(总统阁下,我
不想要复仇,我只想要正义。)</p>
<p>A: And I want peace.If there were another way, I would take it, but there’s not. That′s my decision. Do you understand? Do you understand,Jack? (而我想要和平,如果另有他法我会遵从,但是没有。这是我的决定，明白了吗? 明白了吗,杰克?)</p>
<p>B: Yes,ma’am. (是的,阁下。)
【注】 treaty=n.条约 revenge=n.复仇</p>
</li>
</ul>
<h5 id="S1-4-现在假设-Desperate-Housewives《绝望的主妇》"><a href="#S1-4-现在假设-Desperate-Housewives《绝望的主妇》" class="headerlink" title="S1-4 现在假设 - Desperate Housewives《绝望的主妇》"></a>S1-4 现在假设 - Desperate Housewives《绝望的主妇》</h5><ul>
<li><p>If I were in your shoes，I would…
如果我处在你的位置上,我会…
【情】 表达换位思考的同理心情。
【近】 If I were you,I would… 如果我是你，我会……
【例】 If I were you,I would make the same decision. 如果我是你，我会做同样的决定。
If I wanted…,I would have done…
如果我想……，我早就……了？
【情】 不屑地回应别人的质疑。
【例】 If I wanted your money, I would have left after I got the check.
如果我是为了你的钱，拿到支票以后我早就走了。</p>
</li>
<li><p>A: Look,I know that you don’t like me, but I am here to do you a favor anyway. I was out to dinner last night and I saw your husband with another woman.(我知道你不喜欢我，不过，我此次来是帮你忙的，昨晚我在外面吃饭碰至你老公和别的女人在一起。）
B: Really? （真的? ）
A: I feel bad saying it, but if I were in our shoes, I would want to know. You′re welcome.(这话确实很难启齿，但如果我是你，我会想知道。不用谢。)
B: Oh,I get it.So you feel I judged you, and for revenge,you′re trying
to make me insecure about my marriage. (哦，我明白了。你觉得我对你说三道四,作为报复，你就试图摧垮我对婚姻的安全感。)
A: If I wanted revenge, I Would have joined them and had a threesome.(我要是想报复.我就干脆加人他们俩来个三人行)
【注】 revenge=n. 报仇 threesome=n.三人一组</p>
</li>
</ul>
<h5 id="S1-5-将来假设-Life-After-People-人类消失后的世界"><a href="#S1-5-将来假设-Life-After-People-人类消失后的世界" class="headerlink" title="S1-5 将来假设 - Life After People (人类消失后的世界)"></a>S1-5 将来假设 - Life After People (人类消失后的世界)</h5><ul>
<li><p>If (sb./sth.) were to do…,sb./sth. would do
如果某人/某物将……，某人/某物会……
【情】虚拟表达如果将来发生某事，以及会产生的相应结果。
【例】If you were to become Superman, I would ask you to fly me to the sky.
要是你将要变成超人，我会让你带我飞上天。</p>
</li>
<li><p>A:There‘s water in the reservoir keeps supplying the water to the hydro turbine generators.These generators are operating automatically, and that would continue as long as all of the systems are functioning normally.If I and my staff were to leave tonight and not come back to Hoover Dam, say just in the condition of the plant is in right now, this would continue operating without us here.(水库里流动的水带动涡轮大电机不停地转动。这些发动机自动工作，只要系统不出问题他们就能够一直工作下去，如果我和我的同事今晚就离开胡佛水坝不再回来，车间仍然保持现在这个状态，它们仍然会正常地工作)
【注】hydro turbine generator n. 水力涡轮发电机</p>
</li>
</ul>
<h4 id="Season-2-用-wish-表达对现在和过去的奢望"><a href="#Season-2-用-wish-表达对现在和过去的奢望" class="headerlink" title="Season-2 用 wish 表达对现在和过去的奢望"></a>Season-2 用 wish 表达对现在和过去的奢望</h4><blockquote>
<p>“Make a wish!”许个愿吧!即便我们每天都在向上帝、佛祖、流星、水池等等许愿，但是我们内心深处很多时候知道这个”wish”只是个奢望罢了。我们来看看如何用 wish 表达对现在和过去的奢望。</p>
</blockquote>
<h5 id="S2-1-Wish-过去-Heroes《超能英雄》"><a href="#S2-1-Wish-过去-Heroes《超能英雄》" class="headerlink" title="S2-1 Wish 过去 - Heroes《超能英雄》"></a>S2-1 Wish 过去 - Heroes《超能英雄》</h5><ul>
<li><p>I wish I had done… 我真希望那时我已经……啊
【情】 对过去的遗憾发表感慨。
【例】 I wish I had finished my homework before summer camp. 我真希
望当时夏令营开始之前我的作业就已经写完了。</p>
</li>
<li><p>A: I wanna help you. （我想帮你。）
B: I was almost your age when I came here. I was 16. Every other
thought was about boys and the prom I was so naive.I Wish I had had
half ot your strength.You have courage and self confidence. You’ve
overcome all those nagging self-doubts. (我来这儿的时候和你差不多大,那
时我 16 岁。脑子里就想着男孩和舞会。我那时太天真了，我要是有你一半的坚强就好了。你有勇气和自信，你克服了那些烦人的自我怀疑。
【注】 prom=n. (美国高中的)正式舞会;naive=a.天真的; overcome=vt.战胜,克服;nagging=a.恼人的</p>
</li>
</ul>
<h5 id="S2-2-Wish-过去-Extract-《压榨》"><a href="#S2-2-Wish-过去-Extract-《压榨》" class="headerlink" title="S2-2 Wish 过去 - Extract 《压榨》"></a>S2-2 Wish 过去 - Extract 《压榨》</h5><ul>
<li><p>I wish you would have told me…before…
我真希望在……之前你就能告诉我……
【情】 面对毫无贮备的或者迟来的消息时， 表达不满或者遗憾
【例】 I wish you would have told me about your preference before I
picked the color for you. 我真希望在我帮你挑选颜色之前，你就能告诉我你的偏好。</p>
</li>
<li><p>I (really) wish sb. had been + 形容词比较级.
我(真)希望某人当时能再……点
【情】 对过去某人做的事情表达一种不满或抱怨的情绪。
【例】 I wish you had been nicer to your dad. 我真希望你当时对你爸爸的态度可以更好一点。</p>
</li>
<li><p>A: Hey.Did you get a chance to write that check?（嘿，那张支票你开了吗?）
B: Nathan, Joel and I are not going to that dinner.Okay? (内森，我和乔尔不会参加那场宴会的, 好吗?)</p>
<p>A: Gee, I wish you would have told me that before I went and bought those tickets.
(哎呀， 我真希望你在我去买那几张票之前就通知我。)</p>
<p>B: Joel never agreed to it, and neither did I.(乔尔绝对没有答应，我也没有)
A: Well, it sure sounded like you guys were coming. I mean Leslie was
going to talk to you about it, but you don′t return our calls. I mean, I
already bought those tickets, and they′re non-refundable. I really wish you guys
had been a little more clear with me. （嗯，但你们的话的确听起来像是要参加的样子。我是说，莱斯莉本来要打电话跟你谈这事儿，但你们没回过电话。我已经买票了，都不能退的，我真希望你俩当时能跟我讲得更清楚一点)
【注】 non-refundable=a.不可退款的</p>
</li>
</ul>
<h5 id="S2-3-Wish-现在-Futurama-Into-the-Wild-Green-Yonder《飞出个未来-绿色狂想》"><a href="#S2-3-Wish-现在-Futurama-Into-the-Wild-Green-Yonder《飞出个未来-绿色狂想》" class="headerlink" title="S2-3 Wish 现在 - Futurama:Into the Wild Green Yonder《飞出个未来.绿色狂想》"></a>S2-3 Wish 现在 - Futurama:Into the Wild Green Yonder《飞出个未来.绿色狂想》</h5><ul>
<li><p>I (just) wish sb. didn’t have to… 我真希望某人现在不用……
【情】表达对当下不可改变现实的不满。
【例】I just wish we didn’t do our homework.我真希望我们现在在不用做作业。</p>
</li>
<li><p>A: It is very nice.I just wish Amy and I didn’t have to wear these sexist badges on our melons.(这很好啊，我只是不想跟艾米一起在胸前带着这个性别歧视的牌子。）
B: We’re lucky even to play as guests, Leela. Dad′s club has a very strict
“No girls allowed” policy. (我们能受邀来打球就不错了，莉拉。爸爸的俱乐部从来不让女人加入。）</p>
</li>
</ul>
<h4 id="Season-3-过去可能性的推测"><a href="#Season-3-过去可能性的推测" class="headerlink" title="Season-3 过去可能性的推测"></a>Season-3 过去可能性的推测</h4><blockquote>
<p>看到地上有一片未干的血迹， 我们可以基本推测出这里不久前发生过打斗或者事故。 再看到旁边被撞烂的单车， 和汽车紧急制动时在地上留下的轮胎痕迹，我们可以推测这里不久前很有可能发生了交通事故。这种对某事过去可能发生过的推理，如何用英语流利表达呢?</p>
</blockquote>
<h5 id="S3-1-可能性-99-的过去推测-24《反恐-24-小时》"><a href="#S3-1-可能性-99-的过去推测-24《反恐-24-小时》" class="headerlink" title="S3-1 可能性 99%的过去推测 - 24《反恐 24 小时》"></a>S3-1 可能性 99%的过去推测 - 24《反恐 24 小时》</h5><ul>
<li><p>Sb. must have done sth 某人过去一定做了某事。</p>
<p>【情】在一些相对确凿的证据面前，对过去发生的事情做出几乎 99%的肯定推断。
【例】My brother must have eaten the whole cake, because all I can find is an empty case.我弟弟一定吃光了整个蛋糕，因为我只能找到一个空盒子。
【引】It must have been sb./sth. that… 一定是某人/某事……
【例】It must have been my brother that (who) told mom my secret.
一定是弟弟把我的秘密告诉了妈妈。</p>
</li>
<li><p>A: Hello, Jack’s phone. (喂，找杰克吗?)
B: Renne, it′s Chole.I need to talk to Jack.(勒妮，我是克洛伊。我找杰克。)
A: What′s wrong? (怎么了?)
B: Samir Mehran is dead. I think he was assassinated. (萨米尔.迈赫兰死了。我认为他是被人暗杀了)
A: What do you mean, assassinated? (什么意思，暗杀?)
B: I ran a preliminary toxicology report. It showed traces of an unidentified toxin in his bloodstream.Someone must have injected him with it, probably at the scene.
(我做了份初步毒性报告。显示他血液里有不明毒素，一定是有人给他注射的，可能就在现场)
【注】 assassinate=Vt.暗杀;preliminary=a.预备的;toxicology=n.毒药学;toxin=n.毒素;bloodstream=n. 血流</p>
</li>
</ul>
<h5 id="S3-2-可能性-99-的过去推测-Spy-Kids《小鬼大间谍》"><a href="#S3-2-可能性-99-的过去推测-Spy-Kids《小鬼大间谍》" class="headerlink" title="S3-2   可能性 99%的过去推测 - Spy Kids《小鬼大间谍》"></a>S3-2   可能性 99%的过去推测 - Spy Kids《小鬼大间谍》</h5><ul>
<li><p>This must have been where. 这个地方曾经一定是……的地方。
【情】看到某个地方的现状，几乎能够断定曾经的状态。
【例】Look at the dent in the walIt may have bl, this place must have been where the crime was committed. 看看墙上的凹痕，这里一定是曾经的作案现场 It may have b。</p>
</li>
<li><p>A: Skeletons. Dead skeletons.(骨架，死人的骨架。)
B: Is there any other kind?(还有别的吗?)
A: This must have been where the pirate prisoners and treasure were kept.(这里肯定曾经是海盗的囚房和藏宝处。)</p>
</li>
</ul>
<h5 id="S3-3-可能性-75-的过去推测-Knight-Rider《霹雳游侠》"><a href="#S3-3-可能性-75-的过去推测-Knight-Rider《霹雳游侠》" class="headerlink" title="S3-3 可能性 75%的过去推测 - Knight Rider《霹雳游侠》"></a>S3-3 可能性 75%的过去推测 - Knight Rider《霹雳游侠》</h5><ul>
<li><p>Sb. may/might (not) have done sth…
某人很有(没有)可能做了某事。
【情】通过种种迹象对过去发生的事情做出 75%左右 (或加 not 表示 25%左右)的可能性推测，might 的可能性较 may 更低一些。
【例】My brother may have eaten the whole cake because he sounded weak when I asked him about it.我弟弟很有可能吃掉了整个蛋糕，因为我问他蛋糕的时候他听起来语气很弱。
【引】It may have been sb./sth. that
【例】It may have been my brother that (who) left the TV on last night.
很有可能是我弟弟昨晚没关电视。</p>
</li>
<li><p>A: What Would I have to do? （我应该做什么?）
B：The reports suggest Sergeant Burber may have died from secobarbital poisoning.
Look at the sergeant’s lips. Do they appear redder than normal? (报告说博柏利军士是由于镇静剂中毒而死，看看他的嘴唇是不是比较红? )
A:Yeah.He’s got a pretty nasty bruise on his jaw.(是啊,他的下巴有严重瘀伤。)
B: The sheriff’s report also suggests that Sergeant Burber′s body was bruised during transportation from the roadside where he Was found.
This, however is a problem.(治安官的报告中还说，博柏利军士的尸体青肿是在现场运输过程中造成的。 问题就出在这儿。）
A: Why? (什么问题? )
B: Bodies do not bruise after death. (户体是不会青肿的。)
【注】 secobarbital=n.速可眠(一种镇静药);bruise=v.使受瘀伤 n.青肿</p>
</li>
</ul>
<h5 id="S3-4-可能性-65-的过去推测-一-How-Bruce-Lee-Changed-the-World-《李小龙如何改变了世界》"><a href="#S3-4-可能性-65-的过去推测-一-How-Bruce-Lee-Changed-the-World-《李小龙如何改变了世界》" class="headerlink" title="S3-4 可能性 65%的过去推测 一 How Bruce Lee Changed the World 《李小龙如何改变了世界》"></a>S3-4 可能性 65%的过去推测 一 How Bruce Lee Changed the World 《李小龙如何改变了世界》</h5><ul>
<li><p>Without sb./sth.，it might have been + 时间 + that（before）
如果没有某人/某物，当时可能还要……的时间才……
【情】 强调表达某人/某物曾经的出现意义重大。</p>
<p>【例】 Without Steve Jobs, It might have been years before smart phones got popular.
要是没有史蒂夫.乔布斯出现，估计智能手机的流行要推迟很多年。
【例】 Without your help, it might have been hours before I found the right way.
如果不是有你的帮助， 我可能要几个小时才会找到正确的方向。</p>
</li>
<li><p>N: Soon everybody Was Kungfu fighting across the globe, and pop stars
from Donnie Osmond to the king of rock and roll himself were showing
off their Kungfu kicks.(很快，全球的人都在练习功夫，从唐尼.奥斯蒙德到猫王，
明星们都开始秀功夫。)</p>
<p>A: Without Bruce Lee and Enter the Dragon, it might have been years
and years and years and maybe not at all that martial arts as a genre
Would have become available.(没有李小龙和《龙争虎斗》的话，功夫片成为
独立流派可能还需要很多很多年，或者根本不会有这一流派。)
【注】 genre=n. (文学、艺术等的)类型，流派</p>
</li>
</ul>
<h5 id="S3-5-可能性-1-的过去推测-Aladdin-《阿拉丁》"><a href="#S3-5-可能性-1-的过去推测-Aladdin-《阿拉丁》" class="headerlink" title="S3-5 可能性 1%的过去推测-Aladdin 《阿拉丁》"></a>S3-5 可能性 1%的过去推测-Aladdin 《阿拉丁》</h5><ul>
<li><p>It couldn′t have been sb./sth..不可能是某人/某事。
【情】对过去发生的事情做出 1%可能性的推测
【例】It couldn’t have been your brother who finished up cake, he
was with me for the whole day. 你弟弟不可能吃光了蛋糕，他昨
天一整天都和我在一起。
【引】 Sb. couldn’t have done sth… 某人不可能做了某事。
【例】 My brother couldn’t have been with you yesterday.I know you
just got back from a trip today. 我弟弟不可能昨天一整天和你呆
在一起。我知道你今天刚旅行回来。</p>
</li>
<li><p>A: Wait, wait. Do I know you? (等等，我以前见过你吗?)
B: Uh, no, no. (呃， 没有， 没有。)
A: You remind me of someone I met in the marketplace.(你让我想起来
曾在市场上遇到过的一个人。)
B: The marketplace? I have servants who go to the marketplace for me.
Why, I even have servants who go to the marketplace for my servants,
so it couldn’t have been me you met.(市场?我有许多随从为我到市场买东西，
至于为什么，我甚至有随从为我的随从去市场上买东西，你遇到的人肯定不会是我。)
A: No, I guess not. (是啊，我想也不会是你。)
【注】servant=n. 仆人</p>
</li>
</ul>
<h4 id="Season-4-本来可以的"><a href="#Season-4-本来可以的" class="headerlink" title="Season-4 本来可以的"></a>Season-4 本来可以的</h4><blockquote>
<p>事情发生了， 我们总喜欢找个 “原因” 来解释，或者来归罪。</p>
</blockquote>
<ul>
<li><p>S4-1 Would have done - Desperate Housewives
《绝望的主妇》</p>
<p>sb. (probably) would have done sth., but…
某人本来(很有可能)会做某事的，但是……
【情】事后，表达一种”本来会的”心情。
【例】I would have tried a few more times to start the car,but there
was no gas left. 我本来会多试几次把车启动的，但是没有汽油了。</p>
</li>
<li><p>A: You want to explain this? (你能解释一下么? )
B: Oh, dear, I was hoping to spare your feelings, but since you
know, I wasn’t comfortable having my recipe made With substandard inngredients.
(哦，亲爱的，我不想让你难堪的。不过既然你知道了，我不喜欢用劣等食材做我的菜)
A: We use that parmesan all the time. You can’t go changing things
without asking me. (我们一直都用那种干酪。你不能不问我就擅自做改变。)</p>
<p>B: Hey, you made me partner, I can change 15%, and I chose the
parmesan. And I don’t know if you’ve heard, but people are raving
about my pizza. (嘿， 是你让我当你的合伙人的， 我能改变 15%，我选了干酪。
不知道你听见了没有，人们都在对我的比萨赞不绝口。)</p>
<p>A: Well, they probably would have loved my pizza, too. But we’ll never
know because my partner threw it in the garbage. What a waste! (他们
也许也会喜欢我的比萨, 但我们永远不会知道了，因为我的合伙人把它扔进了垃圾
桶。 真是浪费啊!)
B: Fine. I’ll reimburse you, if that’ll make things right.(好吧，我赔你，这
样行吗? ）
【注】spare one’s feelings = 不伤害某人感情，给某人留面子; substandard=a.
不合规格的; ingredient=n.配料; parmesan=n. 干酪; rave=v.咆哮，热烈赞扬;
reimburse=vt.偿还，返还</p>
</li>
</ul>
<h5 id="S4-1-Would-have-done-附加-Astro-Boy-《阿童木》"><a href="#S4-1-Would-have-done-附加-Astro-Boy-《阿童木》" class="headerlink" title="S4-1 Would have done 附加 * - Astro Boy 《阿童木》"></a>S4-1 Would have done 附加 * - Astro Boy 《阿童木》</h5><ul>
<li><p>A: Back So Soon? Did you guys find anything good for me today? I don’t
know,kids. A lot of dead batteries. A lot of elbows here. The knee joint
of a toilet-cleaning robot? I told you, I need heads. (回来的真早，今天找
到什么好东西了吗? 我不知道怎么说，孩子们。很多废电池和机器人肘部，还有打
扫厕所机器人的膝盖? 我告诉过你们， 我要的是头部。)</p>
<p>B: We would’ve gotten better stuff, but this… (我们本来会得到更好的东西,
但是……)</p>
</li>
</ul>
<h5 id="S4-2-Never-would-have-done-Yes-Man-《好好先生》"><a href="#S4-2-Never-would-have-done-Yes-Man-《好好先生》" class="headerlink" title="S4-2 Never would have done - Yes Man 《好好先生》"></a>S4-2 Never would have done - Yes Man 《好好先生》</h5><ul>
<li>I never would have done.sth., because…
我是不可能会做某事的，因为……
【情】 与预期有差别的时候，表达意外的心情;或者面对质疑的时候，
澄清过去的事。
【例】I never would have thought you could help me,because you
always seemed so cold.我当时根本没有想过你能帮我，因为你看
起来总是很冷漠。
【例】I never would have lied to you, because I loved you so much.我
当时是不可能对你撤谎的，因为我是那么的爱你。</li>
</ul>
<ul>
<li><p>A: I’m more of a four-wheel kind of guy. (我还是比较适合四个轮子的车子)</p>
<p>B: Really? I never would’ve guessed that. You seemed so at ease on
two. Can I have my helmet back now? (真的? 我可从来没有看出来过，你在
两个轮子上貌似也很自在。能把头盔还给我吗?)</p>
<p>A: I’m still wearing it, aren’t I? (我还带看头盔呢，对吗?)
B: Yeah.(是的。)
A: Thanks.(谢谢)
【注】 at ease=舒适，自在</p>
</li>
</ul>
<h5 id="S4-3-Could-have-done-Desperate-Housewives-《绝望的主妇》"><a href="#S4-3-Could-have-done-Desperate-Housewives-《绝望的主妇》" class="headerlink" title="S4-3 Could have done - Desperate Housewives 《绝望的主妇》"></a>S4-3 Could have done - Desperate Housewives 《绝望的主妇》</h5><ul>
<li>sb. could have done sth., but…(you didn’t).
你本可以做某事，但是你没有。
【情】 对别人过去做的事情表达一种种可行方案，含有淡淡的不赞成感。
【例】 You could have done better, but you didn’t. 你本来可以做得更好，
但是你没有。
【例】 I could have passed the math test, but I forgot to bring my
calculator. 我本来可以通过数学考试的，但是我忘了拿计算器。</li>
</ul>
<ul>
<li><p>A: Hey, Katherine said you wanted to talk to me. (嘿，凯瑟琳说你想跟我
谈谈。)</p>
<p>B: Yeah. Come on in. (是的，进来吧。)</p>
<p>A: You know, You could have just called. You don’t have to use her as
an intermediary. (你知道，你直接给我打个电话就可以的，你不用拿她当传话筒。)
B: Really? I thought we were using Katherine for all sorts of things-
sending message, raising our kid. (是么? 我以为我们事事都得靠凯瑟琳呢，
传个话， 抚养孩子。）</p>
<p>A: I don’t see what the big deal is. I have to work, and she has some
free time. It’s better for everybody. (我不知道这有什么大不了。 我得工作，
她又有时间。这样对所有人都好。)</p>
<p>【注】 intermediary=n. 中间人</p>
</li>
</ul>
<h5 id="S4-4-Could-have-done-Arrow-《绿箭侠》"><a href="#S4-4-Could-have-done-Arrow-《绿箭侠》" class="headerlink" title="S4-4 Could have done - Arrow 《绿箭侠》"></a>S4-4 Could have done - Arrow 《绿箭侠》</h5><ul>
<li>Sb. could have done sth… 某人可能会做某事。
【情】 事后，表达当时可能会产生的不同可能性。常表达 “好险” 或 “还
可以更好” 的心情。
【例】 You lied in court, the lawyer could have found out about lt.
你在法庭上撤谎了，律师当时很有可能发现的。
【引】 sb./sth. could have been done (by…). 某人/某事可能会被……
【情】 这个句式是核心句式的被动形式。
【例】 You went to the forest alone? You could have been eaten by a
tiger. You could have been shot by a wild man. Don’t do it again.
你独自去了森林? 你可能会被老虎吃掉, 你可能会被野人射死。不要再这样了。
Cut me some slack!
别管我那么严!放我一马!
【情】 这个橘子表达一种”求饶”的心情。经常用 cut sb. some slack/cut sb. slack 的固定形式。slack 名词的意思指: 富余的部分。生意中的”淡季”常说”slack season”
【例】 My teacher cut me some slack, I passed the quiz.我的老师放了我一马，我的小测过关了。
A: He didn′t need to call you. (他没有必要给你打电话。〉
B: No. But you’re lucky he did. You Could have lost your job. You could have lost your life and you could have killed somebody. (是的。但是幸亏
他打了。 你可能会丢掉工作，可能会丧命，还可能会撞死人。)
A: I had a few too many glasses of wine at dinner. It was an accident(晚
饭的时候我稍微多喝了几杯酒。这是个意外。)
B: An accident, Well, I guess those happen.(一个意外, 那些意外就这么发
生的。)
A: Was I not supposed to notice that tone? (我不应该听到这种语气的，是不是?)
B: The two of us… You got a lot from me,Laurel. Maybe you got this,
too.
（我们两人……你很多地方随我,劳雷尔。也许喝酒这事也随了我。)
A: You can hardly compare my one mistake to your drinking problem. (你
不能把我这点小问题和你的酗酒相提并论。)
B: As long as it it only one mistake.(除非这真是仅有的小意外。)
A: I don’t know if you’ve noticed…but I’ve had a little bit of a hard
time lately. I was kidnapped, nearly murdered by a psychopath and my
boyfriend died. So, I don’t know, maybe cut me some slack.
(我不知道你注意到没有…我最近过的不太好。我被绑架了，差点被一个变态杀人狂给杀了。
我的男朋友也死了。所以，也许你不用管我那么紧。)
B: You know, when I started having a hard time, I wish people had not cut me slack.
Leave your car here, I’m driving you home.(你知道吗，当我不好过的时候，我希望人们管我紧一点。
把你的车停在这儿，我开车送你回家。)
A: No, I’ll take a cab. (不了， 我打车。）
B: Laurel…Laurel (劳雷尔， 劳雷尔! )
【文】 B 是 A 的父亲， A 因为酒驾被警察发现， B 来接 A 回家。
【注】 kidnap=v. 绑架 ; psychopath=n. 变态杀人狂; take a cab = 打车</li>
</ul>
<h4 id="Season-5-后悔的心情"><a href="#Season-5-后悔的心情" class="headerlink" title="Season-5 后悔的心情"></a>Season-5 后悔的心情</h4><blockquote>
<p>做了决定, 结果却不如预期, 往往有一种极其不舒服的感觉,叫”后悔当初”。这是生活的常态, 学会表达后悔，才算学会表达生活。</p>
</blockquote>
<h5 id="S5-1-“我本应该”-Deviouse-Maids《蛇蝎女佣》"><a href="#S5-1-“我本应该”-Deviouse-Maids《蛇蝎女佣》" class="headerlink" title="S5-1 “我本应该” - Deviouse Maids《蛇蝎女佣》"></a>S5-1 “我本应该” - Deviouse Maids《蛇蝎女佣》</h5><ul>
<li>I should have been…(but) I wasn’t.
我本应该是…… 可是我没有。 ‘
【情】 对过去自己的某种错误状态感到后悔。
【例】 I should have been more patient with that customer, but I wasn’t.
so I lost my job. 我真应该对那个客户更耐心点，但是我没有。所
以我丢掉了那份工作。
【引】 I shouldn’t have been/done… 我当时真不应该……
【例】 I am sorry I broke your car. I shouldn’t have driven so recklessly
that day. 弄坏你的车我感到很抱歉，我那天开车真不应该太鲁莽。
A: Did you know that Evelyn and I had a Son? (你知适伊芙琳和我曾有过一
个儿子吗? )
B: No. (不知道。)
A: He died when he was six. (他六岁就死了 )
B: Oh my god. (我的天呐.)
A: I gave him a bike for his birthday. Evelyn took him out riding. She
turned her back for just a second. He rode into the street, and this car
came. Whoever was driving didn′t even stop. They just kept going. (他
生日的时候我送了他一辆自行车。 伊芙琳带他出去骑车。她转过身不到一秒钟， 他
就骑到了路上， 有一辆车开过来。 开车的人根本没有刹车。 他们继续往前开。)
B: I’m so sorry. (很遗憾。)
A: I should have been there to protect him, I wasn’t. And now he’s
gone. Evelyn is all I have left. And no one is going to take her from
me. (我真应该在那里保护他， 可是我没有。现在，他已经不在了。伊芙琳是我的
所有，没有人可以把她从我身边带走。)</li>
</ul>
<h5 id="S5-2-“我本应该”-Post-Grad-《毕业生存指南》"><a href="#S5-2-“我本应该”-Post-Grad-《毕业生存指南》" class="headerlink" title="S5-2 “我本应该” - Post Grad 《毕业生存指南》"></a>S5-2 “我本应该” - Post Grad 《毕业生存指南》</h5><ul>
<li>I should have done sth. 我当时真应该做某事。
【情】 过去没有做某事， 事后表达一种后悔心情。
【例】 I should have studied harder in high school.I hate this university.
我在高中的时候真应该再努力一些。我讨厌这个大学。
A: Hey. Life sucks without you. I miss you. Of course I miss you. I knew
that I would, but it’s not like a “hey, we had some great times…you
know keep in touch” kind of thing. It’s… It was more like “I can’t eat…
I can’t sleep… I forget what it feels like to laugh” kind of thing. And I
really think that when you lett…you took my heart with you.I probably should’ve called first.
(嘿， 生活没有你很糟糕，我想你， 当然想你， 我当时就
知道我会想你。 但这不像”嘿，我们在一起有过很多美好时光……保持联系”什么的，
这更像是 “我吃不下， 我睡不着……”我忘记大笑是什么滋味了”， 当你离开， 你把
我的心也带走了…… 我或许应该先来个电话的。）
B: Oh, whoa. Whoa. No, no, no. hold…Ryden! Whoa! Where are you
going? Ryden! (哦， 峨， 不， 不! 等等， 雷登! 喂! 你要去哪? 雷登! )
【文】 A 干里迢迢来向 B 表白， 表白完之后忽然发现 B 的房间里有别的女生， 她感到尴尬万分， 并对自己刚才的表白行为感到很后悔。</li>
</ul>
<h5 id="S5-3-“我本不该”-Yes-Man-《好好先生》"><a href="#S5-3-“我本不该”-Yes-Man-《好好先生》" class="headerlink" title="S5-3 “我本不该” - Yes Man 《好好先生》"></a>S5-3 “我本不该” - Yes Man 《好好先生》</h5><ul>
<li>I shouldn’t have done sth.. 我真不应该做某事。
【情】 过去做了某事， 事后表达一种后悔心情。
【例】 I shouldn’t have told Tom my secret. Now everybody knows.
我真不应该把我的秘密告诉汤姆的， 现在每个人都知道了。
A: I’ve been thinking and I know it’s crazy, especially for me, but maybe
when we get back, we should move in together. (我一直在想，我知道这个
想法有点疯狂，特别是对我而言, 不过, 也许我们回来之后应该搬到一起住。)
B: Wow, really? You’ve been thinking that? (哦， 真的吗? 你一直在想这件
事? ）
A: What do you think?(你觉得呢?)
B: What do I think? Uh…Yeah. (我怎么看? 呃…… 好的。)
A: Oh, God. You paused. (哦，上帝啊! 你犹豫了。)
B: No, I didn’t pause. (没有，我没有犹豫。我们的关系进了一大步。)
A: You paused. (你犹豫了。)
B: No, no, I didn’t pause. It was just a big step. (没有，我没有犹豫，我们的关
系进了一大步。)
A: It was a stupid idea. I shouldn’t have said anything…(这是个患蠢的主
意，我应该什么话都不说的……)
B: No, no, stop! Come on, what are you talking about? Here, ask me
again. (别这祥, 你在说什么? 这样吧, 你再问我一次。)
A: Do you wanna move? (你要不要搬? )
B: Yes. Did I pause there? I could probably knock a couple milliseconds
off that… (好，我犹豫了吗? 我可以再缩短几个毫秒。)</li>
</ul>
<h4 id="Season-6-指责别人的心情"><a href="#Season-6-指责别人的心情" class="headerlink" title="Season-6 指责别人的心情"></a>Season-6 指责别人的心情</h4><blockquote>
<p>别人做了决定， 产生了不好的结果， 作为旁观者总愿意去点评，指责。这是我们人性中固有的一种思维习惯。</p>
</blockquote>
<h5 id="S6-1-“你本应该”-The-Lake-House-《触不到的恋人》"><a href="#S6-1-“你本应该”-The-Lake-House-《触不到的恋人》" class="headerlink" title="S6-1 “你本应该” - The Lake House 《触不到的恋人》"></a>S6-1 “你本应该” - The Lake House 《触不到的恋人》</h5><ul>
<li>You should have done sth.. 你当时真应该做某事的。
【情】 对方过去没有做某事， 事后表达指责， 抱怨或评论。
【例】 You Should have spent more time on your studies last year. Look
at your terrible grades!你去年应该多花点时间在学习上的。看看
你糟糕的成绩!
A: It was you. Why didn’t you say anything? (那是你。 你怎么不说出来? )
B: You would’ve thought I was crazy or drunk. Or both. (但你会认为我疯
了或者喝醉了, 或二者兼有。)
A: Yeah, but I liked you. You should have said somethinG. (是的, 但是我
喜欢你, 你应该说些什么。)
B: How? You were with your boyfriend. (怎么说? 你和你男朋友
在一起。)
A: You know what? Excuses, excuses. You are a coward. (你知道吗? 这
是借口，借口，你是胆小鬼。)
B: I’m not a coward. (我不是胆小鬼。)</li>
</ul>
<h5 id="S6-2-“你本不该”-Baby-Mama-《代孕妈妈》"><a href="#S6-2-“你本不该”-Baby-Mama-《代孕妈妈》" class="headerlink" title="S6-2 “你本不该” - Baby Mama 《代孕妈妈》"></a>S6-2 “你本不该” - Baby Mama 《代孕妈妈》</h5><ul>
<li>You shouldn′t have done sth.. 你真不应该做某事。
【情】 对方过去做过某事，事后表达指责、 抱怨或评论。
【例】 You shuuldn’t have stolen the car. I guess you’ll probably have to
spend a few years in jail. 你真不应该偷那辆车，我估计你要在监
狱里住几年了。
A: You shouldn’t have forged that pregnancy test, Carl.(你不应该伪造那个
产检，卡尔。)
B: Maybe you should’ve actually gotten pregnant like you were supposed to.
You did a dumb thing, moving in with that lady. Real
dumb. We were supposed to forge the test, send her the ultrasound
picture in the mall, and then cash the checks. One, two, three. (也许你
跟预期的一样真的怀孕。 你做了件蠢事， 搬去跟那女人一起住，真的很蠢。 我
们原本可以伪造产检。 把 B 超照片寄给她， 然后能兑现支票，一， 二， 三。)
A: The ultrasound looked like a squirrel by the way. (顺便说一句, 那 B
超照片像松鼠。)
B: Cause it was a squirrel. That’s all I could find on the Internet. Look,
katie’s gonna notice. You’re not getting bigger. When you go to the
doctor’s office, and you take the test, she’s gonna know. Sweetie, you’re
not smart enough to pull this off.
(因为那就是松鼠，我在网上只能找到那个。
听着，凯蒂会发现的，你的肚子都没变大。你去医生办公室做检查的时候，她就会
知道了。亲爱的，要搞定这些事情你还不够聪明。)
【情】 forge=v.伪造; dumb=a.愚蠢的(俚语);cause 或者 cuz 都是口语中
because 的缩读形式;pull sb. off= 胜利完成</li>
</ul>
<h4 id="Season-7-淡淡的坦白"><a href="#Season-7-淡淡的坦白" class="headerlink" title="Season-7 淡淡的坦白"></a>Season-7 淡淡的坦白</h4><blockquote>
<p>对于曾经做过的错事，我们常常试图找个相对合理的理由来辩解。</p>
</blockquote>
<h5 id="S7-1-May-have-done-Gossip-Girl《绯闻少女》"><a href="#S7-1-May-have-done-Gossip-Girl《绯闻少女》" class="headerlink" title="S7-1 May have done - Gossip Girl《绯闻少女》"></a>S7-1 May have done - Gossip Girl《绯闻少女》</h5><ul>
<li>I may have done sth., but not anymore.
我可能曾经做过某事，但是以后不会了。
【情】淡淡地承认自己过去的某种行为，然后转折表决心。
【例】 I may have taken a few of your cigarettes without asking last
month, but not any more. 我可能上个月没有问你就拿过你几根香
烟，但是以后不会了。
A: I love you. And my concern is for our family. (我爱你，我的担忧都是为
了家里好。)
B: Bart, I’m not ashamed of who I am. I may have concealed things in
the past, but not anymore.I want my children to know their mother. (巴
特, 我对自己并不感到羞愧，也许我曾经隐瞒了过去的一些事情，但是再也不会了。
我希望孩子们能够了解他们的母亲。)<h5 id="S7-2-May-have-done-Desperate-Housewives《绝望的主妇》"><a href="#S7-2-May-have-done-Desperate-Housewives《绝望的主妇》" class="headerlink" title="S7-2 May have done - Desperate Housewives《绝望的主妇》"></a>S7-2 May have done - Desperate Housewives《绝望的主妇》</h5></li>
<li>I may have done sth., but… 我以前可能做过某事，但是……
【情】 淡淡地承认自己过去的某种行为，然后解释其行为。
【例】 Son, I may have hidden some of your comic books, but I did it
for your own good. 儿子，我可能是藏过你的几本浸画书，但是我
这么做都是为了你好。
【引】 She/He/They/You may have done sth., but… (某人以前可能做过某事,但是…)
【情】 表达帮他人开脱， 解释其行为。
【例】 They may have made some mistakes, but they did it with good
intentions at least. 他们可能犯了一些错误，但是至少他们的意图
是好的。
A: Katherine! Fantastic news. “What’s cooking fairview” is sending out a
camera crew tomorrow to do a piece on me and the book. (凯瑟琳，惊天
好消息,”美景妙厨”明天会派摄制组来, 拍摄一集关于我还有这本书的节目。)
B: Oh, Which I just finished this morning. (哦，我刚好今天早晨拜读完毕)
A: You read it already? (你己经读完了)
B: Yes, I couldn’t put it down. But I have to tell you at least a dozen
recipes are missing a pretty crucial ingredient. (是啊，我根本停不下来，
但我得告诉你，至少有一打食谱缺少关键成分。)
A: Really?What?(真的?缺什么？)
B: My name. (我的名字。)
A: Excuse me? (你说什么?)
B: Bree, your book is filled with recipes that we developed together
and… and some of them are flat-out mine. (布里, 你的书里都是咱们一起研
制的食谱, 有些就是赤裸裸地照搬我的创意。)
A: Oh, don’t be silly.I may have based a few on your recipes, but I
always changed something.
(哦，别傻了，我或许参考了一点你的配方，但我总是会改变些材料。)
B: Like what? The font? (比如? 字体?)
【注】 crucial=a. 至关重耍的，决定性的; ingredient=n. 原料, 成分;
flat-out=a.彻底的, 完全的;font=n.字体<h4 id="Season-8-后果很严重"><a href="#Season-8-后果很严重" class="headerlink" title="Season-8 后果很严重"></a>Season-8 后果很严重</h4><blockquote>
<p>成功之后， 我们往往会有 “后怕” 的感觉。 失败之后, 我们往往
把原因归咎于某个东西的存在。</p>
</blockquote>
<h5 id="S8-1-Weren’t-for-When-We-Left-Earth-The-NASA-Missions《从地球出发》"><a href="#S8-1-Weren’t-for-When-We-Left-Earth-The-NASA-Missions《从地球出发》" class="headerlink" title="S8-1 Weren’t for - When We Left Earth: The NASA Missions《从地球出发》"></a>S8-1 Weren’t for - When We Left Earth: The NASA Missions《从地球出发》</h5></li>
<li>If it weren’t for sb./sth., …would (be/do)… 如果不
是因为某人/某物，……会……
【情】 表达 “如果当下没有某人或某物， 后果很严重” 的感情。
【例】If it weren’t for your guidance, I would still be confused about
my future.如果不是因为有你的指导，我现在还在为前途迷茫呢。
N: Hubble can now begin to gaze deep into the universe in a perfect
focus. (现在, 哈勃望远镜就能通过完美的定焦观测到宇宙深处了。)
A: We’ve done our part. Now it’s gonna be up to the astronomers and
scientists to do their part. I could say unequivocally that if it weren’t for
the human space program, Hubble would be a piece of orbiting space junk.
(我们已经完成了我们的任务，下一步要由天文学家和科学家来完成他们的工
作了。可以肯定地说，如果不是因为人类的太空计划，哈勃望远镜就会变成一个太空垃圾。)
【注】 gaze=v./n. 注视, 凝视; unequivocally=ad. 亳无疑问地<h5 id="S8-2-Weren’t-for-附加-Aladdin-《阿拉丁》"><a href="#S8-2-Weren’t-for-附加-Aladdin-《阿拉丁》" class="headerlink" title="S8-2 Weren’t for 附加* - Aladdin 《阿拉丁》"></a>S8-2 Weren’t for 附加* - Aladdin 《阿拉丁》</h5>A: Jaffa, this is an outrage. If it Weren’t for all your years of loyal
service, but from now on, you are to discuss sentencing of prisoners
with me before they are beheaded. (贾法尔, 这是一桩暴行。如果不是看在
你多年来忠诚的份上，但从现在起，罪犯的审判必须与我讨论，然后才能杀头。)
B: I assure you. Your Highness, it won’t happen again. (我向您保证，陛丁
这事儿不会再发生了。)
【文】A 是国王，正在对 B 的不当行为表达愤怒。
【注】outrage=n. 暴行，愤怒; behead=v. 斩首<h4 id="Season-9-If-only-要是……就好了"><a href="#Season-9-If-only-要是……就好了" class="headerlink" title="Season-9 If only 要是……就好了"></a>Season-9 If only 要是……就好了</h4><blockquote>
<p>我们常常喜欢触景生情，发出感慨。</p>
</blockquote>
<h5 id="S9-1-If-only-Superhero-Movie《超级英雄》"><a href="#S9-1-If-only-Superhero-Movie《超级英雄》" class="headerlink" title="S9-1 If only - Superhero Movie《超级英雄》"></a>S9-1 If only - Superhero Movie《超级英雄》</h5></li>
<li>If only sb./sth. (were/did)…! (现在) 要是某人/某物 ……
就好了!
【情】 表达与当下现实相反的感慨。
【例】 If only I were a bird! 我要是一只鸟就好了!
【引】 if only sb./sth. had done/been… 要是当时某人/某物……就好了。
【情】 表达与过去发生的事情相反的感慨。
【例】 If only Tom had been a little more careful on that exam. 汤姆在
那场考试中要是再仔细一点就好了。
be cut out to be… (天生)适合做……
【近】 cut out for (doing)…
【例】 Tom is not cut to be a teacher. He has no patience at all.
汤姆天生不适合做老师，他一点耐心也没有。
be meant to… 命中注定要……/应该是……
【例】 We lost three games in a row. Maybe we were meant be lost.我们连输三场比赛，也许命中注定我们会失败。
A: Gotcha. (抓住了。)
B: Rick? (里克?)
A: You didn’t think I’d let anything happen to the girl I love, did you? (你
知道我不会让我喜欢的女孩出事，对吧? )
B: Well we’re still faliing. (不过我们还在往下掉啊。)
A: Damn it! If only I could fly. May be I wasn’t cut out to be a hero. You
know, maybe I was meant to have a normal job…an accountant, a gym
teacher. This is a really tall building. (该死! 我要是能飞就好了。也许我天生
就不是个英雄。就应该去从事一份普通的工作……会计师、体育老师。这楼真高!)
B: Rick! I don’t care what happens anymore. If I die, I die happlly in
your arms. You are my hero, Rick Ricker and I love you. (里克! 我什么都
不管了。就算死, 也要幸福地死在你怀里。 你就是我的英雄里克.瑞克，我爱你。)
【注】 accountant=n. 会计; in one’s arms=在某人怀抱里</li>
</ul>
<h5 id="S9-2-If-only-Desperate-Housewives《绝望的主妇》"><a href="#S9-2-If-only-Desperate-Housewives《绝望的主妇》" class="headerlink" title="S9-2 If only - Desperate Housewives《绝望的主妇》"></a>S9-2 If only - Desperate Housewives《绝望的主妇》</h5><ul>
<li>If only there was/were…! 要是现在有……就好了!
【情】 表达对不存在的东西的渴望
【例】 If only there was someone who could totally understand me. 要是
现在有个能够完全理解我的人就好了。
【引】 If only there had been… 要是当时有……就好了（强调过去)。
【例】 If only there had been a doctor on that plane, Lucy could have
been saved from that heart attack. 要是当时飞机上有医生就好了，
那样露西就有可能从心脏病发作中获救。
A: What are you doing? (你干嘛呢?)
B: Okay, where are they? It’s 30 mintues past curfew.(他们哪去了? 超过
宵禁时间 30 分钟了。)
A: Actually, it’s 32. (其实是 32 分钟。)
B: If there is a single scratch on that car, I mean, after all the time that
I spent restoring that thing… (要是车上有一丝划痕，我是说，我花了那么多
心血修复的。)
A: Yeah. Remember when you spend the entire day on the Internet
trying to find a new gearshift knob? Worst anniversary ever.(是啊，记得
那次你花一整天上网买挡把套吗? 那是最禧糕的结婚纪念日。)
B: I cannot believe that you did this to me. (真不敢相信你怎么这样说我。)
A: I know. That cat is your baby. If only there was something I felt that
intensely about.Oh, wait!There is, my actual bables. (我知道，那辆车是
你的宝贝。要是我也有这么上心的东西就好了。 对了, 有啊, 我的孩子们。)
B: You think I don’t care about our boys? (你以为我不关心儿子们? )
A: I know you love them, but sometimes you find them so cool and
entertaining, you forget to parent them. (我知道你爱他们, 但有时你看他们
这么酷这么有趣, 就忘记怎么为人父了。)
【注】 curfew=n. 宵禁; scratch=n. 划痕; restore=v. 修复; gearshift knob=
变速拍档把手</li>
</ul>
<p>句尾儿化音特征</p>
<p>[əː][ɑː][ɔː]<a href="%E5%9C%A8%E8%AF%8D%E5%B0%BE">ə</a>[iə][uə][ɔː]等元音在单词中多被儿化。
[ɑː] far, bar, mark
[əː] bird, sir, nerd, fur
[ə] doctor, worker (在词尾, 并多以 or, er 结尾词)
[eə] fair, air, pair
[iə] ear, tear, near
[uə] sure, tour, lure
[ɔː] or, bored, horse, north (talk 没儿化)</p>
<p>\n 易错儿化音
\n1) [ə] 在词”中间”出现一般不带儿化
\ncampus, delicious, purpose, because
\n2) 不以 or, er 结尾的词一般[ə]在词尾不带儿化
\nChina, idea, media, wanna, gonna, via[ˈvaɪə], aroma, coma, formula</p>
<p>特征:美音特殊发音变化
\n[ɔ] 发 [ʌ] hot, pot, cops
\n[ʌ] 发 [æ] fast, class, afternoon, basketball
\n[ju:] 发 [u:] supermarket, introduce</p>
<p>\n[t] 出现在两个元音之间， 且不再重读位置时， 被浊化成近乎[d]的音
\nforty，party，daughter; I got it. [gɔdit]; I don’t know what it is.[wɔdidiz]</p>
<p>\n 特征: 美语口语中高频简读现象
\nwant to = wanna <a href="%E6%83%B3%E8%A6%81">‘wɔnə</a>
\n 例: I wanna do this.</p>
<p>\ngoing to = gonna <a href="%E5%B0%86%E8%A6%81">‘ɡɔnə</a>
\n 例: I am gonna leave this place.
\ngot to = gotta <a href="%E5%BF%85%E9%A1%BB">‘gɔte</a></p>
<p>\n 例: You gotta go home.</p>
<p>\nbecause = cuz [‘kəz]
\nhim = 在句中连读时常被读成[im]
\n 例 = take him [teikim]
\nand=在句中常被读成[n]
\n 例: Let’s share, you and me [juː n miː]</p>
<p>\n3k 链音法
\n(Linking of Sound)
\n 链音也就是连读， 大家一定不陌生。 这是阻碍我们听力的最大障碍之一。
\n 什么是链音? 顾名思义，把音像链子一样连起来读
\n 怎么连? 怎么读呢？</p>
<p>元音: 承载整个词声音的核心部分。
辅音: 辅助修饰元音的音。</p>
<p>元音: [iː][i] [e][æ] [ɑː][ʌ] [ɔː][uː] [u][əː]
[ə][ei] [ai][oi] [ɔi][au] [iə][eə] [uə]</p>
<p>辅音: [p][b] [t][d] [k][g] [f][v] [s][z] [θ][ð]
[ʃ][ʒ] [tʃ][dʒ] [tr][dr] [dz][m] [n][ŋ] [h][l] [r][w] [j]</p>
<p>k-9 连读:(元音 + 辅音)</p>
<p>\n 这是最普遍的连读现象。连读后，连起来的部分听起来像以个词。
\n 例 1: All of them love it.
\n[ɔːlɔv][lɔvit]</p>
<p>\n 例 2: Take off your coat and pass it up here, so I can fix it for you.
\n[teikɔv][pɑːsidʌp] [fiksit]</p>
<p>K-10 连读:(辅音 + 辅音)
失去爆破现象
\n6 个爆破音: [p][b][t][d][k][g]
\n 当爆破音与爆破音相连时， 或爆破音与某些辅音相连时, 前一个
音失去爆破， 做嘴型而不发声。 也叫不完全爆破。</p>
<p>\n1) 爆破音+爆破音
\n 例: I need a black pen.
\n2) 爆破音+擦音
\n[s][z][θ][ð][ʃ][ʒ] [tʃ][dʒ]
\n 例: Please take the weapon to protect your dream.
\n3) 爆破音+鼻音 ([m][n][n])
\n 例: Take Nick away.</p>
<p>\n4) 爆破音+舌音 （[|]）
\n 例：Let love take over the world.</p>
<p>K-11 连读: (必备变音规律)</p>
<p>1)[t]+[j]=[tʃ]
\n 例: I will let you go now for your stealing; Wouldn’t you feel sad aboutit? [letʃu]</p>
<p>\n2） [d]+[j]=[dʒ]
\n 例: Would you please tell me your name? Did you hear my question, sir?
\n[wudʒu][didʒu]</p>
<p>\n3) [s]+[j]=[ʃ]
\n 例: I miss you.
\n[miʃu]
\nThis hat makes you look old.
\n[meikʃu]</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="codingories.github.io/2020/03/20/React%E5%85%A8%E8%A7%A3%E4%B9%8B03Hooks%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://i.loli.net/2020/07/12/RPjkZxei6agC49U.jpg">
      <meta itemprop="name" content="Ories">
      <meta itemprop="description" content="这个博客用来记录自己的生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OriesノBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/20/React%E5%85%A8%E8%A7%A3%E4%B9%8B03Hooks%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/" class="post-title-link" itemprop="url">React全解之03Hooks原理解析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-20 08:45:59" itemprop="dateCreated datePublished" datetime="2020-03-20T08:45:59+08:00">2020-03-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-02 16:20:53" itemprop="dateModified" datetime="2020-10-02T16:20:53+08:00">2020-10-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">前端框架</span></a>
                </span>
            </span>

          
            <span id="/2020/03/20/React%E5%85%A8%E8%A7%A3%E4%B9%8B03Hooks%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/" class="post-meta-item leancloud_visitors" data-flag-title="React全解之03Hooks原理解析" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2020/03/20/React%E5%85%A8%E8%A7%A3%E4%B9%8B03Hooks%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/03/20/React%E5%85%A8%E8%A7%A3%E4%B9%8B03Hooks%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="1-案例一-点击按钮-1"><a href="#1-案例一-点击按钮-1" class="headerlink" title="1. 案例一.点击按钮+1"></a>1. 案例一.<a href="https://codesandbox.io/s/pedantic-currying-99vm4" target="_blank" rel="noopener">点击按钮+1</a></h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"App 运行了"</span>);</span><br><span class="line">  <span class="keyword">const</span> [n, setN] = React.useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;p&gt;&#123;n&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">      &lt;p&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;() =&gt; setN(n + 1)&#125;&gt;+1&lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>

<ul>
<li>同样的 n 在不同的次数执行，得出的结果是不一样的</li>
<li>首次渲染 render<code>&lt;App/&gt;</code>组件, App 组件会调用 App 函数，执行之后得到虚拟 DIV 创建，创建真实 DIV</li>
<li>用户点击 button 调用 setN(N+1) 再次 render<code>&lt;App /&gt;</code></li>
<li>调用 App(),得到虚拟 DIV,DOM Diff 更新真 DIV,每次调用 App(),都会运行 State(0)</li>
<li>每次调用 App(),都会运行 useState(0),每次 useState 的 n 不一样</li>
<li><img src="https://i.loli.net/2020/10/02/XdbexN3WtuT5nrs.png" alt="react_1.png"></li>
</ul>
<h3 id="2-问自己几个问题"><a href="#2-问自己几个问题" class="headerlink" title="2. 问自己几个问题"></a>2. 问自己几个问题</h3><ul>
<li>引出问题: 执行 setN 的时候会发生什么？n 会变吗？App()会重新执行吗？<ul>
<li>执行 setN 表示要把 n 变了，这个时候 n 是不变的，即 setN 并不会改变 n,App 会重新执行</li>
</ul>
</li>
<li>如果 App()会重新执行，那么 useState(0)的时候，n 每次的值会不同吗?<ul>
<li>确实 n 的值是不同的</li>
</ul>
</li>
<li>通过 console.log 得到答案</li>
</ul>
<ol>
<li>分析</li>
</ol>
<ul>
<li>setN<ul>
<li>setN 一定会修改数据 x, 将 n+1 存入 x</li>
<li>setN 一定会触发<code>&lt;App/ &gt;</code> 重新渲染</li>
</ul>
</li>
<li>useState<ul>
<li>useState 肯定会从 x 读取 n 的最新值</li>
</ul>
</li>
<li>x<ul>
<li>x,每个组件有自己的数据 x，我们将其命名为 state</li>
</ul>
</li>
</ul>
<h3 id="3-首次尝试实现-useState"><a href="#3-首次尝试实现-useState" class="headerlink" title="3. 首次尝试实现 useState"></a>3. <a href="https://codesandbox.io/s/jolly-paper-g6c6j" target="_blank" rel="noopener">首次尝试实现 useState</a></h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootElement = <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> myUseState = <span class="function">(<span class="params">initialValue</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"myUseState run"</span>);</span><br><span class="line">  <span class="keyword">let</span> state = initialValue;</span><br><span class="line">  <span class="keyword">const</span> setState = <span class="function">(<span class="params">newValue</span>) =&gt;</span> &#123;</span><br><span class="line">    state = newValue;</span><br><span class="line">    render();</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> [state, setState];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> render = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, rootElement);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"App 运行了"</span>);</span><br><span class="line">  <span class="keyword">const</span> [n, setN] = myUseState(<span class="number">0</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`n:<span class="subst">$&#123;n&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"Apps"</span>&gt;</span><br><span class="line">      &lt;p&gt;&#123;n&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">      &lt;p&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;() =&gt; setN(n + 1)&#125;&gt;+1&lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, rootElement);</span><br></pre></td></tr></table></figure>

<ul>
<li>这样写之后还是不行，因为每次 render,n 都是初始值，解决方法是把 state 放到外面, 只要声明在 myUseState 外面即可</li>
<li>进行这样改写就可以了。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="keyword">const</span> rootElement = <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> _state;</span><br><span class="line"><span class="keyword">const</span> myUseState = <span class="function">(<span class="params">initialValue</span>) =&gt;</span> &#123;</span><br><span class="line">  _state = _state === <span class="literal">undefined</span> ? initialValue : _state;</span><br><span class="line">  <span class="keyword">const</span> setState = <span class="function">(<span class="params">newValue</span>) =&gt;</span> &#123;</span><br><span class="line">    _state = newValue;</span><br><span class="line">    render();</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> [_state, setState];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> render = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, rootElement);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [n, setN] = myUseState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;p&gt;&#123;n&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">      &lt;p&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;() =&gt; setN(n + 1)&#125;&gt;+1&lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, rootElement);</span><br></pre></td></tr></table></figure>

<h3 id="4-如果一个组件用了多个-useState-怎么办？"><a href="#4-如果一个组件用了多个-useState-怎么办？" class="headerlink" title="4. 如果一个组件用了多个 useState 怎么办？"></a>4. 如果一个组件用了多个 useState 怎么办？</h3><ul>
<li>有两种改进思路</li>
</ul>
<ol>
<li> 把_state 做成一个对象</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">比如_state &#x3D; &#123;n:0,m:0&#125;</span><br><span class="line">这种不行，因为useState(0)并不知道变量叫n 还是m</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>把_state 做成数组</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">比如_state &#x3D; [0,0]</span><br></pre></td></tr></table></figure>

<ul>
<li>如何让多个 useState 不冲突</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootElement = <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> _state = [];</span><br><span class="line"><span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> myUseState = <span class="function">(<span class="params">initialValue</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> currentIndex = index;</span><br><span class="line">  <span class="comment">// 这样写的原因是因为+1之后再return就return的是下一个了,n,m就不会出现再页面上是undefined</span></span><br><span class="line">  _state[currentIndex] =</span><br><span class="line">    _state[currentIndex] === <span class="literal">undefined</span> ? initialValue : _state[currentIndex];</span><br><span class="line">  <span class="keyword">const</span> setState = <span class="function">(<span class="params">newValue</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(currentIndex);</span><br><span class="line">    _state[currentIndex] = newValue;</span><br><span class="line">    render();</span><br><span class="line">  &#125;;</span><br><span class="line">  index += <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> [_state[currentIndex], setState];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> render = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  index = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">// 理论上说每次渲染app之前都需要重置index,这一步是最重要的</span></span><br><span class="line">  ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, rootElement);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [n, setN] = myUseState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [m, setM] = myUseState(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;p&gt;&#123;n&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">      &lt;p&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;() =&gt; setN(n + 1)&#125;&gt;+1&lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">      &lt;p&gt;&#123;m&#125;&lt;/</span>p&gt;</span><br><span class="line">      &lt;p&gt;</span><br><span class="line">        &lt;button onClick=&#123;() =&gt; setM(n + <span class="number">1</span>)&#125;&gt;+<span class="number">1</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>p&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">ReactDOM.render(&lt;App /</span>&gt;, rootElement);</span><br></pre></td></tr></table></figure>

<h3 id="5-state-数组方案的缺点"><a href="#5-state-数组方案的缺点" class="headerlink" title="5. _state 数组方案的缺点"></a>5. _state 数组方案的缺点</h3><ul>
<li>useState 调用顺序<ul>
<li>若第一次渲染时 n 是第一个,m 是第二个,k 是第三个</li>
<li>则第二次渲染时必须保证顺序完全一致</li>
<li>所以 React 不允许出现如下代码, react hooks 不能写在条件循环</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (n % <span class="number">2</span> === <span class="number">1</span>) &#123;</span><br><span class="line">  [m, setN] = React.useState(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>题外话:Vue3 克服了这个问题。所以，尤雨溪说 Vue3 借鉴了 React 的思想，但是比 React 做的更好。</li>
</ul>
<h3 id="6-现在代码还有一个问题"><a href="#6-现在代码还有一个问题" class="headerlink" title="6. 现在代码还有一个问题"></a>6. 现在代码还有一个问题</h3><ul>
<li><p>App 用了_state 和 index, 那其他组件用什么？</p>
<ul>
<li>解决办法:给每个组件创建一个_state 和 index</li>
</ul>
</li>
<li><p>又有问题:放在全局作用域里重命名了怎么办？</p>
<ul>
<li>解决办法:放在组件对应的虚拟节点对象上</li>
</ul>
</li>
<li><p>app 组件更新过程
<img src="https://i.loli.net/2020/10/02/lqEaI2KVhmNHovX.png" alt="app组件更新过程.png"></p>
</li>
<li><p>上图只画了 App 组件的更新过程，两个 ChildA 组件也有同样的过程</p>
</li>
</ul>
<h3 id="7-总结"><a href="#7-总结" class="headerlink" title="7. 总结"></a>7. 总结</h3><ul>
<li>每个函数组件对应一个 React 节点</li>
<li>每个节点保存着 state 和 index</li>
<li>useState 会读取<code>state[index]</code></li>
<li>index 由 useState 出现的顺序决定</li>
<li>setState 会修改 state,并触发更新</li>
<li>注意: 本篇文章对 React 的实现做了简化，React 节点应该是 FiberNode,_state 的真实名称为 memorizedState, index 的实现则用到了链表</li>
</ul>
<h3 id="8-useState-错误理解案例"><a href="#8-useState-错误理解案例" class="headerlink" title="8. useState 错误理解案例"></a>8. useState 错误理解案例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="keyword">const</span> rootElement = <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [n, setN] = React.useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> log = <span class="function"><span class="params">()</span> =&gt;</span> setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`n: <span class="subst">$&#123;n&#125;</span>`</span>), <span class="number">3000</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;p&gt;&#123;n&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">      &lt;p&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button</span></span><br><span class="line"><span class="regexp">          onClick=&#123;() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">            setN(n + 1);</span></span><br><span class="line"><span class="regexp">          &#125;&#125;</span></span><br><span class="line"><span class="regexp">        &gt;</span></span><br><span class="line"><span class="regexp">          +1</span></span><br><span class="line"><span class="regexp">        &lt;/</span>button&gt;</span><br><span class="line">        &lt;button onClick=&#123;log&#125;&gt;log&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">        &#123;/</span>*点击log <span class="number">3</span>秒后把n打印出n*<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>p&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 两种操作</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 1. 点击+1再点击log-- 无bug</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 2. 点击log再点击+1-- 有bug</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 问题: 为什么log出了旧数据?</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">ReactDOM.render(&lt;App /</span>&gt;, rootElement);</span><br></pre></td></tr></table></figure>

<ul>
<li>其实和 for 循环 setTimeOut 0, 函数打印出 6 个 6 一样
<img src="https://i.loli.net/2020/10/02/5VXtFxBTZhcUQ4e.png" alt="n的分身.png"></li>
</ul>
<h3 id="9-如何有贯穿始终的状态"><a href="#9-如何有贯穿始终的状态" class="headerlink" title="9. 如何有贯穿始终的状态"></a>9. 如何有贯穿始终的状态</h3><ul>
<li>Vue3 就是每次都是一次 n</li>
<li>React 底层思想非常倾向函数式所以不希望 n 多次变化</li>
<li>解决办法:<ul>
<li>全局变量, window.xxx, 太 low 了</li>
<li>useRef 例子,<ul>
<li><a href="https://codesandbox.io/s/flamboyant-elion-jvtl2" target="_blank" rel="noopener">https://codesandbox.io/s/flamboyant-elion-jvtl2</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="keyword">const</span> rootElement = <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> nRef = React.useRef(<span class="number">0</span>); <span class="comment">// Ref就是一个很简单的对象。 &#123; current:0 &#125;</span></span><br><span class="line">  <span class="keyword">const</span> log = <span class="function"><span class="params">()</span> =&gt;</span> setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`n: <span class="subst">$&#123;nRef.current&#125;</span>`</span>), <span class="number">1000</span>);</span><br><span class="line">  <span class="comment">// Vue3里面的current是value</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;p&gt;&#123;nRef.current&#125; 这里并不能实时更新&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">      &lt;p&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;() =&gt; (nRef.current += 1)&#125;&gt;+1&lt;/</span>button&gt;</span><br><span class="line">        &lt;button onClick=&#123;log&#125;&gt;log&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>p&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 那我就是要让Ref重新渲染怎么办，React做不到，就是不会重新渲染</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 用Vue3吧，Vue能做到，所以Vue3很可能会抢走React一部分用户，因为Api更符合人的直觉</span></span><br><span class="line"><span class="regexp">ReactDOM.render(&lt;App /</span>&gt;, rootElement);</span><br></pre></td></tr></table></figure>

<ul>
<li>手动造出来让 useRef 更新 dom</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="keyword">const</span> rootElement = <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> nRef = React.useRef(<span class="number">0</span>); <span class="comment">// Ref就是一个很简单的对象。 &#123; current:0 &#125;</span></span><br><span class="line">  <span class="keyword">const</span> log = <span class="function"><span class="params">()</span> =&gt;</span> setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`n: <span class="subst">$&#123;nRef.current&#125;</span>`</span>), <span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">const</span> update = React.useState(<span class="literal">null</span>)[<span class="number">1</span>];</span><br><span class="line">  <span class="comment">// Vue3里面的current是value</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;p&gt;&#123;nRef.current&#125; 这里能实时更新&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">      &lt;p&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button</span></span><br><span class="line"><span class="regexp">          onClick=&#123;() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">            nRef.current += 1;</span></span><br><span class="line"><span class="regexp">            update(nRef.current);</span></span><br><span class="line"><span class="regexp">          &#125;&#125;</span></span><br><span class="line"><span class="regexp">        &gt;</span></span><br><span class="line"><span class="regexp">          +1</span></span><br><span class="line"><span class="regexp">        &lt;/</span>button&gt;</span><br><span class="line">        &lt;button onClick=&#123;log&#125;&gt;log&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>p&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 那我就是要让Ref重新渲染怎么办，React做不到，就是不会重新渲染</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 用Vue3吧，Vue能做到，所以Vue3很可能会抢走React一部分用户，因为Api更符合人的直觉</span></span><br><span class="line"><span class="regexp">ReactDOM.render(&lt;App /</span>&gt;, rootElement);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Vue3 主要抄了 React 两个地方</p>
<ul>
<li>hooks 的思想</li>
<li>不使用 useState,而是用 useRef，再你自己对 useRef 的 current 的值做变更的时候，自动的去 update</li>
</ul>
</li>
<li><p>通过 useContext 实现贯穿始终,useRef 只是贯穿一个组件的前中后,useContext 是贯穿所有组件,大多数情况还是用 useRef,除非是非常重的方法用 useContext</p>
</li>
<li><p>强制更新的例子,<a href="https://codesandbox.io/s/wizardly-grothendieck-ek0i5" target="_blank" rel="noopener">https://codesandbox.io/s/wizardly-grothendieck-ek0i5</a></p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"./styles.css"</span>;</span><br><span class="line"><span class="keyword">const</span> rootElement = <span class="built_in">document</span>.getElementById(<span class="string">"root"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> themeContext = React.createContext(<span class="literal">null</span>);</span><br><span class="line"><span class="comment">// 上下文其实就是一个全局变量,把themeContext理解为一个全局变量</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [theme, setTheme] = React.useState(<span class="string">"red"</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;themeContext.Provider value=&#123;&#123; theme, setTheme &#125;&#125;&gt;</span><br><span class="line">      &#123;<span class="comment">/*value的意思是我们对全局变量进行一次赋值,值就是一个对象*/</span>&#125;</span><br><span class="line">      &#123;<span class="comment">/*themeContext.Provider 表示作用域的开始和结束*/</span>&#125;</span><br><span class="line">      &lt;div className=&#123;<span class="string">`App <span class="subst">$&#123;theme&#125;</span>`</span>&#125;&gt;</span><br><span class="line">        &lt;p&gt;&#123;theme&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">        &lt;div&gt;</span></span><br><span class="line"><span class="regexp">          &lt;ChildA /</span>&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;div&gt;</span></span><br><span class="line"><span class="regexp">          &lt;ChildB /</span>&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/themeContext.Provider&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function ChildA() &#123;</span></span><br><span class="line"><span class="regexp">  const &#123; setTheme &#125; = React.useContext(themeContext);</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button onClick=&#123;() =&gt; setTheme("red")&#125;&gt;red&lt;/</span>button&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">function ChildB() &#123;</span></span><br><span class="line"><span class="regexp">  const &#123; setTheme &#125; = React.useContext(themeContext);</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button onClick=&#123;() =&gt; setTheme("blue")&#125;&gt;blue&lt;/</span>button&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">ReactDOM.render(&lt;App /</span>&gt;, rootElement);</span><br></pre></td></tr></table></figure>

<h3 id="10-总结"><a href="#10-总结" class="headerlink" title="10. 总结"></a>10. 总结</h3><ul>
<li>每次重新渲染，组件函数就会执行</li>
<li>对应的所有 state 就会出现[分身]</li>
<li>如果不希望出现分身，可以用 useRef/useContext 等解决</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="codingories.github.io/2020/03/19/React%E5%85%A8%E8%A7%A3%E4%B9%8B02%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6%E8%AF%A6%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://i.loli.net/2020/07/12/RPjkZxei6agC49U.jpg">
      <meta itemprop="name" content="Ories">
      <meta itemprop="description" content="这个博客用来记录自己的生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OriesノBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/19/React%E5%85%A8%E8%A7%A3%E4%B9%8B02%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6%E8%AF%A6%E8%A7%A3/" class="post-title-link" itemprop="url">React全解之02函数组件详解</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-19 09:34:22" itemprop="dateCreated datePublished" datetime="2020-03-19T09:34:22+08:00">2020-03-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-01 12:58:09" itemprop="dateModified" datetime="2020-10-01T12:58:09+08:00">2020-10-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">前端框架</span></a>
                </span>
            </span>

          
            <span id="/2020/03/19/React%E5%85%A8%E8%A7%A3%E4%B9%8B02%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6%E8%AF%A6%E8%A7%A3/" class="post-meta-item leancloud_visitors" data-flag-title="React全解之02函数组件详解" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2020/03/19/React%E5%85%A8%E8%A7%A3%E4%B9%8B02%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6%E8%AF%A6%E8%A7%A3/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/03/19/React%E5%85%A8%E8%A7%A3%E4%B9%8B02%E5%87%BD%E6%95%B0%E7%BB%84%E4%BB%B6%E8%AF%A6%E8%A7%A3/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ol>
<li>创建方式</li>
</ol>
<ul>
<li>方式一<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Hello = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;props.message&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li>
<li>方式二<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Hello = <span class="function">(<span class="params">props</span>) =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;props.message&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br></pre></td></tr></table></figure></li>
<li>方式三<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Hello</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;props.message&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol start="2">
<li><p>用 class 组件写+1 和用函数组件写+1 对比</p>
<ul>
<li>class 组件</li>
</ul>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123; <span class="attr">n</span>: <span class="number">1</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(<span class="function">(<span class="params">state</span>) =&gt;</span> (&#123; <span class="attr">n</span>: state.n + <span class="number">1</span> &#125;));</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &#123;<span class="keyword">this</span>.state.n&#125;</span><br><span class="line">        &lt;button onClick=&#123;<span class="keyword">this</span>.onClick&#125;&gt;+<span class="number">1</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>

<ul>
<li>函数组件</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [n, setN] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> onClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setN(n + <span class="number">1</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;n&#125;</span><br><span class="line">      &lt;button onClick=&#123;onClick&#125;&gt;+<span class="number">1</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>

<ol>
<li><p>函数组件想要代替 class 组件面对的两个问题</p>
<ol>
<li>没有 state 怎么办</li>
</ol>
<ul>
<li>通过 useState 解决</li>
</ul>
<ol start="2">
<li>没有生命周期怎么办</li>
</ol>
<ul>
<li>通过 useEffect 解决,面试问就说解决副作用问题</li>
<li>模拟 componentDidMount,第一次渲染</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"渲染一次"</span>);</span><br><span class="line">&#125;, []); <span class="comment">// 模拟componentDidMount</span></span><br></pre></td></tr></table></figure>

<ul>
<li>模拟 当某个值(n)变了，做出对应变动</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"n变了"</span>);</span><br><span class="line">&#125;, [n]);</span><br><span class="line"><span class="comment">// 模拟componentDidUpdate</span></span><br></pre></td></tr></table></figure>

<ul>
<li>模拟 当多个值(n 或者 m)变了，做出对应变动</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"n或者m变了"</span>);</span><br><span class="line">&#125;, [n, m]);</span><br><span class="line"><span class="comment">// 模拟componentDidUpdate</span></span><br></pre></td></tr></table></figure>

<ul>
<li>模拟 当所有 state 的值变了，做出对应变动</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"任意属性变更"</span>);</span><br><span class="line">&#125;; <span class="comment">// 模拟componentDidUpdate</span></span><br></pre></td></tr></table></figure>

<ul>
<li>模拟 componentWillUnmount,通过 useEffect 里面再增加 return,模拟将死之人,return 的函数就是快死的</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> App = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [childVisible, setChildVisible] = useState(<span class="literal">true</span>);</span><br><span class="line">  <span class="keyword">const</span> hide = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setChildVisible(<span class="literal">false</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> show = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setChildVisible(<span class="literal">true</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;childVisible ? (</span><br><span class="line">        &lt;button onClick=&#123;hide&#125;&gt;hide&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      ) : (</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;show&#125;&gt;show&lt;/</span>button&gt;</span><br><span class="line">      )&#125;</span><br><span class="line">      &#123;childVisible ? <span class="xml"><span class="tag">&lt;<span class="name">Child</span> /&gt;</span></span> : <span class="literal">null</span>&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const Child = (props) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    return () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">      console.log("Child 销毁了");</span></span><br><span class="line"><span class="regexp">    &#125;;</span></span><br><span class="line"><span class="regexp">  &#125;);</span></span><br><span class="line"><span class="regexp">  return &lt;div&gt;Child&lt;/</span>div&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li><p>模拟 constructor</p>
<ul>
<li>constructor,函数组件执行的时候，就相当于 constructor,就是 return 之前的这一些代码</li>
</ul>
</li>
<li><p>shouldComponentUpdate</p>
<ul>
<li>React.memo 和 useMemo 可以解决</li>
</ul>
</li>
<li><p>通过 return 模拟 render</p>
</li>
<li><p>使用自定义的 hook 实现从第二次属性变化开始执行</p>
<ul>
<li><p>先写成这样</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [n, setN] = useState(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> onClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setN(n + <span class="number">1</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [nUpdateCount, setNUpdateCount] = useState(<span class="number">0</span>);</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setNUpdateCount(<span class="function">(<span class="params">x</span>) =&gt;</span> x + <span class="number">1</span>);</span><br><span class="line">  &#125;, [n]);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (nUpdateCount &gt; <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"n变了"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [nUpdateCount]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;n&#125;</span><br><span class="line">      &lt;button onClick=&#123;onClick&#125;&gt;+<span class="number">1</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
</li>
<li><p>第二版改写</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [n, setN] = useState(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> onClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setN(n + <span class="number">1</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> useX = <span class="function">(<span class="params">n</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [nUpdateCount, setNUpdateCount] = useState(<span class="number">0</span>);</span><br><span class="line">    useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      setNUpdateCount(<span class="function">(<span class="params">x</span>) =&gt;</span> x + <span class="number">1</span>);</span><br><span class="line">    &#125;, [n]);</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      nUpdateCount: nUpdateCount,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> nUpdateCount = useX(n).nUpdateCount;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (nUpdateCount &gt; <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"n变了"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [nUpdateCount]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;n&#125;</span><br><span class="line">      &lt;button onClick=&#123;onClick&#125;&gt;+<span class="number">1</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
</li>
<li><p>第三版优化</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// useUpdate.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useUpdate = <span class="function">(<span class="params">fn, dep</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setCount(<span class="function">(<span class="params">x</span>) =&gt;</span> x + <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// eslint-disable-next-line</span></span><br><span class="line">  &#125;, [dep]);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (count &gt; <span class="number">1</span>) &#123;</span><br><span class="line">      fn();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [count, fn]);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useUpdate;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> useUpdate <span class="keyword">from</span> <span class="string">"./useUpdate"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [n, setN] = useState(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> onClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setN(n + <span class="number">1</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  useUpdate(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"n 变了"</span>);</span><br><span class="line">  &#125;, n);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;n&#125;</span><br><span class="line">      &lt;button onClick=&#123;onClick&#125;&gt;+<span class="number">1</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/8/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/page/26/">26</a><a class="extend next" rel="next" href="/page/10/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ories"
      src="https://i.loli.net/2020/07/12/RPjkZxei6agC49U.jpg">
  <p class="site-author-name" itemprop="name">Ories</p>
  <div class="site-description" itemprop="description">这个博客用来记录自己的生活</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">251</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">74</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/codingories" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;codingories" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ories</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/valine@1.3.9/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : true,
      notify     : true,
      appId      : 'HHvArpMYcwuYjNb3703JgvvS-gzGzoHsz',
      appKey     : '5lSamU58UyScrMIQcUygcD2I',
      placeholder: "欢迎畅所欲言",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : 'true'
    });
  }, window.Valine);
});
</script>

</body>
</html>
