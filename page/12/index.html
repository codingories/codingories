<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"codingories.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="这个博客用来记录自己的生活">
<meta property="og:type" content="website">
<meta property="og:title" content="OriesノBlog">
<meta property="og:url" content="codingories.github.io/page/12/index.html">
<meta property="og:site_name" content="OriesノBlog">
<meta property="og:description" content="这个博客用来记录自己的生活">
<meta property="article:author" content="Ories">
<meta property="article:tag" content="编程 吉他 rap">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="codingories.github.io/page/12/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-Hans'
  };
</script>

  <title>OriesノBlog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">OriesノBlog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">朱骏杰的私人博客</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="codingories.github.io/2020/01/29/Vue%E9%80%A0%E8%BD%AE%E5%AD%90-popover%E7%BB%84%E4%BB%B6-%E4%B8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://i.loli.net/2020/07/12/RPjkZxei6agC49U.jpg">
      <meta itemprop="name" content="Ories">
      <meta itemprop="description" content="这个博客用来记录自己的生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OriesノBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/29/Vue%E9%80%A0%E8%BD%AE%E5%AD%90-popover%E7%BB%84%E4%BB%B6-%E4%B8%8B/" class="post-title-link" itemprop="url">Vue造轮子-popover组件(下)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-01-29 10:37:44" itemprop="dateCreated datePublished" datetime="2020-01-29T10:37:44+08:00">2020-01-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-01-31 11:46:57" itemprop="dateModified" datetime="2020-01-31T11:46:57+08:00">2020-01-31</time>
              </span>

          
            <span id="/2020/01/29/Vue%E9%80%A0%E8%BD%AE%E5%AD%90-popover%E7%BB%84%E4%BB%B6-%E4%B8%8B/" class="post-meta-item leancloud_visitors" data-flag-title="Vue造轮子-popover组件(下)" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2020/01/29/Vue%E9%80%A0%E8%BD%AE%E5%AD%90-popover%E7%BB%84%E4%BB%B6-%E4%B8%8B/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/01/29/Vue%E9%80%A0%E8%BD%AE%E5%AD%90-popover%E7%BB%84%E4%BB%B6-%E4%B8%8B/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="1-上一次的问题总结。"><a href="#1-上一次的问题总结。" class="headerlink" title="1. 上一次的问题总结。"></a>1. 上一次的问题总结。</h4><ul>
<li>overflow:hidden -&gt; body.appendChild</li>
<li>关闭重复 -&gt; 分开,document 只管外面,popover 只管里面</li>
<li>忘了取消监听 document -&gt; 收拢 close</li>
</ul>
<h4 id="2-可以把一个函数哟没有五行作为一个优化的标准-简称为五行定律"><a href="#2-可以把一个函数哟没有五行作为一个优化的标准-简称为五行定律" class="headerlink" title="2. 可以把一个函数哟没有五行作为一个优化的标准,简称为五行定律"></a>2. 可以把一个函数哟没有五行作为一个优化的标准,简称为五行定律</h4><h4 id="3-接下来把样式改好点"><a href="#3-接下来把样式改好点" class="headerlink" title="3. 接下来把样式改好点"></a>3. 接下来把样式改好点</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">.content-wrapper &#123; &#x2F;&#x2F; 如果写了scoped,popover里面那么就只作用于popover里面,移到外面就在外面了就可以</span><br><span class="line">  position: absolute;</span><br><span class="line">  border: 1px solid  $border-color;</span><br><span class="line">  border-radius: $border-radius;</span><br><span class="line">  filter: drop-shadow(0 0 1px rgba(0,0,0,0.5));</span><br><span class="line">  &#x2F;*通过drop-shadow解决小三角没有阴影的问题，但是兼容性不好 *&#x2F;</span><br><span class="line">  &#x2F;*box-shadow: 0 0 3px rgba(0, 0, 0, 0.5);*&#x2F;</span><br><span class="line">  background: white;</span><br><span class="line">  transform: translateY(-100%);</span><br><span class="line">  margin-top: -10px;</span><br><span class="line">  padding: .5em 1em;</span><br><span class="line">  max-width: 20em;</span><br><span class="line">  word-break: break-all;</span><br><span class="line">  &amp;::before ,  &amp;::after&#123;</span><br><span class="line">    content: &#39;&#39;;</span><br><span class="line">    display: block;</span><br><span class="line">    width: 0;</span><br><span class="line">    height: 0;</span><br><span class="line">    position: absolute;</span><br><span class="line">    border: 10px solid transparent;</span><br><span class="line">    left: 10px;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;::after&#123;</span><br><span class="line">    content: &#39;&#39;;</span><br><span class="line">    display: block;</span><br><span class="line">    width: 0;</span><br><span class="line">    height: 0;</span><br><span class="line">    position: absolute;</span><br><span class="line">    border: 10px solid transparent;</span><br><span class="line">    left: 10px;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;::before &#123;</span><br><span class="line">    border-top-color: black;</span><br><span class="line">    top: 100%;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;::after &#123;</span><br><span class="line">    border-top-color: white;</span><br><span class="line">    top: calc(100% - 1px);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-增加功能-用户可以选择-popover-是上面下面左面右面"><a href="#4-增加功能-用户可以选择-popover-是上面下面左面右面" class="headerlink" title="4. 增加功能:用户可以选择 popover 是上面下面左面右面"></a>4. 增加功能:用户可以选择 popover 是上面下面左面右面</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line">  &#x2F;&#x2F; 先要给contentWrapper加一个类,传递进入位置信息</span><br><span class="line">  &lt;div ref&#x3D;&quot;contentWrapper&quot; class&#x3D;&quot;content-wrapper&quot; v-if&#x3D;&quot;visible&quot;</span><br><span class="line">    :class&#x3D;&quot;&#123;[&#96;position-$&#123;position&#125;&#96;]:true&#125;&quot;&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; 获得位置信息</span><br><span class="line">  props: &#123;</span><br><span class="line">      position:&#123;</span><br><span class="line">        type: String,</span><br><span class="line">        default: &#39;top&#39;,</span><br><span class="line">        validator(value)&#123;</span><br><span class="line">          return [&#39;top&#39;,&#39;bottom&#39;,&#39;left&#39;,&#39;right&#39;].indexOf(value) &gt;&#x3D; 0</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; 在method里面写方法,主要控制大概位置</span><br><span class="line">  method: &#123;</span><br><span class="line">    positionContent() &#123;</span><br><span class="line">        const &#123;contentWrapper, triggerWrapper&#125; &#x3D; this[&#39;$refs&#39;]</span><br><span class="line">        document.body.appendChild(contentWrapper)</span><br><span class="line">        let &#123;width, height, top, left&#125; &#x3D; triggerWrapper.getBoundingClientRect()</span><br><span class="line">        if(this.position &#x3D;&#x3D;&#x3D; &#39;top&#39;)&#123;</span><br><span class="line">          contentWrapper.style.left &#x3D; left + window.scrollX + &quot;px&quot;</span><br><span class="line">          contentWrapper.style.top &#x3D; top + window.scrollY + &quot;px&quot;</span><br><span class="line">        &#125;else if(this.position &#x3D;&#x3D;&#x3D; &#39;bottom&#39;)&#123;</span><br><span class="line">          contentWrapper.style.left &#x3D; left + window.scrollX + &quot;px&quot;</span><br><span class="line">          contentWrapper.style.top &#x3D; top + height + window.scrollY + &quot;px&quot;</span><br><span class="line">        &#125;else if(this.position &#x3D;&#x3D;&#x3D; &#39;left&#39;)&#123;</span><br><span class="line">          contentWrapper.style.left &#x3D; left + window.scrollX + &quot;px&quot;</span><br><span class="line">          let &#123;height: height2&#125; &#x3D; contentWrapper.getBoundingClientRect()</span><br><span class="line">          contentWrapper.style.top &#x3D; top  + window.scrollY + (height - height2)&#x2F;2 + &quot;px&quot;</span><br><span class="line">        &#125;else if(this.position &#x3D;&#x3D;&#x3D; &#39;right&#39;)&#123;</span><br><span class="line">          contentWrapper.style.left &#x3D; left + window.scrollX + width + &quot;px&quot;</span><br><span class="line">          let &#123;height: height2&#125; &#x3D; contentWrapper.getBoundingClientRect()</span><br><span class="line">          contentWrapper.style.top &#x3D; top  + window.scrollY + (height - height2)&#x2F;2 + &quot;px&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; 然后对css进行处理,主要是箭头当想</span><br><span class="line">  &lt;style lang&#x3D;&quot;scss&quot; scoped&gt;</span><br><span class="line">  $border-color: #333;</span><br><span class="line">  $border-radius: 4px;</span><br><span class="line">  .popover &#123;</span><br><span class="line">    display: inline-block;</span><br><span class="line">    vertical-align: top;</span><br><span class="line">    position: relative;</span><br><span class="line">  &#125;</span><br><span class="line">  .content-wrapper &#123; &#x2F;&#x2F; 如果写了scoped,popover里面那么就只作用于popover里面,移到外面就在外面了就可以</span><br><span class="line">    position: absolute;</span><br><span class="line">    border: 1px solid  $border-color;</span><br><span class="line">    border-radius: $border-radius;</span><br><span class="line">    filter: drop-shadow(0 0 1px rgba(0,0,0,0.5));</span><br><span class="line">    &#x2F;*通过drop-shadow解决小三角没有阴影的问题，但是兼容性不好 *&#x2F;</span><br><span class="line">    &#x2F;*box-shadow: 0 0 3px rgba(0, 0, 0, 0.5);*&#x2F;</span><br><span class="line">    background: white;</span><br><span class="line">    padding: .5em 1em;</span><br><span class="line">    max-width: 20em;</span><br><span class="line">    word-break: break-all;</span><br><span class="line">    &amp;::before ,  &amp;::after&#123;</span><br><span class="line">      content: &#39;&#39;;</span><br><span class="line">      display: block;</span><br><span class="line">      border: 10px solid transparent;</span><br><span class="line">      width: 0;</span><br><span class="line">      height: 0;</span><br><span class="line">      position: absolute;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &amp;.position-top &#123;</span><br><span class="line">      transform: translateY(-100%);</span><br><span class="line">      margin-top: -10px;</span><br><span class="line">      &amp;::before, &amp;::after&#123;</span><br><span class="line">        left: 10px;</span><br><span class="line">      &#125;</span><br><span class="line">      &amp;::before &#123;</span><br><span class="line">        border-top-color: black;</span><br><span class="line">        top: 100%;</span><br><span class="line">      &#125;</span><br><span class="line">      &amp;::after &#123;</span><br><span class="line">        border-top-color: white;</span><br><span class="line">        top: calc(100% - 1px);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &amp;.position-bottom &#123;</span><br><span class="line">      margin-top: 10px;</span><br><span class="line">      &amp;::before, &amp;::after&#123;</span><br><span class="line">        left: 10px;</span><br><span class="line">      &#125;</span><br><span class="line">      &amp;::before &#123;</span><br><span class="line">        border-bottom-color: black;</span><br><span class="line">        bottom: 100%;</span><br><span class="line">      &#125;</span><br><span class="line">      &amp;::after &#123;</span><br><span class="line">        border-bottom-color: white;</span><br><span class="line">        bottom: calc(100% - 1px);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &amp;.position-left&#123;</span><br><span class="line">      transform: translateX(-100%);</span><br><span class="line">      margin-left: -10px;</span><br><span class="line">      &amp;::before, &amp;::after&#123;</span><br><span class="line">        transform: translateY(-50%);</span><br><span class="line">        top: 50%;</span><br><span class="line">      &#125;</span><br><span class="line">      &amp;::before &#123;</span><br><span class="line">        border-left-color: black;</span><br><span class="line">        left: 100%;</span><br><span class="line">      &#125;</span><br><span class="line">      &amp;::after &#123;</span><br><span class="line">        border-left-color: white;</span><br><span class="line">        left: calc(100% - 1px)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &amp;.position-right&#123;</span><br><span class="line">      margin-left: 10px;</span><br><span class="line">      &amp;::before, &amp;::after&#123;</span><br><span class="line">        transform: translateY(-50%);</span><br><span class="line">        top: 50%;</span><br><span class="line">      &#125;</span><br><span class="line">      &amp;::before &#123;</span><br><span class="line">        border-right-color: black;</span><br><span class="line">        right: 100%;</span><br><span class="line">      &#125;</span><br><span class="line">      &amp;::after &#123;</span><br><span class="line">        border-right-color: white;</span><br><span class="line">        right: calc(100% - 1px)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>

<h4 id="5-发现目前代码比较冗余，进一步优化代码"><a href="#5-发现目前代码比较冗余，进一步优化代码" class="headerlink" title="5.发现目前代码比较冗余，进一步优化代码"></a>5.发现目前代码比较冗余，进一步优化代码</h4><ul>
<li>多个 if else 逻辑相似，首先要把共有代码抽上去，利用表驱动编程的技巧。
<img src="https://i.loli.net/2020/01/31/WCRjO28ilBVMzGd.png" alt="表驱动编程.png"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">positionContent() &#123;</span><br><span class="line">      const &#123;contentWrapper, triggerWrapper&#125; &#x3D; this[&#39;$refs&#39;]</span><br><span class="line">      document.body.appendChild(contentWrapper)</span><br><span class="line">      const &#123;width, height, top, left&#125; &#x3D; triggerWrapper.getBoundingClientRect()</span><br><span class="line">      const &#123;height: height2&#125; &#x3D; contentWrapper.getBoundingClientRect()</span><br><span class="line">      let positions &#x3D; &#123;</span><br><span class="line">        top: &#123;</span><br><span class="line">          top: top + window.scrollY,</span><br><span class="line">          left: left + window.scrollX</span><br><span class="line">        &#125;,</span><br><span class="line">        bottom: &#123;</span><br><span class="line">          top: top + height + window.scrollY,</span><br><span class="line">          left: left + window.scrollX</span><br><span class="line">        &#125;,</span><br><span class="line">        left: &#123;</span><br><span class="line">          top: top  + window.scrollY + (height - height2)&#x2F;2,</span><br><span class="line">          left: left + window.scrollX</span><br><span class="line">        &#125;,</span><br><span class="line">        right: &#123;</span><br><span class="line">          top:  top  + window.scrollY + (height - height2)&#x2F;2,</span><br><span class="line">          left: left + window.scrollX + width</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">      contentWrapper.style.left &#x3D; positions[this.position].left + &#39;px&#39;</span><br><span class="line">      contentWrapper.style.top &#x3D; positions[this.position].top + &#39;px&#39;</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="6-实现-hover-的效果"><a href="#6-实现-hover-的效果" class="headerlink" title="6.实现 hover 的效果"></a>6.实现 hover 的效果</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 每个事件的处理逻辑不一样，所以要分开写if</span><br><span class="line">  mounted()&#123;</span><br><span class="line">    if(this.trigger &#x3D;&#x3D;&#x3D; &#39;click&#39;)&#123;</span><br><span class="line">      this[&#39;$refs&#39;][&#39;popover&#39;].addEventListener(&#39;click&#39;,this.onClick)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      this[&#39;$refs&#39;][&#39;popover&#39;].addEventListener(&#39;mouseenter&#39;,this.open)</span><br><span class="line">      this[&#39;$refs&#39;][&#39;popover&#39;].addEventListener(&#39;mouseleave&#39;,this.close)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#x2F;&#x2F; 负责任的轮子要写destory,防止内存泄露</span><br><span class="line">  destroyed()&#123;</span><br><span class="line">    if(this.trigger &#x3D;&#x3D;&#x3D; &#39;click&#39;)&#123;</span><br><span class="line">      this[&#39;$refs&#39;][&#39;popover&#39;].removeEventListener(&#39;click&#39;,this.onClick)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      this[&#39;$refs&#39;][&#39;popover&#39;].removeEventListener(&#39;mouseenter&#39;,this.open)</span><br><span class="line">      this[&#39;$refs&#39;][&#39;popover&#39;].removeEventListener(&#39;mouseleave&#39;,this.close)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<h4 id="最后-个人微信-欢迎交流！"><a href="#最后-个人微信-欢迎交流！" class="headerlink" title="最后,个人微信,欢迎交流！"></a>最后,个人微信,欢迎交流！</h4><p><img src="https://i.loli.net/2020/01/30/mbV7Q3XqxedsJKP.jpg" alt="wechat0.jpg"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="codingories.github.io/2020/01/29/Vue%E9%80%A0%E8%BD%AE%E5%AD%90-popover%E7%BB%84%E4%BB%B6-%E4%B8%AD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://i.loli.net/2020/07/12/RPjkZxei6agC49U.jpg">
      <meta itemprop="name" content="Ories">
      <meta itemprop="description" content="这个博客用来记录自己的生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OriesノBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/29/Vue%E9%80%A0%E8%BD%AE%E5%AD%90-popover%E7%BB%84%E4%BB%B6-%E4%B8%AD/" class="post-title-link" itemprop="url">Vue造轮子-popover组件(中)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-01-29 10:37:40" itemprop="dateCreated datePublished" datetime="2020-01-29T10:37:40+08:00">2020-01-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-01-30 13:41:57" itemprop="dateModified" datetime="2020-01-30T13:41:57+08:00">2020-01-30</time>
              </span>

          
            <span id="/2020/01/29/Vue%E9%80%A0%E8%BD%AE%E5%AD%90-popover%E7%BB%84%E4%BB%B6-%E4%B8%AD/" class="post-meta-item leancloud_visitors" data-flag-title="Vue造轮子-popover组件(中)" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2020/01/29/Vue%E9%80%A0%E8%BD%AE%E5%AD%90-popover%E7%BB%84%E4%BB%B6-%E4%B8%AD/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/01/29/Vue%E9%80%A0%E8%BD%AE%E5%AD%90-popover%E7%BB%84%E4%BB%B6-%E4%B8%AD/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="1-现在遇到的问题"><a href="#1-现在遇到的问题" class="headerlink" title="1. 现在遇到的问题"></a>1. 现在遇到的问题</h4><ul>
<li>如果在popover外面包了个div写上overflow:hidden就会出bug,所以要把弹出的div放到按钮的同一个层级</li>
<li>关于click事件的,之前解决的方式是写click.stop,但是其实还是会有bug,会打断用户的事件链，用户在外面写@click,点击按钮没有用，但是点击按钮周围空白区域会有,那么就会导致别人用了组件无法自己添加click事件,所以不能用stop解决这个问题。</li>
</ul>
<h4 id="2-解决overflow-hidden的问题"><a href="#2-解决overflow-hidden的问题" class="headerlink" title="2. 解决overflow:hidden的问题"></a>2. 解决overflow:hidden的问题</h4>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">     xxx()&#123;</span><br><span class="line">       this.visible &#x3D; !this.visible</span><br><span class="line">       if(this.visible &#x3D;&#x3D;&#x3D; true) &#123;</span><br><span class="line">         setTimeout(()&#x3D;&gt;&#123;</span><br><span class="line">         &#x2F;&#x2F; 主要是下面这四句实现,但是还是有bug</span><br><span class="line">         document.body.appendChild(this.$refs.contentWrapper)</span><br><span class="line">         let &#123;width, height, top, left&#125; &#x3D; this.$refs.triggerWrapper.getBoundingClientRect()</span><br><span class="line">         this.$refs.contentWrapper.style.left &#x3D; left + &#39;px&#39;</span><br><span class="line">         this.$refs.contentWrapper.style.top &#x3D; top + &#39;px&#39;</span><br><span class="line">         &#x2F;&#x2F; </span><br><span class="line">           let eventHandler &#x3D; ()&#x3D;&gt;&#123;</span><br><span class="line">             this.visible &#x3D; false;</span><br><span class="line">             console.log(&#39;document 隐藏 popover&#39;)</span><br><span class="line">             document.removeEventListener(&#39;click&#39;,eventHandler)</span><br><span class="line">           &#125;</span><br><span class="line">           document.addEventListener(&#39;click&#39;, eventHandler)</span><br><span class="line">         &#125;)</span><br><span class="line">       &#125;else&#123;</span><br><span class="line">         console.log(&#39;vm 隐藏 popover&#39;)</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>


<h4 id="3-面试题-v-show和v-if的区别-v-if是是否出现在dom树上，v-show是改变其css样式。"><a href="#3-面试题-v-show和v-if的区别-v-if是是否出现在dom树上，v-show是改变其css样式。" class="headerlink" title="3. 面试题:v-show和v-if的区别,v-if是是否出现在dom树上，v-show是改变其css样式。"></a>3. 面试题:v-show和v-if的区别,v-if是是否出现在dom树上，v-show是改变其css样式。</h4><h4 id="4-解决当容器有-overflow-hidden-造成的bug"><a href="#4-解决当容器有-overflow-hidden-造成的bug" class="headerlink" title="4. 解决当容器有 overflow hidden 造成的bug"></a>4. 解决当容器有 overflow hidden 造成的bug</h4><ul>
<li>clientRect是相距可视范围，绝对定位相距于body定位。现在我们的浮层是相对于body定位，而按钮获取到的top是相对于window定位而引发的bug。</li>
<li>解决这个问题只要得到两者之间的插值就好解决<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">   xxx()&#123;</span><br><span class="line">     this.visible &#x3D; !this.visible</span><br><span class="line">     if(this.visible &#x3D;&#x3D;&#x3D; true) &#123;</span><br><span class="line">       setTimeout(()&#x3D;&gt;&#123;</span><br><span class="line">         document.body.appendChild(this[&#39;$refs&#39;][&#39;contentWrapper&#39;])</span><br><span class="line">         let &#123;top, left&#125; &#x3D;this[&#39;$refs&#39;][&#39;triggerWrapper&#39;].getBoundingClientRect()</span><br><span class="line">         &#x2F;&#x2F; 这两句话解决</span><br><span class="line">         this[&#39;$refs&#39;][&#39;contentWrapper&#39;].style.left &#x3D; left + window.scrollX + &#39;px&#39; </span><br><span class="line">         this[&#39;$refs&#39;][&#39;contentWrapper&#39;].style.top &#x3D; top + window.scrollY +&#39;px&#39;</span><br><span class="line">         &#x2F;&#x2F; </span><br><span class="line">         let eventHandler &#x3D; ()&#x3D;&gt;&#123;</span><br><span class="line">           this.visible &#x3D; false;</span><br><span class="line">           console.log(&#39;document 隐藏 popover&#39;)</span><br><span class="line">           document.removeEventListener(&#39;click&#39;,eventHandler)</span><br><span class="line">         &#125;</span><br><span class="line">         document.addEventListener(&#39;click&#39;, eventHandler)</span><br><span class="line">       &#125;)</span><br><span class="line">     &#125;else&#123;</span><br><span class="line">       console.log(&#39;vm 隐藏 popover&#39;)</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h4 id="5-解决外部点击click无效的问题。"><a href="#5-解决外部点击click无效的问题。" class="headerlink" title="5. 解决外部点击click无效的问题。"></a>5. 解决外部点击click无效的问题。</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 先将点按钮和点外面的逻辑分开</span><br><span class="line">onClick(event)&#123;</span><br><span class="line">  if(this.$refs.triggerWrapper.contains(event.target))&#123;</span><br><span class="line">    console.log(&#39;按钮&#39;)</span><br><span class="line">    this.visible &#x3D; !this.visible</span><br><span class="line">    </span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    console.log(&#39;其它&#39;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 将之前的代码移动进去</span><br><span class="line"> methods: &#123;</span><br><span class="line">  onClick(event)&#123;</span><br><span class="line">    if(this.$refs.triggerWrapper.contains(event.target))&#123;</span><br><span class="line">      this.visible &#x3D; !this.visible</span><br><span class="line">      if(this.visible &#x3D;&#x3D;&#x3D; true) &#123;</span><br><span class="line">        setTimeout(() &#x3D;&gt; &#123;</span><br><span class="line">          document.body.appendChild(this[&#39;$refs&#39;][&#39;contentWrapper&#39;])</span><br><span class="line">          let &#123;top, left&#125; &#x3D; this[&#39;$refs&#39;][&#39;triggerWrapper&#39;].getBoundingClientRect()</span><br><span class="line">          this[&#39;$refs&#39;][&#39;contentWrapper&#39;].style.left &#x3D; left + window.scrollX + &#39;px&#39;</span><br><span class="line">          this[&#39;$refs&#39;][&#39;contentWrapper&#39;].style.top &#x3D; top + window.scrollY + &#39;px&#39;</span><br><span class="line">          let eventHandler &#x3D; (e) &#x3D;&gt; &#123;</span><br><span class="line">            if(this[&#39;$refs&#39;][&#39;contentWrapper&#39;].contains(e.target))&#123; </span><br><span class="line">              &#x2F;&#x2F; 这句话解决了点击内容消失的问题</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              this.visible &#x3D; false;</span><br><span class="line">              document.removeEventListener(&#39;click&#39;, eventHandler)</span><br><span class="line">              console.log(&#39;关闭&#39;) &#x2F;&#x2F; document事件引起的</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          document.addEventListener(&#39;click&#39;, eventHandler)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      console.log(&#39;非按钮&#39;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="6-开始重构上面那段代码"><a href="#6-开始重构上面那段代码" class="headerlink" title="6.开始重构上面那段代码"></a>6.开始重构上面那段代码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">  methods: &#123;</span><br><span class="line">  positionContent() &#123;</span><br><span class="line">    document.body.appendChild(this[&quot;$refs&quot;][&quot;contentWrapper&quot;])</span><br><span class="line">    let &#123;top, left&#125; &#x3D; this[&quot;$refs&quot;][&quot;triggerWrapper&quot;].getBoundingClientRect()</span><br><span class="line">    this[&quot;$refs&quot;][&quot;contentWrapper&quot;].style.left &#x3D; left + window.scrollX + &quot;px&quot;</span><br><span class="line">    this[&quot;$refs&quot;][&quot;contentWrapper&quot;].style.top &#x3D; top + window.scrollY + &quot;px&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  listenToDocument() &#123;</span><br><span class="line">    let eventHandler &#x3D; (e) &#x3D;&gt; &#123;</span><br><span class="line">      if (this[&quot;$refs&quot;][&quot;contentWrapper&quot;].contains(e.target)) &#123; &#x2F;&#x2F; 这句话解决了点击内容消失的问题</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        this.visible &#x3D; false</span><br><span class="line">        console.log(&#39;关闭&#39;)</span><br><span class="line">        document.removeEventListener(&quot;click&quot;, eventHandler)</span><br><span class="line">        console.log(&quot;关闭&quot;) &#x2F;&#x2F; document事件引起的</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    document.addEventListener(&quot;click&quot;, eventHandler)</span><br><span class="line">  &#125;,</span><br><span class="line">  listenToDocument()&#123;</span><br><span class="line">    let eventHandler &#x3D; (e) &#x3D;&gt; &#123;</span><br><span class="line">      if ( this[&quot;$refs&quot;][&quot;contentWrapper&quot;] &amp;&amp;</span><br><span class="line">        this[&quot;$refs&quot;][&quot;contentWrapper&quot;].contains(e.target)) &#123; &#x2F;&#x2F; 这句话解决了点击内容消失的问题</span><br><span class="line">        return</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        this.visible &#x3D; false</span><br><span class="line">        document.removeEventListener(&quot;click&quot;, eventHandler)</span><br><span class="line">        console.log(&quot;关闭&quot;) &#x2F;&#x2F; document事件引起的</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    document.addEventListener(&quot;click&quot;, eventHandler)</span><br><span class="line">  &#125;,</span><br><span class="line">  opShow()&#123;</span><br><span class="line">    setTimeout(() &#x3D;&gt; &#123;</span><br><span class="line">      this.positionContent()</span><br><span class="line">      this.listenToDocument()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  onClick(event) &#123;</span><br><span class="line">    if (this[&quot;$refs&quot;][&quot;triggerWrapper&quot;].contains(event.target)) &#123;</span><br><span class="line">      this.visible &#x3D; !this.visible</span><br><span class="line">      if (this.visible &#x3D;&#x3D;&#x3D; true) &#123;</span><br><span class="line">        this.opShow()</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        console.log(&#39;关闭&#39;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h4 id="7-还有一个bug-上面打印关闭，关闭了两次"><a href="#7-还有一个bug-上面打印关闭，关闭了两次" class="headerlink" title="7. 还有一个bug,上面打印关闭，关闭了两次"></a>7. 还有一个bug,上面打印关闭，关闭了两次</h4></li>
<li>原因是document会去关闭它，onClick也会去关闭它</li>
<li>我们需要把关闭入口收拢，这个就是代码的紧密性，也就是高内聚低耦合的内聚。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">  methods: &#123;</span><br><span class="line">  onClickDocument(e)&#123;</span><br><span class="line">    if ( this[&quot;$refs&quot;][&quot;popover&quot;] &amp;&amp; (this[&quot;$refs&quot;][&quot;popover&quot;] &amp;&amp;</span><br><span class="line">      this[&quot;$refs&quot;][&quot;popover&quot;].contains(e.target))) &#123;return&#125;</span><br><span class="line">    else &#123;</span><br><span class="line">      this.close()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  positionContent() &#123;</span><br><span class="line">    document.body.appendChild(this[&quot;$refs&quot;][&quot;contentWrapper&quot;])</span><br><span class="line">    let &#123;top, left&#125; &#x3D; this[&quot;$refs&quot;][&quot;triggerWrapper&quot;].getBoundingClientRect()</span><br><span class="line">    this[&quot;$refs&quot;][&quot;contentWrapper&quot;].style.left &#x3D; left + window.scrollX + &quot;px&quot;</span><br><span class="line">    this[&quot;$refs&quot;][&quot;contentWrapper&quot;].style.top &#x3D; top + window.scrollY + &quot;px&quot;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  open()&#123; &#x2F;&#x2F; 打开的收拢</span><br><span class="line">    this.visible &#x3D; true</span><br><span class="line">    setTimeout(() &#x3D;&gt; &#123;</span><br><span class="line">      this.positionContent()</span><br><span class="line">      document.addEventListener(&quot;click&quot;, this.onClickDocument)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  close()&#123; &#x2F;&#x2F; 关闭的收拢</span><br><span class="line">    this.visible &#x3D; false</span><br><span class="line">    document.removeEventListener(&quot;click&quot;, this.onClickDocument)</span><br><span class="line">  &#125;,</span><br><span class="line">  onClick(event) &#123;</span><br><span class="line">    if (this[&quot;$refs&quot;][&quot;triggerWrapper&quot;].contains(event.target)) &#123;</span><br><span class="line">      if (this.visible &#x3D;&#x3D;&#x3D; true) &#123;</span><br><span class="line">        this.close()</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        this.open()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#x2F;&#x2F; 所有重要的操作都要进行收拢</span><br></pre></td></tr></table></figure>
<h4 id="最后，个人微信，欢迎交流"><a href="#最后，个人微信，欢迎交流" class="headerlink" title="最后，个人微信，欢迎交流!"></a>最后，个人微信，欢迎交流!</h4><img src="https://i.loli.net/2020/01/30/mbV7Q3XqxedsJKP.jpg" alt="wechat.jpg"></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="codingories.github.io/2020/01/29/Vue%E9%80%A0%E8%BD%AE%E5%AD%90-popover%E7%BB%84%E4%BB%B6-%E4%B8%8A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://i.loli.net/2020/07/12/RPjkZxei6agC49U.jpg">
      <meta itemprop="name" content="Ories">
      <meta itemprop="description" content="这个博客用来记录自己的生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OriesノBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/29/Vue%E9%80%A0%E8%BD%AE%E5%AD%90-popover%E7%BB%84%E4%BB%B6-%E4%B8%8A/" class="post-title-link" itemprop="url">Vue造轮子-popover组件(上)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-01-29 10:37:32 / Modified: 13:51:40" itemprop="dateCreated datePublished" datetime="2020-01-29T10:37:32+08:00">2020-01-29</time>
            </span>

          
            <span id="/2020/01/29/Vue%E9%80%A0%E8%BD%AE%E5%AD%90-popover%E7%BB%84%E4%BB%B6-%E4%B8%8A/" class="post-meta-item leancloud_visitors" data-flag-title="Vue造轮子-popover组件(上)" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2020/01/29/Vue%E9%80%A0%E8%BD%AE%E5%AD%90-popover%E7%BB%84%E4%BB%B6-%E4%B8%8A/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/01/29/Vue%E9%80%A0%E8%BD%AE%E5%AD%90-popover%E7%BB%84%E4%BB%B6-%E4%B8%8A/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="1-popover是什么以及难点在哪"><a href="#1-popover是什么以及难点在哪" class="headerlink" title="1. popover是什么以及难点在哪"></a>1. popover是什么以及难点在哪</h4><ul>
<li>点一下出现一个卡片,也叫气泡卡片</li>
<li>难点在于css的样式 </li>
</ul>
<h4 id="2-用户会怎么去用"><a href="#2-用户会怎么去用" class="headerlink" title="2. 用户会怎么去用"></a>2. 用户会怎么去用</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 第一种做法，用插槽做</span><br><span class="line">&lt;g-popover&gt;</span><br><span class="line">  &lt;template slot&#x3D;&quot;content&quot;&gt;</span><br><span class="line">    &lt;div&gt;&lt;&#x2F;div&gt;</span><br><span class="line">  &lt;&#x2F;template&gt;</span><br><span class="line">  &lt;template slot&#x3D;&quot;trigger&quot;&gt;</span><br><span class="line">    &lt;button&gt;点我&lt;&#x2F;button&gt;</span><br><span class="line">  &lt;&#x2F;template&gt;</span><br><span class="line">&lt;&#x2F;g-popover&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 第二种做法，用指令做，这种方式不太用，指令大多数是造轮子用的所以就用第一种方法做</span><br><span class="line">&lt;div ref&#x3D;&quot;xxx&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">&lt;button v-popover&#x3D;&quot;$refs.xxx&quot;&gt;&lt;&#x2F;button&gt;</span><br></pre></td></tr></table></figure>
<h4 id="3-为什么要用用inline-block，因为这样多个popover组件才不会一行"><a href="#3-为什么要用用inline-block，因为这样多个popover组件才不会一行" class="headerlink" title="3. 为什么要用用inline-block，因为这样多个popover组件才不会一行"></a>3. 为什么要用用inline-block，因为这样多个popover组件才不会一行</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; popover.vue</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;popover&quot;&gt;</span><br><span class="line">    &lt;slot name&#x3D;&quot;content&quot;&gt;&lt;&#x2F;slot&gt;</span><br><span class="line">    &lt;slot&gt;&lt;&#x2F;slot&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">  .popover&#123;</span><br><span class="line">    display: inline-block;</span><br><span class="line">    vertical-align: top;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; index.html</span><br><span class="line">&lt;div id&#x3D;&quot;app&quot;&gt;</span><br><span class="line">  &lt;g-popover&gt;</span><br><span class="line">    &lt;template slot&#x3D;&quot;content&quot;&gt;</span><br><span class="line">      &lt;div&gt;popover内容1&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;template&gt;</span><br><span class="line">      &lt;button&gt;点我1&lt;&#x2F;button&gt;</span><br><span class="line">  &lt;&#x2F;g-popover&gt;</span><br><span class="line">  &lt;g-popover&gt;</span><br><span class="line">    &lt;template slot&#x3D;&quot;content&quot;&gt;</span><br><span class="line">      &lt;div&gt;popover内容2&lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;template&gt;</span><br><span class="line">      &lt;button&gt;点我2&lt;&#x2F;button&gt;</span><br><span class="line">  &lt;&#x2F;g-popover&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>
<h4 id="4-优秀的前端css一定是写的很6的"><a href="#4-优秀的前端css一定是写的很6的" class="headerlink" title="4. 优秀的前端css一定是写的很6的"></a>4. 优秀的前端css一定是写的很6的</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; popover.vue</span><br><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div class&#x3D;&quot;popover&quot; @click&#x3D;&quot;xxx&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;content-wrapper&quot; v-if&#x3D;&quot;visible&quot; &gt;</span><br><span class="line">    &lt;slot name&#x3D;&quot;content&quot;&gt;&lt;&#x2F;slot&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;slot&gt;&lt;&#x2F;slot&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang&#x3D;&quot;ts&quot;&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">    name: &quot;GuluPopover&quot;,</span><br><span class="line">    data ()&#123;</span><br><span class="line">    return &#123;visible:false&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">    xxx()&#123;</span><br><span class="line">        this.visible &#x3D; !this.visible</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang&#x3D;&quot;scss&quot; scoped&gt;</span><br><span class="line">.popover&#123;</span><br><span class="line">    display: inline-block;</span><br><span class="line">    vertical-align: top;</span><br><span class="line">    position: relative;</span><br><span class="line">    .content-wrapper&#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    bottom: 100%;</span><br><span class="line">    left: 0;</span><br><span class="line">    border: 1px solid red;</span><br><span class="line">    box-shadow: 0 0 3px rgba(0,0,0,0.5);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>

<h4 id="5-开始完善功能-实现点外面之后内容消失"><a href="#5-开始完善功能-实现点外面之后内容消失" class="headerlink" title="5. 开始完善功能,实现点外面之后内容消失"></a>5. 开始完善功能,实现点外面之后内容消失</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 这样写会出现bug,刚出现外面就会点击，也就是刚开启就会关闭</span><br><span class="line">&#x2F;&#x2F; 出现原因是点击的时候就建了eventListener,而不是出现了再建eventListener</span><br><span class="line">&#x2F;&#x2F; 具体涉及到原生js的一些核心，叫做事件机制，事件的冒泡机制</span><br><span class="line">methods: &#123;</span><br><span class="line">  xxx()&#123; </span><br><span class="line">    this.visible &#x3D; !this.visible</span><br><span class="line">    console.log(&#39;切换 visible&#39;)</span><br><span class="line">    if(this.visible &#x3D;&#x3D;&#x3D; true) &#123;</span><br><span class="line">      document.body.addEventListener(&#39;click&#39;, ()&#x3D;&gt;&#123;</span><br><span class="line">        this.visible &#x3D; false</span><br><span class="line">        console.log(&#39;点击body就关闭popover&#39;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; 这个bug用异步解决</span><br></pre></td></tr></table></figure>
<h4 id="6-解决第三次点击不行"><a href="#6-解决第三次点击不行" class="headerlink" title="6.解决第三次点击不行"></a>6.解决第三次点击不行</h4><ul>
<li>第一步<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">if(this.visible &#x3D;&#x3D;&#x3D; true) &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 这样写还是不行</span><br><span class="line">    &#x2F;&#x2F; this.$nextTick(() &#x3D;&gt; &#123;</span><br><span class="line">    &#x2F;&#x2F;   document.addEventListener(&#39;click&#39;, ()&#x3D;&gt;&#123;</span><br><span class="line">    &#x2F;&#x2F;     this.visible &#x3D; false</span><br><span class="line">    &#x2F;&#x2F;     console.log(&quot;进入click&quot;)</span><br><span class="line">    &#x2F;&#x2F;     console.log(this.visible);</span><br><span class="line">    &#x2F;&#x2F;   &#125;)</span><br><span class="line">    &#x2F;&#x2F; &#125;)</span><br><span class="line"></span><br><span class="line">    setTimeout(()&#x3D;&gt;&#123;</span><br><span class="line">        document.addEventListener(&#39;click&#39;, ()&#x3D;&gt;&#123;</span><br><span class="line">        this.visible &#x3D; false</span><br><span class="line">        console.log(&quot;进入click&quot;)</span><br><span class="line">        console.log(this.visible);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>第二步<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  xxx()&#123;</span><br><span class="line">    this.visible &#x3D; !this.visible</span><br><span class="line">    if(this.visible &#x3D;&#x3D;&#x3D; true) &#123;</span><br><span class="line">      setTimeout(()&#x3D;&gt;&#123;</span><br><span class="line">        console.log(&quot;新增 document click 监听器&quot;)</span><br><span class="line">        document.addEventListener(&#39;click&#39;,</span><br><span class="line">          function x()&#123;</span><br><span class="line">            this.visible &#x3D; false;</span><br><span class="line">            console.log(&#39;删除监听器&#39;)</span><br><span class="line">            document.removeEventListener(&#39;click&#39;,x)</span><br><span class="line">            &#x2F;&#x2F; 但是这句话有问题，我删除的x，并不是我绑定的,我绑定的是x,bind this之后的新函数，</span><br><span class="line">            console.log(&#39;点击body就关闭popover&#39;)</span><br><span class="line">          &#125;.bind(this)</span><br><span class="line">        )</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; 这样写也有个坑,原因是</span><br><span class="line">x()</span><br><span class="line">x.bind()会变成一个新的函数,</span><br></pre></td></tr></table></figure></li>
<li>第三步<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">     xxx()&#123;</span><br><span class="line">       this.visible &#x3D; !this.visible</span><br><span class="line">       console.log(this.visible)</span><br><span class="line">       console.log(&#39;切换 visible&#39;)</span><br><span class="line">       if(this.visible &#x3D;&#x3D;&#x3D; true) &#123;</span><br><span class="line">         setTimeout(()&#x3D;&gt;&#123;</span><br><span class="line">           let eventHander &#x3D; ()&#x3D;&gt;&#123;</span><br><span class="line">             this.visible &#x3D; false;</span><br><span class="line">             document.removeEventListener(&#39;click&#39;,eventHander)</span><br><span class="line">           &#125;</span><br><span class="line">           document.addEventListener(&#39;click&#39;, eventHander)</span><br><span class="line">         &#125;)</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="7">
<li>解决点击popover关闭的bug,实现最简单的popover<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> &#x2F;&#x2F; 通过以下代码发现vm 隐藏了一次popover，document隐藏了一次</span><br><span class="line"> methods: &#123;</span><br><span class="line">   xxx()&#123;</span><br><span class="line">     this.visible &#x3D; !this.visible</span><br><span class="line">     if(this.visible &#x3D;&#x3D;&#x3D; true) &#123;</span><br><span class="line">       setTimeout(()&#x3D;&gt;&#123;</span><br><span class="line">         let eventHandler &#x3D; ()&#x3D;&gt;&#123;</span><br><span class="line">           this.visible &#x3D; false;</span><br><span class="line">           console.log(&#39;document 隐藏 popover&#39;)</span><br><span class="line">           document.removeEventListener(&#39;click&#39;,eventHandler)</span><br><span class="line">         &#125;</span><br><span class="line">         document.addEventListener(&#39;click&#39;, eventHandler)</span><br><span class="line">       &#125;)</span><br><span class="line">     &#125;else&#123;</span><br><span class="line">       console.log(&#39;vm 隐藏 popover&#39;)</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> &#x2F;&#x2F; 所以需要阻止冒泡,让popover事件在其内部进行处理就可以了</span><br><span class="line">&lt;div class&#x3D;&quot;popover&quot; @click.stop&#x3D;&quot;xxx&quot;&gt;</span><br><span class="line">   &lt;div class&#x3D;&quot;content-wrapper&quot; v-if&#x3D;&quot;visible&quot; @click.stop&gt;</span><br><span class="line">     &lt;slot name&#x3D;&quot;content&quot;&gt;&lt;&#x2F;slot&gt;</span><br><span class="line">   &lt;&#x2F;div&gt;</span><br><span class="line">   &lt;slot&gt;&lt;&#x2F;slot&gt;</span><br><span class="line"> &lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="8-目前还有哪些没有实现"><a href="#8-目前还有哪些没有实现" class="headerlink" title="8. 目前还有哪些没有实现"></a>8. 目前还有哪些没有实现</h4><ul>
<li>用户有的时候希望是hover的时候显示，支持多种事件</li>
<li>假设在外面写一个div，有overflow:hidden的属性就会出bug，这就是其它的框架都把popover放外面的原因</li>
</ul>
<h4 id="最后，欢迎交流"><a href="#最后，欢迎交流" class="headerlink" title="最后，欢迎交流"></a>最后，欢迎交流</h4><img src="https://i.loli.net/2020/01/27/gS4ZwP6zfAvULYT.jpg" alt="微信" width="400" height="400" align="bottom">
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="codingories.github.io/2020/01/28/Vue%E9%80%A0%E8%BD%AE%E5%AD%90-Tabs%E6%B5%8B%E8%AF%95-%E4%B8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://i.loli.net/2020/07/12/RPjkZxei6agC49U.jpg">
      <meta itemprop="name" content="Ories">
      <meta itemprop="description" content="这个博客用来记录自己的生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OriesノBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/28/Vue%E9%80%A0%E8%BD%AE%E5%AD%90-Tabs%E6%B5%8B%E8%AF%95-%E4%B8%8B/" class="post-title-link" itemprop="url">Vue造轮子-Tabs测试(下)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-01-28 20:23:57 / Modified: 21:45:47" itemprop="dateCreated datePublished" datetime="2020-01-28T20:23:57+08:00">2020-01-28</time>
            </span>

          
            <span id="/2020/01/28/Vue%E9%80%A0%E8%BD%AE%E5%AD%90-Tabs%E6%B5%8B%E8%AF%95-%E4%B8%8B/" class="post-meta-item leancloud_visitors" data-flag-title="Vue造轮子-Tabs测试(下)" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2020/01/28/Vue%E9%80%A0%E8%BD%AE%E5%AD%90-Tabs%E6%B5%8B%E8%AF%95-%E4%B8%8B/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/01/28/Vue%E9%80%A0%E8%BD%AE%E5%AD%90-Tabs%E6%B5%8B%E8%AF%95-%E4%B8%8B/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="1-如果g-tabs里面不是g-tabs-head，g-tabs-body期望会报错。"><a href="#1-如果g-tabs里面不是g-tabs-head，g-tabs-body期望会报错。" class="headerlink" title="1. 如果g-tabs里面不是g-tabs-head，g-tabs-body期望会报错。"></a>1. 如果g-tabs里面不是g-tabs-head，g-tabs-body期望会报错。</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 目前没有报错，所以先改</span><br><span class="line">&#x2F;&#x2F; tabs.vue</span><br><span class="line"> if(this.$children.length&#x3D;&#x3D;&#x3D;0)&#123;</span><br><span class="line">      &#x2F;&#x2F; 这个$children是看子组件，不是子元素</span><br><span class="line">      throw new Error(&#39;tabs的子组件应该是tabs-head和tabs-pane,但你没有写子组件&#39;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>test里面也应该期待一个报错，通过google搜索chai expect error得到写法,但是又碰到报错是异步的问题,接下来我们又搜索 chai aysnc error 去解决,发现也没有办法解决，决定退而求其次把error改成warn <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; tabs.vue中改成</span><br><span class="line">mounted()&#123;</span><br><span class="line">if(this.$children.length&#x3D;&#x3D;&#x3D;0)&#123;</span><br><span class="line">    &#x2F;&#x2F; 这个$children是看子组件，不是子元素</span><br><span class="line">    console &amp;&amp; console.warn &amp;&amp; console.warn(&#39;tabs的子组件应该是tabs-head和tabs-pane,但你没有写子组件&#39;)</span><br><span class="line">    &#x2F;&#x2F; 这是浏览器兼容性的写法</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>测试就直接放弃了</li>
</ul>
<h4 id="2-下面开始测tabs的属性"><a href="#2-下面开始测tabs的属性" class="headerlink" title="2. 下面开始测tabs的属性"></a>2. 下面开始测tabs的属性</h4><ul>
<li>先测selected属性<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; tabs-items.vue加上:data-name&#x3D;&quot;name&quot;变得更好测试点</span><br><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;tabs-item&quot; @click&#x3D;&quot;onClick&quot; :class&#x3D;&quot;classes&quot; :data-name&#x3D;&quot;name&quot;&gt;</span><br><span class="line">        &lt;slot&gt;&lt;&#x2F;slot&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;template&gt;</span><br><span class="line">&#x2F;&#x2F; tabs.test.js 异步代码测试比较麻烦</span><br><span class="line">vm.$nextTick(()&#x3D;&gt;&#123;</span><br><span class="line">  let x &#x3D; vm.$el.querySelector(&#39;.tabs-item[data-name]&#x3D;&quot;$&#123;finance&#125;&quot;&#39;)</span><br><span class="line">  expect(x.classList.contains(&#39;active&#39;)).to.be.true</span><br><span class="line">  done()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="3-测试tabs-item组件"><a href="#3-测试tabs-item组件" class="headerlink" title="3. 测试tabs-item组件"></a>3. 测试tabs-item组件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">describe(&#39;TabsItem&#39;, () &#x3D;&gt; &#123;</span><br><span class="line">  it(&#39;存在.&#39;, () &#x3D;&gt; &#123;</span><br><span class="line">    expect(TabsItem).to.exist</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  it(&#39;子组件接收 name 属性&#39;, () &#x3D;&gt; &#123;</span><br><span class="line">    const Constructor &#x3D; Vue.extend(TabsItem)</span><br><span class="line">    const vm &#x3D; new Constructor(&#123;</span><br><span class="line">      propsData: &#123;</span><br><span class="line">        name: &#39;xxx&#39;,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;).$mount()</span><br><span class="line">    expect(vm.$el.getAttribute(&#39;data-name&#39;)).to.eq(&#39;xxx&#39;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  it(&#39;子组件接收 disabled 属性&#39;, () &#x3D;&gt; &#123;</span><br><span class="line">    const Constructor &#x3D; Vue.extend(TabsItem)</span><br><span class="line">    const vm &#x3D; new Constructor(&#123;</span><br><span class="line">      propsData: &#123;</span><br><span class="line">        disabled: true,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;).$mount()</span><br><span class="line">    &#x2F;&#x2F; expect(vm.$el.classList.contains(&#39;disabled&#39;)).to.be.true</span><br><span class="line">    const callback &#x3D; sinon.fake();</span><br><span class="line">    vm.$on(&#39;click&#39;, callback)</span><br><span class="line">    vm.$el.click()</span><br><span class="line">    expect(callback).to.have.not.been.called</span><br><span class="line">    &#x2F;&#x2F; 测试覆盖率,目前是坑之后再填</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="最后，欢迎交流"><a href="#最后，欢迎交流" class="headerlink" title="最后，欢迎交流!"></a>最后，欢迎交流!</h4><img src="https://i.loli.net/2020/01/27/gS4ZwP6zfAvULYT.jpg" alt="微信" width="400" height="400" align="bottom"></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="codingories.github.io/2020/01/28/Vue%E9%80%A0%E8%BD%AE%E5%AD%90-Tabs%E6%B5%8B%E8%AF%95-%E4%B8%8A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://i.loli.net/2020/07/12/RPjkZxei6agC49U.jpg">
      <meta itemprop="name" content="Ories">
      <meta itemprop="description" content="这个博客用来记录自己的生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OriesノBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/28/Vue%E9%80%A0%E8%BD%AE%E5%AD%90-Tabs%E6%B5%8B%E8%AF%95-%E4%B8%8A/" class="post-title-link" itemprop="url">Vue造轮子-Tabs测试(上)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-01-28 18:19:10 / Modified: 19:55:16" itemprop="dateCreated datePublished" datetime="2020-01-28T18:19:10+08:00">2020-01-28</time>
            </span>

          
            <span id="/2020/01/28/Vue%E9%80%A0%E8%BD%AE%E5%AD%90-Tabs%E6%B5%8B%E8%AF%95-%E4%B8%8A/" class="post-meta-item leancloud_visitors" data-flag-title="Vue造轮子-Tabs测试(上)" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2020/01/28/Vue%E9%80%A0%E8%BD%AE%E5%AD%90-Tabs%E6%B5%8B%E8%AF%95-%E4%B8%8A/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/01/28/Vue%E9%80%A0%E8%BD%AE%E5%AD%90-Tabs%E6%B5%8B%E8%AF%95-%E4%B8%8A/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="1-点击出现下划线的问题"><a href="#1-点击出现下划线的问题" class="headerlink" title="1. 点击出现下划线的问题"></a>1. 点击出现下划线的问题</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; tabs-item.vue</span><br><span class="line">methods: &#123;</span><br><span class="line">  xxx() &#123;</span><br><span class="line">    this.eventBus.$emit(&#39;update:selected&#39;, this.name, this) </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; tabs.vue</span><br><span class="line">mounted()&#123;</span><br><span class="line">  this.eventBus.$emit(&#39;update:selected&#39;, this.selected) </span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; tabs-head</span><br><span class="line">created()&#123;</span><br><span class="line">  this.eventBus.$on(&#39;update:selected&#39;, (item, vm) &#x3D;&gt; &#123;</span><br><span class="line">    console.log(item)</span><br><span class="line">    console.log(vm) &#x2F;&#x2F; 初始化的时候打印出的值为undefined </span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 为了解决初始化打印出为undefined的问题</span><br><span class="line">&#x2F;&#x2F; tabs.vue 通过两层循环解决找到item</span><br><span class="line">mounted()&#123;</span><br><span class="line">  this.$children.forEach((vm)&#x3D;&gt;&#123;</span><br><span class="line">    if(vm.$options.name &#x3D;&#x3D;&#x3D; &#39;GuluTabsHead&#39;)&#123; &#x2F;&#x2F; 找儿子</span><br><span class="line">      vm.$children.forEach((childVm)&#x3D;&gt;&#123; &#x2F;&#x2F; 找孙子</span><br><span class="line">        if(childVm.$options.name &#x3D;&#x3D;&#x3D; &#39;GuluTabsItem&#39; &amp;&amp; childVm.name &#x3D;&#x3D;&#x3D; this.selected)&#123;</span><br><span class="line">          this.eventBus.$emit(&#39;update:selected&#39;, this.selected,childVm)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-找到item之后开始做动画"><a href="#2-找到item之后开始做动画" class="headerlink" title="2. 找到item之后开始做动画"></a>2. 找到item之后开始做动画</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mounted()&#123;</span><br><span class="line">     this.eventBus.$on(&#39;update:selected&#39;, (item, vm) &#x3D;&gt; &#123;</span><br><span class="line">       let &#123;width, height, top, left&#125; &#x3D; vm.$el.getBoundingClientRect()</span><br><span class="line">       this.$refs.line.style.width &#x3D; &#96;$&#123;width&#125;px&#96; &#x2F;&#x2F; 宽度就会跟着我们点的元素的宽度变,</span><br><span class="line">       &#x2F;&#x2F; this.$refs.line.style.left &#x3D; &#96;$&#123;left&#125;px&#96; &#x2F;&#x2F; 宽度变了我们再修改位置</span><br><span class="line">       this.$refs.line.style.transform &#x3D; &#96;translateX($&#123;left&#125;px)&#96; </span><br><span class="line">       &#x2F;&#x2F; 可以这样优化写来实现硬件3d加速</span><br><span class="line">       &#x2F;&#x2F; 但是这样写有个bug一开始会从左往右滑</span><br><span class="line">     &#125;)</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-尝试解决一开始从走往右滑动的bug"><a href="#3-尝试解决一开始从走往右滑动的bug" class="headerlink" title="3. 尝试解决一开始从走往右滑动的bug"></a>3. 尝试解决一开始从走往右滑动的bug</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; tabs-head.vue</span><br><span class="line">  &lt;template&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;tabs-head&quot;&gt;</span><br><span class="line">          &lt;slot&gt;&lt;&#x2F;slot&gt;</span><br><span class="line">              &lt;div class&#x3D;&quot;line&quot; ref&#x3D;&quot;line&quot; v-if&#x3D;&quot;x&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">          &lt;&#x2F;div&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;&#x2F;template&gt;</span><br><span class="line"></span><br><span class="line">  data()&#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      x: false</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted()&#123;</span><br><span class="line">    this.eventBus.$on(&#39;update:selected&#39;, (item, vm) &#x3D;&gt; &#123;</span><br><span class="line">      this.x &#x3D; true</span><br><span class="line">      &#x2F;&#x2F; 新增一个[更新UI任务]到任务队列里面,</span><br><span class="line">      &#x2F;&#x2F; 会先把下面js执行完了再更新，所以 this.$refs.line.style.width会报错</span><br><span class="line">      &#x2F;&#x2F; 我们只要把代码放到[更新UI任务]的后面就能解决</span><br><span class="line">      this.$nextTick(()&#x3D;&gt;&#123;</span><br><span class="line">        &#x2F;&#x2F; 新增一个函数，放到任务队列里面，由于[更新UI任务]是先放进去那么就会先执行</span><br><span class="line">        &#x2F;&#x2F; 但是这样做还是没解决从左往右滑的bug,所以还是改回left</span><br><span class="line">        let &#123;width, height, top, left&#125; &#x3D; vm.$el.getBoundingClientRect()</span><br><span class="line">        this.$refs.line.style.width &#x3D; &#96;$&#123;width&#125;px&#96;</span><br><span class="line">        this.$refs.line.style.transform &#x3D; &#96;translateX($&#123;left&#125;px)&#96;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-增加禁用功能和禁用样式"><a href="#4-增加禁用功能和禁用样式" class="headerlink" title="4.增加禁用功能和禁用样式"></a>4.增加禁用功能和禁用样式</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 增加disabled样式</span><br><span class="line">computed: &#123;</span><br><span class="line">  classes() &#123; &#x2F;&#x2F; classes是一个计算属性</span><br><span class="line">    return &#123;</span><br><span class="line">      active: this.active,</span><br><span class="line">      disabled: this.disabled,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#x2F;&#x2F; 增加disabled行为</span><br><span class="line">methods: &#123;</span><br><span class="line">  onClick() &#123;</span><br><span class="line">    if (this.disabled) &#123;</span><br><span class="line">      return</span><br><span class="line">    &#125;</span><br><span class="line">    this.eventBus.$emit(&#39;update:selected&#39;, this.name, this)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="最后，欢迎交流"><a href="#最后，欢迎交流" class="headerlink" title="最后，欢迎交流!"></a>最后，欢迎交流!</h4><img src="https://i.loli.net/2020/01/27/gS4ZwP6zfAvULYT.jpg" alt="微信" width="400" height="400" align="bottom">
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="codingories.github.io/2020/01/28/Vue%E9%80%A0%E8%BD%AE%E5%AD%90-tab%E7%BB%84%E4%BB%B6-%E4%B8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://i.loli.net/2020/07/12/RPjkZxei6agC49U.jpg">
      <meta itemprop="name" content="Ories">
      <meta itemprop="description" content="这个博客用来记录自己的生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OriesノBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/28/Vue%E9%80%A0%E8%BD%AE%E5%AD%90-tab%E7%BB%84%E4%BB%B6-%E4%B8%8B/" class="post-title-link" itemprop="url">Vue造轮子-tab组件(下)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-01-28 09:38:57 / Modified: 13:04:04" itemprop="dateCreated datePublished" datetime="2020-01-28T09:38:57+08:00">2020-01-28</time>
            </span>

          
            <span id="/2020/01/28/Vue%E9%80%A0%E8%BD%AE%E5%AD%90-tab%E7%BB%84%E4%BB%B6-%E4%B8%8B/" class="post-meta-item leancloud_visitors" data-flag-title="Vue造轮子-tab组件(下)" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2020/01/28/Vue%E9%80%A0%E8%BD%AE%E5%AD%90-tab%E7%BB%84%E4%BB%B6-%E4%B8%8B/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/01/28/Vue%E9%80%A0%E8%BD%AE%E5%AD%90-tab%E7%BB%84%E4%BB%B6-%E4%B8%8B/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="1-为什么一个-new-Vue-可以构造出一个-eventBus"><a href="#1-为什么一个-new-Vue-可以构造出一个-eventBus" class="headerlink" title="1. 为什么一个 new Vue 可以构造出一个 eventBus"></a>1. 为什么一个 new Vue 可以构造出一个 eventBus</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 当我们定义了new Vue之后,可以这样用</span><br><span class="line">var app &#x3D; new Vue(&#123;</span><br><span class="line">    created()&#123;</span><br><span class="line">        this.$emit()</span><br><span class="line">        this.$on()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 也可以这样用</span><br><span class="line">app.$emit()</span><br><span class="line">app.$on()</span><br><span class="line">app.$off()</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 那么归根结底，只要满足能触发一个事件，监听一个事件，和取消监听一个事件，那么它就是一个事件中心</span><br><span class="line">eventBus</span><br><span class="line">eventBus.$emit() &#x2F;&#x2F; 触发一个事件</span><br><span class="line">eventBus.$on() &#x2F;&#x2F; 监听一个事件</span><br><span class="line">eventBus.$off() &#x2F;&#x2F; 取消监听一个事件</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 而我们的app 正好全部满足，而app就是 new Vue，new Vue就有这三个接口，所以new Vue就是一个eventHub。</span><br><span class="line">&#x2F;&#x2F; 因为它正好有这个三个接口，它的行为完全一样，这就叫基于行为的开发</span><br></pre></td></tr></table></figure>

<h4 id="2-开始写-CSS-样式"><a href="#2-开始写-CSS-样式" class="headerlink" title="2. 开始写 CSS 样式"></a>2. 开始写 CSS 样式</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- tabs-head.vue --&gt;</span><br><span class="line">&lt;style lang&#x3D;&quot;scss&quot; scoped&gt;</span><br><span class="line">  $tab-height: 40px;</span><br><span class="line">  .tabs-head &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    height: $tab-height;</span><br><span class="line">    justify-content: flex-start;</span><br><span class="line">    align-items: center;</span><br><span class="line">    border: 1px solid red;</span><br><span class="line">    &gt; .actions-wrapper &#123;</span><br><span class="line">      margin-left: auto; &#x2F;&#x2F; 这样写可以让按钮靠右,不要问为什么就是可以</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- tabs-item.vue --&gt;</span><br><span class="line">&lt;style lang&#x3D;&quot;scss&quot; scoped&gt;</span><br><span class="line">  .tabs-item &#123;</span><br><span class="line">    flex-shrink: 0;</span><br><span class="line">    padding: 0 2em; &#x2F;&#x2F; 用em是因为只关心两个栏之间的间距</span><br><span class="line">  &#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>

<h4 id="3-激活属性-active-应该放在-data，还是放在-props"><a href="#3-激活属性-active-应该放在-data，还是放在-props" class="headerlink" title="3.激活属性 active 应该放在 data，还是放在 props"></a>3.激活属性 active 应该放在 data，还是放在 props</h4><ul>
<li>如果需要用户传值，就放到 props 里面，因为 props 是你的输入参数，</li>
<li>data 不需要用户传值，自身维护值</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 抽象的讲，就像写一个函数,prop是外部传递的参数，data相当于局部变量，组件就是一个函数</span><br><span class="line">function fn(prop1,prop2)&#123;</span><br><span class="line">    var data1</span><br><span class="line">    var data2</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; 我们在设计api的时候，没有需要用户传递data，我们是让用户把name传进来，实际上是tabs传递来的</span><br><span class="line">&#x2F;&#x2F; tabs传也是传，硬要用props也可以</span><br></pre></td></tr></table></figure>

<h4 id="4-在-mounted-里测试开送事件，不能用-created，因为需要确认元素已经挂载好了"><a href="#4-在-mounted-里测试开送事件，不能用-created，因为需要确认元素已经挂载好了" class="headerlink" title="4.在 mounted 里测试开送事件，不能用 created，因为需要确认元素已经挂载好了"></a>4.在 mounted 里测试开送事件，不能用 created，因为需要确认元素已经挂载好了</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; app.js的new Vue</span><br><span class="line">data: &#123;</span><br><span class="line">  selectedTab: &#39;sports&#39;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; index.html</span><br><span class="line">&lt;g-tabs :selected.sync&#x3D;&quot;selectedTab&quot; @update:selected&#x3D;&quot;yyy&quot;&gt;</span><br><span class="line">  &lt;g-tabs-head&gt;</span><br><span class="line">    &lt;g-tabs-item name&#x3D;&quot;woman&quot;&gt;</span><br><span class="line">      &lt;g-icon name&#x3D;&quot;setting&quot;&gt;&lt;&#x2F;g-icon&gt;美女</span><br><span class="line">    &lt;&#x2F;g-tabs-item&gt;</span><br><span class="line">  &lt;&#x2F;g-tabs-head&gt;</span><br><span class="line">&lt;&#x2F;g-tabs&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; tabs.vue发布</span><br><span class="line">  mounted()&#123;</span><br><span class="line">    this.eventBus.$emit(&#39;update:selected&#39;, this.selected) &#x2F;&#x2F; 这样写不可以触发外面</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; tabs-item监听</span><br><span class="line">  created()&#123;</span><br><span class="line">    this.eventBus.$on(&#39;update:selected&#39;,(name)&#x3D;&gt;&#123;</span><br><span class="line">      if(name &#x3D;&#x3D;&#x3D; this.name)&#123;</span><br><span class="line">        console.log(&#96;我$&#123;this.name&#125;被选中了&#96;)</span><br><span class="line">      &#125;else&#123;</span><br><span class="line">        console.log(&#96;我$&#123;this.name&#125;没被选中了&#96;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; tabs-pane同理，选中了就把自己变成active</span><br></pre></td></tr></table></figure>

<h4 id="5-加-class-写成计算属性"><a href="#5-加-class-写成计算属性" class="headerlink" title="5. 加 class 写成计算属性"></a>5. 加 class 写成计算属性</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; tabs-item.vue</span><br><span class="line">  &lt;div class&#x3D;&quot;tabs-item&quot; @click&#x3D;&quot;xxx&quot; :class&#x3D;&quot;classes&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">  computed: &#123;</span><br><span class="line">    classes() &#123; &#x2F;&#x2F; classes是一个计算属性</span><br><span class="line">      return &#123;</span><br><span class="line">        active: this.active</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.eventBus.$on(&#39;update:selected&#39;, (name) &#x3D;&gt; &#123;</span><br><span class="line">      this.active &#x3D; name &#x3D;&#x3D;&#x3D; this.name;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; tabs-pane,同理,但是要多加一个v-if&#x3D;&quot;active&quot; 用于控制切换隐藏</span><br><span class="line">  &lt;div class&#x3D;&quot;tabs-pane&quot; :class&#x3D;&quot;classes&quot; v-if&#x3D;&quot;active&quot;&gt;</span><br><span class="line">      &lt;slot&gt;&lt;&#x2F;slot&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>

<h4 id="6-组件不能改自己的-props"><a href="#6-组件不能改自己的-props" class="headerlink" title="6. 组件不能改自己的 props"></a>6. 组件不能改自己的 props</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 相当于</span><br><span class="line">function fn(obj)&#123;</span><br><span class="line">    obj.a &#x3D; &#39;1&#39;</span><br><span class="line">    return obj</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; 没多大问题，但是我们一般不要改参数传来的东西，vue也一样,如果硬要改</span><br><span class="line">function fn(obj,n)&#123;</span><br><span class="line">    obj.a &#x3D; &#39;1&#39;</span><br><span class="line">    n &#x3D; 2</span><br><span class="line">    var number &#x3D; n</span><br><span class="line">    number &#x3D; 2</span><br><span class="line">    return obj</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="7-框架主要的目的"><a href="#7-框架主要的目的" class="headerlink" title="7. 框架主要的目的"></a>7. 框架主要的目的</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 使得团队的傻逼也写不出垃圾代码以保证代码的平均质量</span><br><span class="line">function fn(obj)&#123;</span><br><span class="line">    obj.a &#x3D; &#39;1&#39; &#x2F;&#x2F; bad</span><br><span class="line">    return obj</span><br><span class="line">&#125;</span><br><span class="line">function fn(obj,n)&#123;</span><br><span class="line">    obj.a &#x3D; &#39;1&#39;</span><br><span class="line">    n &#x3D; 2</span><br><span class="line">    var number &#x3D; n &#x2F;&#x2F; good</span><br><span class="line">    number &#x3D; 2</span><br><span class="line">    return obj</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="最后-个人微信，欢迎交流"><a href="#最后-个人微信，欢迎交流" class="headerlink" title="最后:个人微信，欢迎交流!"></a>最后:个人微信，欢迎交流!</h4><img src="https://i.loli.net/2020/01/27/gS4ZwP6zfAvULYT.jpg" alt="微信" width="400" height="400" align="bottom">

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="codingories.github.io/2020/01/27/%E9%80%A0%E8%BD%AE%E5%AD%90-tab%E7%BB%84%E4%BB%B6-%E4%B8%AD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://i.loli.net/2020/07/12/RPjkZxei6agC49U.jpg">
      <meta itemprop="name" content="Ories">
      <meta itemprop="description" content="这个博客用来记录自己的生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OriesノBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/27/%E9%80%A0%E8%BD%AE%E5%AD%90-tab%E7%BB%84%E4%BB%B6-%E4%B8%AD/" class="post-title-link" itemprop="url">造轮子-tab组件(中)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-01-27 19:38:06 / Modified: 23:15:03" itemprop="dateCreated datePublished" datetime="2020-01-27T19:38:06+08:00">2020-01-27</time>
            </span>

          
            <span id="/2020/01/27/%E9%80%A0%E8%BD%AE%E5%AD%90-tab%E7%BB%84%E4%BB%B6-%E4%B8%AD/" class="post-meta-item leancloud_visitors" data-flag-title="造轮子-tab组件(中)" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2020/01/27/%E9%80%A0%E8%BD%AE%E5%AD%90-tab%E7%BB%84%E4%BB%B6-%E4%B8%AD/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/01/27/%E9%80%A0%E8%BD%AE%E5%AD%90-tab%E7%BB%84%E4%BB%B6-%E4%B8%AD/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="1-如果给一个标签一个class-标签本身又有class-vue是默认会合并的。只有两个属性是这样一个是class-一个是style。这样就比较好改样式。"><a href="#1-如果给一个标签一个class-标签本身又有class-vue是默认会合并的。只有两个属性是这样一个是class-一个是style。这样就比较好改样式。" class="headerlink" title="1. 如果给一个标签一个class,标签本身又有class,vue是默认会合并的。只有两个属性是这样一个是class,一个是style。这样就比较好改样式。"></a>1. 如果给一个标签一个class,标签本身又有class,vue是默认会合并的。只有两个属性是这样一个是class,一个是style。这样就比较好改样式。</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;g-tabs-head class&#x3D;&quot;red&quot;&gt;&lt;&#x2F;g-tabs&gt;</span><br></pre></td></tr></table></figure>
<h4 id="2-组件的结构以及selected的传递过程，见下图。"><a href="#2-组件的结构以及selected的传递过程，见下图。" class="headerlink" title="2. 组件的结构以及selected的传递过程，见下图。"></a>2. 组件的结构以及selected的传递过程，见下图。</h4><ul>
<li>没有点击的图
<img src="https://i.loli.net/2020/01/27/iaz9jZp7fL3J5Kn.png" alt="没点击.png"></li>
<li>发生了点击操作的图，两个item兄弟之间是没有关系的，发生了点击操作之后要做下图中的五件事情。<ol>
<li>亮自己</li>
<li>熄兄弟</li>
<li>亮pane</li>
<li>熄pane</li>
<li>触发事件 update:selected -&gt; item2
<img src="https://i.loli.net/2020/01/27/MdZWiJ2tFcsBxnN.png" alt="点击.png"></li>
</ol>
</li>
</ul>
<h4 id="3-接下去考虑代码的实现，有两种方案"><a href="#3-接下去考虑代码的实现，有两种方案" class="headerlink" title="3. 接下去考虑代码的实现，有两种方案"></a>3. 接下去考虑代码的实现，有两种方案</h4><ol>
<li>第一种爷爷爸爸儿子之前互相通信</li>
<li>用事件中心EventHub或者叫EventBus发布订阅模式实现,这种简单
<img src="https://i.loli.net/2020/01/27/pqmbcfehoxITzQu.png" alt="发布订阅.png"><h4 id="4-下划线开头的属性不要用是私有属性给vue用的-开头的属性是专门可以用的"><a href="#4-下划线开头的属性不要用是私有属性给vue用的-开头的属性是专门可以用的" class="headerlink" title="4. 下划线开头的属性不要用是私有属性给vue用的,$开头的属性是专门可以用的"></a>4. 下划线开头的属性不要用是私有属性给vue用的,$开头的属性是专门可以用的</h4><h4 id="5-在爷爷tabs组件上面加了privide后代都可以用，其他的属性只提供给儿子不提供给孙子-只有provide是任何后代都可以访问的。"><a href="#5-在爷爷tabs组件上面加了privide后代都可以用，其他的属性只提供给儿子不提供给孙子-只有provide是任何后代都可以访问的。" class="headerlink" title="5. 在爷爷tabs组件上面加了privide后代都可以用，其他的属性只提供给儿子不提供给孙子,只有provide是任何后代都可以访问的。"></a>5. 在爷爷tabs组件上面加了privide后代都可以用，其他的属性只提供给儿子不提供给孙子,只有provide是任何后代都可以访问的。</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> &#x2F;&#x2F; tabs.vue这样就有了eventBus   </span><br><span class="line">data()&#123;</span><br><span class="line">   return &#123;</span><br><span class="line">     eventBus: new Vue()</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;,</span><br><span class="line"> provide()&#123;</span><br><span class="line">   return &#123;</span><br><span class="line">     eventBus:this.eventBus</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;,</span><br><span class="line"> created()&#123;</span><br><span class="line">   console.log(&#39;爷爷的eventBus&#39;)</span><br><span class="line">   console.log(this.eventBus)</span><br><span class="line">   &#x2F;&#x2F; this.$emit(&#39;update:selected&#39;,&#39;xxx&#39;)</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> &#x2F;&#x2F; tabs-head.vie儿子就有了eventBus,其他组件同理</span><br><span class="line"> inject: [&#39;eventBus&#39;],</span><br><span class="line"> created()&#123;</span><br><span class="line">   console.log(&#39;爷爷给爸爸的eventBus&#39;)</span><br><span class="line">   console.log(this.eventBus)</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h5 id="下图橙色字的地方就是provide"><a href="#下图橙色字的地方就是provide" class="headerlink" title="下图橙色字的地方就是provide"></a>下图橙色字的地方就是provide</h5><img src="https://i.loli.net/2020/01/27/B8WRIygshbUwt5V.png" alt="provide.png"><h4 id="6-取函数名字的时候先取一个必须要改的名字，之后再改"><a href="#6-取函数名字的时候先取一个必须要改的名字，之后再改" class="headerlink" title="6.取函数名字的时候先取一个必须要改的名字，之后再改"></a>6.取函数名字的时候先取一个必须要改的名字，之后再改</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">created()&#123;</span><br><span class="line">  this.eventBus.$on(&#39;update:selected&#39;,(name)&#x3D;&gt;&#123;</span><br><span class="line">    console.log(name)</span><br><span class="line">  &#125;)</span><br><span class="line">  &#x2F;&#x2F; 这句话的意思是监听selected被更新了，并且执行一个回调,这里监听的可能是其它的组件</span><br><span class="line">&#125;,</span><br><span class="line">methods: &#123;</span><br><span class="line">  xxx()&#123;</span><br><span class="line">    this.eventBus.$emit(&#39;update:selected&#39;,this.name)</span><br><span class="line">    &#x2F;&#x2F; 这句话的意思是大声喊出来selected更新了</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="7-index-html中-在g-tabs中监听update-selected事件，不会触发yyy-vue的事件是不会冒泡的-在哪里触发就在哪里，但是这个问题不是冒泡问题"><a href="#7-index-html中-在g-tabs中监听update-selected事件，不会触发yyy-vue的事件是不会冒泡的-在哪里触发就在哪里，但是这个问题不是冒泡问题" class="headerlink" title="7.index.html中,在g-tabs中监听update:selected事件，不会触发yyy,vue的事件是不会冒泡的,在哪里触发就在哪里，但是这个问题不是冒泡问题"></a>7.index.html中,在g-tabs中监听update:selected事件，不会触发yyy,vue的事件是不会冒泡的,在哪里触发就在哪里，但是这个问题不是冒泡问题</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 我们的eventBus是g-tabs生成的new Vue(),而app.js监听的g-tabs,是一个vue组件，</span><br><span class="line">&#x2F;&#x2F; 也就是vue组件的事件，而不是new Vue()</span><br><span class="line">&lt;g-tabs :selected.sync&#x3D;&quot;selectedTab&quot; @update:selected&#x3D;&quot;yyy&quot;&gt;&lt;&#x2F;g-tabs&gt;</span><br><span class="line">  methods: &#123;</span><br><span class="line">      yyy(data)&#123;</span><br><span class="line">          console.log(&#39;yyy&#39;)</span><br><span class="line">          console.log(data)</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; 那么组件怎么触发呢</span><br><span class="line">  &#x2F;&#x2F; tabs.vue</span><br><span class="line">  created()&#123;</span><br><span class="line">      this.$emit(&#39;update:selected&#39;, &#39;这是 this $emit 出来的数据&#39;) &#x2F;&#x2F; 这样写可以触发外面,这里的this</span><br><span class="line">      就是当前组件</span><br><span class="line">      this.eventBus.$emit(&#39;update:selected&#39;, &#39;这是 this event $emit 出来的数据&#39;) &#x2F;&#x2F; 这样写不可以触发外面</span><br><span class="line">  &#125;</span><br><span class="line">  &#x2F;&#x2F; app.js</span><br><span class="line">  &lt;g-tabs :selected.sync&#x3D;&quot;selectedTab&quot; @update:selected&#x3D;&quot;yyy&quot;&gt;&lt;&#x2F;g-tabs&gt;</span><br><span class="line">  methods: &#123;</span><br><span class="line">      yyy(data)&#123;</span><br><span class="line">          console.log(&#39;yyy&#39;)</span><br><span class="line">          console.log(data)</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>总结：事件要看在哪个对象上触发的，你需要知道你触发的事件是在哪个对象上触发的，一个是在this上面,一个是在this的eventBus上面,每个对象都可以触发不同事件。</li>
</ul>
<h4 id="8-如果在tabs-header上不会触发"><a href="#8-如果在tabs-header上不会触发" class="headerlink" title="8. 如果在tabs-header上不会触发"></a>8. 如果在tabs-header上不会触发</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; tabs-head</span><br><span class="line">created()&#123;</span><br><span class="line">  this.$emit(&#39;update:selected&#39;, &#39;这是 tabs-head 抛出来的数据&#39;) </span><br><span class="line">  &#x2F;&#x2F; 这样写不可以触发外面是因为vue的事件系统是不会冒泡的,</span><br><span class="line">  &#x2F;&#x2F;如果g-tabs-head标签是一个div那么是可以触发到g-tabs的因为div是可以冒泡的</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; index.html</span><br><span class="line"> &lt;g-tabs :selected.sync&#x3D;&quot;selectedTab&quot; @update:selected&#x3D;&quot;yyy&quot;&gt;</span><br><span class="line">    &lt;g-tabs-head class&#x3D;&quot;red&quot;&gt;</span><br><span class="line">        &lt;template slot&#x3D;&quot;actions&quot;&gt;</span><br><span class="line">            &lt;button&gt;设置&lt;&#x2F;button&gt;</span><br><span class="line">        &lt;&#x2F;template&gt;</span><br><span class="line">    &lt;&#x2F;g-tabs-head&gt;</span><br><span class="line">&lt;&#x2F;g-tabs&gt;</span><br></pre></td></tr></table></figure>
<h4 id="9-关于Vue的事件要注意点"><a href="#9-关于Vue的事件要注意点" class="headerlink" title="9.关于Vue的事件要注意点"></a>9.关于Vue的事件要注意点</h4><ul>
<li>事件是在哪个对象上调用的,在哪个对象上调用就只能在那个对象上监听</li>
<li>事件不会冒泡,子标签触发的事件不会自动传到父标签</li>
</ul>
<h4 id="个人微信-欢迎交流"><a href="#个人微信-欢迎交流" class="headerlink" title="个人微信,欢迎交流!"></a>个人微信,欢迎交流!</h4><p><img src="https://i.loli.net/2020/01/27/gS4ZwP6zfAvULYT.jpg" alt="IMG_0146.jpg"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="codingories.github.io/2020/01/27/%E9%80%A0%E8%BD%AE%E5%AD%90-tab%E7%BB%84%E4%BB%B6-%E4%B8%8A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://i.loli.net/2020/07/12/RPjkZxei6agC49U.jpg">
      <meta itemprop="name" content="Ories">
      <meta itemprop="description" content="这个博客用来记录自己的生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OriesノBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/27/%E9%80%A0%E8%BD%AE%E5%AD%90-tab%E7%BB%84%E4%BB%B6-%E4%B8%8A/" class="post-title-link" itemprop="url">造轮子-tab组件(上)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-01-27 15:37:45 / Modified: 19:41:08" itemprop="dateCreated datePublished" datetime="2020-01-27T15:37:45+08:00">2020-01-27</time>
            </span>

          
            <span id="/2020/01/27/%E9%80%A0%E8%BD%AE%E5%AD%90-tab%E7%BB%84%E4%BB%B6-%E4%B8%8A/" class="post-meta-item leancloud_visitors" data-flag-title="造轮子-tab组件(上)" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2020/01/27/%E9%80%A0%E8%BD%AE%E5%AD%90-tab%E7%BB%84%E4%BB%B6-%E4%B8%8A/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/01/27/%E9%80%A0%E8%BD%AE%E5%AD%90-tab%E7%BB%84%E4%BB%B6-%E4%B8%8A/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="1-如何解决之前遗留的bug"><a href="#1-如何解决之前遗留的bug" class="headerlink" title="1. 如何解决之前遗留的bug"></a>1. 如何解决之前遗留的bug</h4><ol>
<li>根据错误提示大概确定原因，toast.test.js .style 造成。</li>
<li>用二分法找bug到底是哪一个用例出错。</li>
<li>log+分析代码,mounted和$nextTick是有时间间隙的，得到原因测试用例中mount完了之后立刻click,click之后再$nextTick设置高度,所以可能是click太快了，此时s当$nextTick的时候，已经toast已经被我们关掉了，所以无法设置高度,那么解决方案就是我们就需要模拟用户点击，200ms后再点击<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; toast.test.js</span><br><span class="line">setTimeout(()&#x3D;&gt;&#123;</span><br><span class="line">    closeButton.click()</span><br><span class="line">    expect(callback).to.have.been.called</span><br><span class="line">    done()</span><br><span class="line">&#125;,200)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="2-对tabs进行需求分析-每一个组件都要进行四步"><a href="#2-对tabs进行需求分析-每一个组件都要进行四步" class="headerlink" title="2. 对tabs进行需求分析,每一个组件都要进行四步"></a>2. 对tabs进行需求分析,每一个组件都要进行四步</h4><ol>
<li>需求</li>
<li>ui </li>
<li>代码<ul>
<li>先考虑用户怎么用<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; elementUI的使用方法一</span><br><span class="line">&lt;g-tabs&gt;</span><br><span class="line">    &lt;g-tabs-item label&#x3D;&quot;美女&quot;&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            美女相关咨询</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;g-tabs-item&gt;</span><br><span class="line">    &lt;g-tabs-item label&#x3D;&quot;世界杯&quot;&gt;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            世界杯相关咨询</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;g-tabs-item&gt;</span><br><span class="line">&lt;&#x2F;g-tabs&gt;	</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; elementUI的使用方法二,加icon</span><br><span class="line">&#x2F;&#x2F; 这种使用方法有个问题，tab上加背景色没办法加</span><br><span class="line">&lt;g-tabs&gt;</span><br><span class="line">    &lt;g-tabs-item slot&#x3D;&quot;label&quot;&gt;</span><br><span class="line">        &lt;g-icon&gt;  </span><br><span class="line">            美女相关咨询</span><br><span class="line">        &lt;&#x2F;g-icon&gt;</span><br><span class="line">    &lt;&#x2F;g-tabs-item&gt;</span><br><span class="line">&lt;&#x2F;g-tabs&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 我们设计的使用方式,这种方式改背景色就很简单直接在g-tabs-nav上添加就可以了。</span><br><span class="line">&lt;g-tabs selected&#x3D;&quot;tab1&quot;&gt;</span><br><span class="line">    &lt;g-tabs-nav&gt;</span><br><span class="line">        &lt;g-tabs-item name&#x3D;&quot;tab1&quot;&gt;&lt;&#x2F;g-tabs-item&gt;	</span><br><span class="line">        &lt;g-tabs-item name&#x3D;&quot;tab2&quot;&gt;&lt;&#x2F;g-tabs-item&gt;	</span><br><span class="line">    &lt;&#x2F;g-tabs-nav&gt;</span><br><span class="line">    &lt;g-tabs-content&gt;</span><br><span class="line">        &lt;g-tabs-pane name&#x3D;&quot;tab1&quot;&gt;&lt;&#x2F;g-tabs-pane&gt;</span><br><span class="line">        &lt;g-tabs-pane name&#x3D;&quot;tab2&quot;&gt;&lt;&#x2F;g-tabs-pane&gt;</span><br><span class="line">    &lt;&#x2F;g-tabs-content&gt;</span><br><span class="line">&lt;&#x2F;g-tabs&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>测试</li>
</ol>
<h4 id="3-新建5个组件"><a href="#3-新建5个组件" class="headerlink" title="3. 新建5个组件"></a>3. 新建5个组件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; tabs.vue</span><br><span class="line">&#x2F;&#x2F; tabs-head</span><br><span class="line">&#x2F;&#x2F; tabs-body</span><br><span class="line">&#x2F;&#x2F; tabs-item</span><br><span class="line">&#x2F;&#x2F; tabs-pane</span><br></pre></td></tr></table></figure>

<h4 id="4-子组件不能改父组件的值，一定要通过通知父组件，让父组件来改"><a href="#4-子组件不能改父组件的值，一定要通过通知父组件，让父组件来改" class="headerlink" title="4. 子组件不能改父组件的值，一定要通过通知父组件，让父组件来改"></a>4. 子组件不能改父组件的值，一定要通过通知父组件，让父组件来改</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 这么写的原因</span><br><span class="line">&lt;!-- &lt;g-tabs selected&#x3D;&quot;selectedTab&quot; @update:selected&#x3D;&quot;selectedTab &#x3D; $event&quot;&gt;  --&gt;</span><br><span class="line">&lt;!-- 这句话是语法糖完全等价上面一句 --&gt;</span><br><span class="line">&lt;g-tabs :selected.sync&#x3D;&quot;selectedTab&quot;&gt; </span><br><span class="line">    &lt;g-tabs-head&gt;</span><br><span class="line">        &lt;g-tabs-item name&#x3D;&quot;woman&quot;&gt;</span><br><span class="line">            美女</span><br><span class="line">        &lt;&#x2F;g-tabs-item&gt;</span><br><span class="line">    &lt;&#x2F;g-tabs-head&gt;</span><br><span class="line">    &lt;g-tabs-body&gt;</span><br><span class="line">        &lt;g-tabs-pane name&#x3D;&quot;woman&quot;&gt;</span><br><span class="line">            美女相关咨询</span><br><span class="line">        &lt;&#x2F;g-tabs-pane&gt;</span><br><span class="line">    &lt;&#x2F;g-tabs-body&gt;</span><br><span class="line">&lt;&#x2F;g-tabs&gt;</span><br></pre></td></tr></table></figure>
<h4 id="5-添加-tabs-相关组件的基本-props，之后开始完善"><a href="#5-添加-tabs-相关组件的基本-props，之后开始完善" class="headerlink" title="5.添加 tabs 相关组件的基本 props，之后开始完善"></a>5.添加 tabs 相关组件的基本 props，之后开始完善</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; tabs.vue</span><br><span class="line">props: &#123;</span><br><span class="line">    selected: &#123;</span><br><span class="line">        type: String,</span><br><span class="line">        required: true</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line">direction: &#123;</span><br><span class="line">    type: String,</span><br><span class="line">    default: &#39;horizontal&#39;,</span><br><span class="line">    validator(value)&#123;</span><br><span class="line">        return [&#39;horizontal&#39;, &#39;vertical&#39;].indexOf(value) &gt;&#x3D; 0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line">created()&#123;</span><br><span class="line">    &#x2F;&#x2F; this.$emit(&#39;update:selected&#39;,&#39;xxx&#39;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; tabs-item.vue</span><br><span class="line"> props: &#123;</span><br><span class="line">  disabled: &#123;</span><br><span class="line">    type: Boolean,</span><br><span class="line">    default: false</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 为了实现右边有个按钮的功能</span><br><span class="line">&#x2F;&#x2F; tabs-head</span><br><span class="line">&lt;div class&#x3D;&quot;tabs-head&quot;&gt;</span><br><span class="line">    &lt;slot&gt;&lt;&#x2F;slot&gt;</span><br><span class="line">    &lt;slot name&#x3D;&quot;actions&quot;&gt;&lt;&#x2F;slot&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&#x2F;&#x2F; index.html</span><br><span class="line">&lt;g-tabs :selected.sync&#x3D;&quot;selectedTab&quot;&gt;</span><br><span class="line">    &lt;g-tabs-head&gt;</span><br><span class="line">        &lt;template slot&#x3D;&quot;actions&quot;&gt;</span><br><span class="line">            &lt;button&gt;设置&lt;&#x2F;button&gt;</span><br><span class="line">        &lt;&#x2F;template&gt;</span><br><span class="line">    &lt;&#x2F;g-tabs-head&gt;</span><br><span class="line">&lt;&#x2F;g-tabs&gt;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="codingories.github.io/2020/01/27/toast%E7%BB%84%E4%BB%B6%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://i.loli.net/2020/07/12/RPjkZxei6agC49U.jpg">
      <meta itemprop="name" content="Ories">
      <meta itemprop="description" content="这个博客用来记录自己的生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OriesノBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/27/toast%E7%BB%84%E4%BB%B6%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" class="post-title-link" itemprop="url">toast组件单元测试</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-01-27 10:53:06 / Modified: 14:03:42" itemprop="dateCreated datePublished" datetime="2020-01-27T10:53:06+08:00">2020-01-27</time>
            </span>

          
            <span id="/2020/01/27/toast%E7%BB%84%E4%BB%B6%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" class="post-meta-item leancloud_visitors" data-flag-title="toast组件单元测试" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2020/01/27/toast%E7%BB%84%E4%BB%B6%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/01/27/toast%E7%BB%84%E4%BB%B6%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ol>
<li><p>先看是否存在</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">describe(&#39;Toast&#39;, () &#x3D;&gt; &#123;</span><br><span class="line">    it(&#39;存在.&#39;, () &#x3D;&gt; &#123;</span><br><span class="line">        expect(Toast).to.be.exist</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li><p>看属性,我们要测 ToastVue 和 plugin.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">describe(&#39;Toast&#39;, () &#x3D;&gt; &#123;</span><br><span class="line">it(&#39;存在.&#39;, () &#x3D;&gt; &#123;</span><br><span class="line">    expect(Toast).to.be.exist</span><br><span class="line">&#125;)</span><br><span class="line">describe(&#39;props&#39;,function () &#123;</span><br><span class="line">    this.timeout(15000) &#x2F;&#x2F; 设置15秒关闭</span><br><span class="line">    it(&#39;接收 autoClose&#39;, (done)&#x3D;&gt;&#123;</span><br><span class="line">    let div &#x3D; document.createElement(&#39;div&#39;)</span><br><span class="line">    document.body.appendChild(div)</span><br><span class="line">    const Constructor &#x3D; Vue.extend(Toast)</span><br><span class="line">    const vm &#x3D; new Constructor(</span><br><span class="line">        &#123;</span><br><span class="line">        propsData:&#123;</span><br><span class="line">            autoClose: true,</span><br><span class="line">            autoCloseDelay: 1</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ).$mount(div)</span><br><span class="line">    setTimeout(()&#x3D;&gt;&#123;</span><br><span class="line">        expect(document.body.contains(vm.$el)).to.eq(false)</span><br><span class="line">        done()</span><br><span class="line">    &#125;,6000)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;);</span><br><span class="line">&#x2F;&#x2F; 进一步优化,变成关闭的时候进行测试，不需要设置6秒</span><br><span class="line">vm.$on(&#39;close&#39;,()&#x3D;&gt;&#123;</span><br><span class="line">    expect(document.body.contains(vm.$el)).to.eq(false)</span><br><span class="line">    done()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>报异常错误，要用 yarn run dev-test 代替 npm run dev-test</p>
</li>
<li><p>测试 closeButton。</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">it(&#39;接收 closeButton&#39;, ()&#x3D;&gt;&#123;</span><br><span class="line">     const callback &#x3D; sinon.fake();</span><br><span class="line">  const Constructor &#x3D; Vue.extend(Toast)</span><br><span class="line">  const vm &#x3D; new Constructor(&#123;</span><br><span class="line">    propsData: &#123;</span><br><span class="line">      closeButton: &#123;</span><br><span class="line">        text: &#39;关闭吧&#39;,</span><br><span class="line">        callback,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;).$mount()</span><br><span class="line">  let closeButton &#x3D; vm.$el.querySelector(&#39;.close&#39;)</span><br><span class="line">  expect(closeButton.textContent.trim()).to.eq(&#39;关闭吧&#39;)</span><br><span class="line">  closeButton.click()</span><br><span class="line">  expect(callback).to.have.been.called</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这里测试后的时候出现 warning,Cannot read property ‘style’ of undefined，通过修改 toast.vue 中代码解决</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">    updateStyles () &#123;</span><br><span class="line">        this.$nextTick(() &#x3D;&gt; &#123;</span><br><span class="line">            if(this.$refs.toast &amp;&amp; this.$refs.line)&#123;</span><br><span class="line">                this.$refs.line.style.height &#x3D;</span><br><span class="line">                &#96;$&#123;this.$refs.toast.getBoundingClientRect().height&#125;px&#96;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="codingories.github.io/2020/01/26/%E9%80%A0%E8%BD%AE%E5%AD%90-toast%E7%BB%84%E4%BB%B6%E7%9A%84%E5%AE%9E%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://i.loli.net/2020/07/12/RPjkZxei6agC49U.jpg">
      <meta itemprop="name" content="Ories">
      <meta itemprop="description" content="这个博客用来记录自己的生活">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="OriesノBlog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/26/%E9%80%A0%E8%BD%AE%E5%AD%90-toast%E7%BB%84%E4%BB%B6%E7%9A%84%E5%AE%9E%E7%8E%B0/" class="post-title-link" itemprop="url">造轮子-toast组件的实现(下)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-01-26 16:09:42 / Modified: 21:47:07" itemprop="dateCreated datePublished" datetime="2020-01-26T16:09:42+08:00">2020-01-26</time>
            </span>

          
            <span id="/2020/01/26/%E9%80%A0%E8%BD%AE%E5%AD%90-toast%E7%BB%84%E4%BB%B6%E7%9A%84%E5%AE%9E%E7%8E%B0/" class="post-meta-item leancloud_visitors" data-flag-title="造轮子-toast组件的实现(下)" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2020/01/26/%E9%80%A0%E8%BD%AE%E5%AD%90-toast%E7%BB%84%E4%BB%B6%E7%9A%84%E5%AE%9E%E7%8E%B0/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/01/26/%E9%80%A0%E8%BD%AE%E5%AD%90-toast%E7%BB%84%E4%BB%B6%E7%9A%84%E5%AE%9E%E7%8E%B0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>1.解决 toast 中传入 html 的问题，通过假的 slot 来实现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; plugins.js</span><br><span class="line">toast.$slots.default &#x3D; [message]</span><br><span class="line">&#x2F;&#x2F; toast.vue</span><br><span class="line"> &lt;div v-html&#x3D;&quot;$slots.default[0]&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">&#x2F;&#x2F; 使用</span><br><span class="line">created() &#123;</span><br><span class="line">    this.$toast(&#39;&lt;p&gt;我是&lt;strong&gt;hi&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;&#39;,&#123;&#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>2.在 toast 中加 html 是比较危险的一个动作，所以要加一个选项默认不开启。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; toast.vue</span><br><span class="line">&lt;slot v-if&#x3D;&quot;!enableHtml&quot;&gt;&lt;&#x2F;slot&gt;</span><br><span class="line">&lt;div v-else v-html&#x3D;&quot;$slots.default[0]&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">&#x2F;&#x2F; plugin.js，进行传递参数的改写</span><br><span class="line">propsData:toastOptions</span><br><span class="line">&#x2F;&#x2F; 使用</span><br><span class="line">created() &#123;</span><br><span class="line">  this.$toast(&#39;&lt;p&gt;我是&lt;strong&gt;hi&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;&lt;a href&#x3D;&quot;http:&#x2F;&#x2F;qq.com&quot;&gt;qq&lt;&#x2F;a&gt;&#39;,&#123;</span><br><span class="line">    enableHtml: false</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>3.flex-shrink的使用,flex-shrink属性定义了项目的缩小比例，默认为1，即如果空间不足，该项目将缩小。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.item &#123;</span><br><span class="line">  flex-shrink: &lt;number&gt;; &#x2F;* default 1 *&#x2F;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果所有项目的flex-shrink属性都为1，当空间不足时，都将等比例缩小。如果一个项目的flex-shrink属性为0，其他项目都为1，则空间不足时，前者不缩小。如果数值越大，缩小比例越大。</p>
<p>4.line的高度问题，如果高度写了最小高度，那么子元素的height%就不生效了。用js去操作line的高度。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; toast.vue</span><br><span class="line">&lt;div class&#x3D;&quot;toast&quot; ref&#x3D;&quot;wrapper&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;line&quot; ref&#x3D;&quot;line&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">mounted() &#123;</span><br><span class="line">  this.$nextTick(()&#x3D;&gt;&#123;</span><br><span class="line">    this.$refs.line.style.height &#x3D; &#96;$&#123;this.$refs.wrapper.getBoundingClientRect().height&#125;px&#96;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;, &#x2F;&#x2F; 这个计较太trick</span><br></pre></td></tr></table></figure>
<p>debugger的技巧，如果眼睛观察到的是0，但是打印出来不是0，可能就是异步的问题。</p>
<p>5.增加toast的位置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; toast.vue</span><br><span class="line">props: &#123;</span><br><span class="line">  position: &#123;</span><br><span class="line">    type: String,</span><br><span class="line">    default: &#39;top&#39;,</span><br><span class="line">    validator(value)&#123;</span><br><span class="line">      return [&#39;top&#39;, &#39;bottom&#39;, &#39;middle&#39;].indexOf(value) &gt;&#x3D; 0</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line">computed:&#123;</span><br><span class="line">  toastClasses()&#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      [&#96;position-$&#123;this.position&#125;&#96;]:true</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; 使用</span><br><span class="line">this.$toast(&#39;你的智商需要充值&#39;, &#123;</span><br><span class="line">  position: &#39;bottom&#39;</span><br><span class="line">&#125;)</span><br><span class="line">&#x2F;&#x2F; plugin.js</span><br><span class="line">export default &#123;</span><br><span class="line">  install(Vue, options)&#123;</span><br><span class="line">    Vue.prototype.$toast &#x3D; function (message, toastOptions) &#123;</span><br><span class="line">      let Constructor &#x3D; Vue.extend(Toast)</span><br><span class="line">      let toast &#x3D; new Constructor(&#123;</span><br><span class="line">        propsData:toastOptions &#x2F;&#x2F; 在这里将position传进去</span><br><span class="line">      &#125;)</span><br><span class="line">      toast.$slots.default &#x3D; [message]</span><br><span class="line">      toast.$mount()</span><br><span class="line">      document.body.appendChild(toast.$el)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>6.开始做如果已经有一个toast就把之前那个干掉，再出现。</p>
<ol>
<li>先写一个函数</li>
<li>给函数取一个名字</li>
<li>把参数提出来<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; plugin.js</span><br><span class="line">import Toast from &#39;.&#x2F;toast&#39;</span><br><span class="line"></span><br><span class="line">let currentToast</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  install(Vue, options)&#123;</span><br><span class="line">    Vue.prototype.$toast &#x3D; function (message, toastOptions) &#123;</span><br><span class="line">      if(currentToast)&#123;</span><br><span class="line">        currentToast.close()</span><br><span class="line">      &#125;</span><br><span class="line">      currentToast &#x3D; createToast(&#123;Vue,message, propsData: toastOptions&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;* helpers *&#x2F;</span><br><span class="line">function createToast (&#123;Vue,message,propsData&#125;)&#123;</span><br><span class="line">  let Constructor &#x3D; Vue.extend(Toast)</span><br><span class="line">  let toast &#x3D; new Constructor(&#123;propsData&#125;)</span><br><span class="line">  toast.$slots.default &#x3D; [message]</span><br><span class="line">  toast.$mount()</span><br><span class="line">  document.body.appendChild(toast.$el)</span><br><span class="line">  return toast</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>7.实现动画</p>
<ol>
<li><p>声明一个动画，然后写到类上面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@keyframes fade &#123;</span><br><span class="line">  0% &#123;opacity: 0; transform: translateY(100%);&#125;</span><br><span class="line">  100% &#123;opacity: 1;transform: translateY(0);&#125;</span><br><span class="line">&#125; </span><br><span class="line">.toast &#123;</span><br><span class="line">  animation: fade 1s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>这里有个bug,我们在实现一次的时候是有问题的,如果toast被关闭了，我们不需要重复关闭，而我们写的是不管你之前的toast有没有关闭，只要有值的我们就关闭，那这样就会出现一个问题，点了关闭currentToast还是一个Toast并没有把它变成null，所以要加上一个回调告诉外面，我被关了不要重复关我，代码会多调一次close。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; toast.vue</span><br><span class="line">close() &#123;</span><br><span class="line">  this.$el.remove()</span><br><span class="line">  this.$emit(&#39;close&#39;)</span><br><span class="line">  this.$destroy()</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; plugin.js</span><br><span class="line">export default &#123;</span><br><span class="line">  install(Vue, options)&#123;</span><br><span class="line">    Vue.prototype.$toast &#x3D; function (message, toastOptions) &#123;</span><br><span class="line">      if(currentToast)&#123;</span><br><span class="line">        currentToast.close()</span><br><span class="line">      &#125;</span><br><span class="line">      currentToast &#x3D; createToast(&#123;Vue,message, propsData: toastOptions,onclose: ()&#x3D;&gt;&#123;</span><br><span class="line">          currentToast &#x3D; null</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;) &#x2F;&#x2F; 加了这句话</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;* helpers *&#x2F;</span><br><span class="line">function createToast (&#123;Vue,message,propsData,onclose&#125;)&#123;</span><br><span class="line">  let Constructor &#x3D; Vue.extend(Toast)</span><br><span class="line">  let toast &#x3D; new Constructor(&#123;propsData&#125;)</span><br><span class="line">  toast.$slots.default &#x3D; [message]</span><br><span class="line">  toast.$mount()</span><br><span class="line">  toast.$on(&#39;close&#39;,onclose) &#x2F;&#x2F; 加了这句话</span><br><span class="line">  document.body.appendChild(toast.$el)</span><br><span class="line">  return toast</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>git相关的钩上，不想管的不用钩上</p>
</li>
<li><p>回忆bug是如何产生的，默认样式是:transform:translateX(-50%),进入0%时候transform:translateY(100%),它们两会覆盖。有三个方案，解决。</p>
<ul>
<li>换一种方式去做居中，但是这种方法是最好的，很难想</li>
<li>不要用css做动画</li>
<li>做两个div外面一个居中，里面一个做动画</li>
</ul>
</li>
<li><p>为什么不写两个动画帧来控制居中，如果一段代码要背下来，那么一定是有问题的。</p>
<ol start="8">
<li>优化三种动画，上下中是不一样的，通过css进行优化。</li>
</ol>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/11/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/page/13/">13</a><span class="space">&hellip;</span><a class="page-number" href="/page/25/">25</a><a class="extend next" rel="next" href="/page/13/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ories"
      src="https://i.loli.net/2020/07/12/RPjkZxei6agC49U.jpg">
  <p class="site-author-name" itemprop="name">Ories</p>
  <div class="site-description" itemprop="description">这个博客用来记录自己的生活</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">250</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">74</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/codingories" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;codingories" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ories</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/valine@1.3.9/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : true,
      notify     : true,
      appId      : 'HHvArpMYcwuYjNb3703JgvvS-gzGzoHsz',
      appKey     : '5lSamU58UyScrMIQcUygcD2I',
      placeholder: "欢迎畅所欲言",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : 'true'
    });
  }, window.Valine);
});
</script>

</body>
</html>
